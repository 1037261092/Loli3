C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE main.c LARGE

line level    source

   1          #include<reg51.h>                       //Large编译，否则xdata异常
   2          #include<math.h>
   3          #include<LOLI_3.h>       //显示需要的图形数据
   4          #define u8 unsigned char
   5          #define u16 unsigned int
   6          #include<intrins.h>
   7          
   8          /*****************************************************/
   9          //STC12 系列新增寄存器
  10          sfr IPH=0xb7;
  11          sfr P4=0xc0;
  12          sfr P4SW=0xbb;
  13          sfr P1ASF=0x9d;
  14          sfr P4M0=0xb4;
  15          sfr P3M0=0xb2;
  16          sfr P3M1=0xb1;
  17          sfr P2M0=0x96;
  18          sfr P0M0=0x94;
  19          sfr ADC_CONTR=0xbc;
  20          sfr ADC_RES=0xbd;
  21          sfr ADC_RESL=0xbe;
  22          
  23          sfr BRT=0x9c;
  24          sfr AUXR=0x8e;
  25          sfr WAKE_CLKO=0x8f;
  26          
  27          sfr IAP_DATA=0xc2;
  28          sfr IAP_ADDRH=0xc3;
  29          sfr IAP_ADDRL=0xc4;
  30          sfr IAP_CMD=0xc5;
  31          sfr IAP_TRIG=0xc6;
  32          sfr IAP_CONTR=0xc7;
  33          
  34          sfr CCON        =   0xD8;           //PCA control register
  35          sbit CCF0       =   CCON^0;         //PCA module-0 interrupt flag
  36          sbit CCF1       =   CCON^1;         //PCA module-1 interrupt flag
  37          sbit CR         =   CCON^6;         //PCA timer run control bit
  38          sfr CMOD        =   0xD9;           //PCA mode register
  39          sfr CL          =   0xE9;           //PCA base timer LOW
  40          sfr CH          =   0xF9;           //PCA base timer HIGH
  41          sfr CCAPM0      =   0xDA;           //PCA module-0 mode register
  42          sfr CCAP0L      =   0xEA;           //PCA module-0 capture register LOW
  43          sfr CCAP0H      =   0xFA;           //PCA module-0 capture register HIGH
  44          sfr CCAPM1      =   0xDB;           //PCA module-1 mode registers
  45          sfr CCAP1L      =   0xEB;           //PCA module-1 capture register LOW
  46          sfr CCAP1H      =   0xFB;           //PCA module-1 capture register HIGH
  47          
  48          
  49          /*************************************************/
  50          //LCD引脚定义
  51          sbit CS=P0^6;
  52          sbit RST=P0^7;
  53          sbit RS=P4^6;                                                             
  54          sbit SDA=P4^5;                                                     
  55          sbit CLK=P4^4;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 2   

  56          sbit LEDA=P2^5;
  57          
  58          /**************************************************/
  59          //NRF24L01 引脚定义
  60          
  61          sbit CE=P0^0;
  62          sbit SCK=P0^1;
  63          sbit MDO=P0^2;
  64          sbit IRQ=P0^3;
  65          sbit MDI=P0^4;
  66          sbit CSN=P0^5;
  67          
  68          /*************************************************/
  69          //I/O定义
  70          
  71          sbit buzzer=P3^4;
  72          sbit PPM=P3^3;
  73          
  74          sbit KEY=P4^7;
  75          sbit K1=P3^0;
  76          sbit K2=P3^1;
  77          sbit K3=P3^7;
  78          sbit K4=P3^6;
  79          sbit K5=P3^2;
  80          sbit K6=P3^5;
  81          
  82          sbit SA=P2^0;
  83          sbit SB1=P2^1;
  84          sbit SB2=P2^2;
  85          sbit SC1=P2^3;
  86          sbit SC2=P2^4;
  87          sbit SD=P2^6;
  88          sbit SE=P2^7;
  89          
  90          
  91          /***********************************************/
  92          //数据、标志位
  93          u8 bdata DATA;
  94          sbit D_7=DATA^7;
  95          sbit D_6=DATA^6;
  96          sbit D_5=DATA^5;
  97          sbit D_4=DATA^4;
  98          sbit D_3=DATA^3;
  99          sbit D_2=DATA^2;
 100          sbit D_1=DATA^1;
 101          sbit D_0=DATA^0;
 102          
 103          
 104          
 105          //ROM存储
 106          #define Model_length 125   //模型数据 长度 宏定义
 107          #define Version  0xAC           //系统版本 A13
 108          
 109          u8 Model_number=0,Model_current=0,Model_addrH=2;
 110          bit Model_change,Model_reset,reset_action;
 111          /*******+军刀破+******************/
 112          //模型命名
 113          u8 Name_idx=0; //名字字母索引，最大7
 114          
 115          u8 Model_name[7]={0,0,0,0,0,0,0};
 116          //原来萝丽的定义是351，加上命名内容，定义为375
 117          u8 TEMP_DATA[375];
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 3   

 118          /*******+军刀破+******************/
 119          bit ROM_enable;
 120          bit Data_system,Data_model;
 121          bit save_action;
 122          
 123          
 124          
 125          bit calibration_action,calibration_ok;
 126          
 127          
 128          //显示
 129          u8 word[10];
 130          u8 WW[11][6];
 131          bit LCD_big;
 132          bit LCD_light=1;
 133          bit LCD_reverse;
 134          u8 LCD_vop=42;
 135          
 136          u8 boot_screen=0;
 137          bit boot_screen_en=1;
 138          
 139          
 140          
 141          
 142          
 143          //时钟
 144          bit event1,event2,event3;
 145          u8 t1=0,t2=0,t3=0;
 146          
 147          bit flag_20ms;
 148          
 149          
 150          u8 Master_clock,second=0,minute=0,hour=0;
 151          
 152          u8 clock2,second2=0,minute2=0;
 153          u8 clock_set=5,clock_switch=0;
 154          bit clock_go;
 155          
 156          
 157          u16 throttle_idle=0;
 158          u8 delay_time=0;
 159          u8 flash_time=0;
 160          
 161          
 162          
 163          //蜂鸣器
 164          bit Message_AlarmClock,Message_LowPower;
 165          u8 Message_KeyTone=0,Message_DataReturn_bad=0;
 166          u8 beep=0,sound=0;  
 167          bit Sound_enable=1;     
 168                  
 169                  
 170                  
 171                  
 172          
 173          //菜单模式
 174          bit PPM_OUT,PPM_IN,RC_TX,IR_TX,RC_check;
 175          bit config_change,star=1,RC_check_star;
 176          u8 menu=0,menu_1=0,menu_2=0,menu_3=0;
 177          u8 line=0,line_1=0,line_2=0,line_3=0;
 178          u8 last_line=0;
 179          
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 4   

 180          
 181          //按键
 182          bit KS,KS_long_press;
 183          u8 KS_press_time;
 184          bit key1,key2,key3,key4,key5,key6;
 185          bit s1,s2,s3,s4,s5,s6;
 186          bit s1_long_press,s2_long_press,s3_long_press,s4_long_press,s5_long_press,s6_long_press;
 187          u8 s1_press_time,s2_press_time,s3_press_time,s4_press_time,s5_press_time,s6_press_time;
 188          bit key_time;
 189          bit increase,decrease,up,down,left,right;
 190          
 191          
 192          //ADC
 193          u16 data adc[8],adc_buff[8];
 194          u8 t_adc=0;
 195          u8 Battery_1s=1,VLD1=35,VLD2=70;
 196          u16 battery_voltage;
 197          char v_trim1=0,v_trim2=0;
 198          bit USB_5V;
 199          
 200          
 201          
 202          
 203          
 204          
 205          //硬件配置
 206          //u8 Right_throttle;
 207          
 208          bit throttle_lock,Throttle_check=1,Auto_lock,Trim_step;
 209          u8 tt=0;
 210          u8 middle_change_last;
 211          
 212          u16 value0,value1;
 213          
 214          
 215          
 216          u8 IN_mapping[8];
 217          
 218          bit recover;
 219          
 220          bit NRF_config_change,config_change;
 221          bit first;
 222          
 223          u16 CH1_max=600,CH2_max=600,CH3_max=600,CH4_max=600;
 224          u16 CH1_min=400,CH2_min=400,CH3_min=400,CH4_min=400;
 225          u8 CH1_offset=51,CH2_offset=51,CH3_offset=51,CH4_offset=51;
 226          u16 CH_value[4];
 227          
 228          
 229          
 230          u8 ratio_switch=0;
 231          bit use_new_ratio;
 232          
 233          
 234          
 235          //无线通信
 236          bit cancel,connecting;
 237          u8 TX_power=3;
 238          bit CD;
 239          u8 data RC_TX_state=0;
 240          u8 t_check,t_hopping,NRF_error=0;
 241          
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 5   

 242          u8 CD_data[16];
 243          
 244          u8 NRF_mapping[8];
 245          u16 NRF_buff[8];
 246          u8 timer2=0,timer3=0,receive=0;
 247          
 248          
 249          u8 rx_sum,FUCK_sum=0;//坑爹的xdata，定义成rx不能用，定义成FUCK就能用了
 250          
 251          
 252          u8 address[5];
 253          u8 hopping[5];
 254          u8 code address_0[5]={'L','O','V','E','!'};//使用LOVE作为对频暗语
 255          
 256          
 257          
 258          u8 tx_buff[11],tx_data[11],rx[11]={0,0,0};
 259          u8 tx_order[11];
 260          
 261          
 262          u8 TX_protocol=3;
 263          
 264          
 265          u8 Power_V=70,Chip_V=40,TX_min=60,RX_min=60;
 266          
 267          
 268          
 269          
 270          //接收机设置
 271          u8 receiver_mode[8];
 272          bit Receiver_change;
 273          bit NRF_change;
 274          
 275          char out_control[8];
 276          u16 out_control_data[8];
 277          
 278          
 279          //PPM
 280          
 281          u8 T_l,T_h;
 282          u8 t_ppm=0,t_PPMout=0;
 283          int PPM_DATA[8]={0,0,0,0,0,0,0,0};
 284          int data PPM_buff[8];
 285          u16 data PPMout[8]={500,600,800,200,1000,0,100,300};
 286          u8 PPM_mapping[8]={0,1,2,3,4,5,6,7};
 287          
 288          u8 train_switch=0;
 289          bit train_output;
 290          u8 PPM_updata=0;
 291          char PPM_offset=0;
 292          
 293          //自动控制
 294          u8 auto_switch=0,auto_mode=2;
 295          char auto_middle=-100,auto_star=-50,auto_end=50;
 296          u8 auto_speed=10;
 297          int auto_value=0;
 298          u16 auto_max,auto_min;
 299          bit auto_h,auto_l=0;
 300          
 301          
 302          
 303          
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 6   

 304          //开关
 305          u8 Switch_A,Switch_B,Switch_C,Switch_D,Switch_E;
 306          u8 Combination_Switch=0,Com_Swt_IN1=0,Com_Swt_IN2=0;
 307          u8 Com_Swt_out[6]={16,29,42,55,68,81};
 308          u8 Com_Swt_mapping=4;
 309          u8 Return_alarm_switch=0;
 310          
 311          
 312          //通道运算
 313          int data operation[8];
 314          
 315          
 316          
 317          char CH_middle[8];
 318          bit ratio_mode;
 319          u8 CH_ratio[2][8];
 320          u8 New_ratio[2][4]={60,60,60,60,60,60,60,60};
 321          u8 CH_inverted[8];
 322          u8 CH_middle_change=0;
 323          
 324          
 325          u8 mixer_name;
 326          bit mixer1,mixer2,mixer3,mixer4;
 327          u8 mixer1_same,mixer1_contrary;
 328          u8 mixer2_same,mixer2_contrary;
 329          u8 mixer3_same,mixer3_contrary;
 330          u8 mixer4_same,mixer4_contrary;
 331          
 332          
 333          
 334          
 335          
 336          
 337          //曲线运算
 338          u8 curve_buff[51];
 339          u8 index_number=0;
 340          bit index_change;
 341          char last_index;
 342          char CH_index[3];
 343          
 344          u8 point_num=3,curve_num=0;
 345          u8 turnning_point[5][7];
 346          u16 throttle;
 347          
 348          
 349          
 350          /***********************************************************/
 351          //延时函数
 352          
 353          void Delay1ms()         //@12.000MHz
 354          {
 355   1              unsigned char i, j;
 356   1              i = 12;
 357   1              j = 168;
 358   1              do
 359   1              {
 360   2                      while (--j);
 361   2              } while (--i);
 362   1      }
 363          
 364          void delay_ms(u16 i)    //延时毫秒
 365          {
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 7   

 366   1              while(i--)
 367   1              Delay1ms();
 368   1      }
 369          
 370          /**********************************************************/
 371          //ROM操作函数、数据读写控制
 372          
 373          u8 EEPROM_read(u8 address_H,u16 address_L)      //读数据
 374          {
 375   1              IAP_CMD=0x01;
 376   1              if(address_L>255)
 377   1              {
 378   2                      IAP_ADDRH=address_H+1;
 379   2                      IAP_ADDRL=address_L-255;        
 380   2              }
 381   1              else 
 382   1              {
 383   2                      IAP_ADDRH=address_H;
 384   2                      IAP_ADDRL=address_L;    
 385   2              }
 386   1              
 387   1              IAP_TRIG=0x5a;                  
 388   1              IAP_TRIG=0xa5; _nop_();
 389   1              return IAP_DATA;
 390   1      }
 391          
 392          void EEPROM_write(u8 address_H,u16 address_L,u8 byte)   //写入数据
 393          {
 394   1              IAP_CMD=0x02;
 395   1              IAP_DATA=byte;
 396   1              if(address_L>255)
 397   1              {
 398   2                      IAP_ADDRH=address_H+1;
 399   2                      IAP_ADDRL=address_L-255;        
 400   2              }
 401   1              else 
 402   1              {
 403   2                      IAP_ADDRH=address_H;
 404   2                      IAP_ADDRL=address_L;    
 405   2              }
 406   1      
 407   1              IAP_TRIG=0x5a;
 408   1              IAP_TRIG=0xa5; _nop_();
 409   1              
 410   1      }
 411          
 412          void EEPROM_clean(u8 address_H) //擦除数据
 413          {
 414   1              IAP_CMD=0x03;
 415   1              IAP_ADDRH=address_H;
 416   1              IAP_ADDRL=0;
 417   1              IAP_TRIG=0x5a;
 418   1              IAP_TRIG=0xa5;_nop_();
 419   1      }
 420          
 421          void Data_change(u8 m)//数据改变
 422          {
 423   1              if(m==1)Data_system=1;
 424   1              if(m==2)Data_model=1;
 425   1              
 426   1              event3=1,t3=0;//刷新事件3定时器
 427   1              
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 8   

 428   1      }
 429          
 430          void DATA_read1()       //读取系统参数
 431          {                                                               
 432   1              u8 i;u16 sum=0,sum_read;
 433   1              
 434   1              IAP_CONTR=0x83;
 435   1              /**
 436   1              +军刀破+
 437   1              将原来的74改为78，增加回传报警内容
 438   1              **/
 439   1              for(i=0;i<78;i++)
 440   1              {
 441   2                      sum+=EEPROM_read(0,i);
 442   2              }
 443   1              
 444   1              sum_read=EEPROM_read(0,78);//读校验和
 445   1              sum_read<<=8;
 446   1              sum_read+=EEPROM_read(0,79);
 447   1              
 448   1              if(EEPROM_read(0,0)!=Version||sum!=sum_read)     
 449   1              {
 450   2                      first=1;
 451   2                      
 452   2                      
 453   2                      RC_TX=1;PPM_OUT=1;
 454   2      
 455   2              }
 456   1              else
 457   1              {
 458   2      //              system=EEPROM_read(0,1);
 459   2                      Battery_1s=EEPROM_read(0,2);
 460   2                      LCD_vop=EEPROM_read(0,3);
 461   2                      LCD_light=EEPROM_read(0,4);
 462   2                      CH1_offset=EEPROM_read(0,5);
 463   2                      CH2_offset=EEPROM_read(0,6);
 464   2                      CH3_offset=EEPROM_read(0,7);
 465   2                      CH4_offset=EEPROM_read(0,8);
 466   2                      
 467   2                      address[0]=EEPROM_read(0,9);
 468   2                      address[1]=EEPROM_read(0,10);
 469   2                      address[2]=EEPROM_read(0,11);
 470   2                      address[3]=EEPROM_read(0,12);
 471   2                      address[4]=EEPROM_read(0,13);
 472   2                      hopping[0]=EEPROM_read(0,14);
 473   2                      hopping[1]=EEPROM_read(0,15);
 474   2                      hopping[2]=EEPROM_read(0,16);
 475   2                      hopping[3]=EEPROM_read(0,17);
 476   2                      hopping[4]=EEPROM_read(0,18);
 477   2      //              
 478   2                      VLD1=EEPROM_read(0,19);
 479   2                      VLD2=EEPROM_read(0,20);
 480   2                      Sound_enable=EEPROM_read(0,21); 
 481   2                      LCD_big=EEPROM_read(0,22);
 482   2                      TX_power=EEPROM_read(0,23);
 483   2                      v_trim1=EEPROM_read(0,24);
 484   2                      v_trim2=EEPROM_read(0,25);
 485   2                      clock_set=EEPROM_read(0,26);
 486   2                      
 487   2                      boot_screen=EEPROM_read(0,27);
 488   2      //              Right_throttle=EEPROM_read(0,28);
 489   2              
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 9   

 490   2                      Throttle_check=EEPROM_read(0,29);
 491   2      
 492   2                      Auto_lock=EEPROM_read(0,30);
 493   2                      clock_switch=EEPROM_read(0,31);
 494   2                      ratio_switch=EEPROM_read(0,32);
 495   2                      PPM_offset=EEPROM_read(0,33);
 496   2                      boot_screen_en=EEPROM_read(0,34);
 497   2                      LCD_reverse=EEPROM_read(0,35);
 498   2                      Return_alarm_switch=EEPROM_read(0,36);
 499   2      /*              NRF_mapping[7]=EEPROM_read(0,37);*/
 500   2                      
 501   2                      PPM_mapping[0]=EEPROM_read(0,38);
 502   2                      PPM_mapping[1]=EEPROM_read(0,39);
 503   2                      PPM_mapping[2]=EEPROM_read(0,40);
 504   2                      PPM_mapping[3]=EEPROM_read(0,41);
 505   2                      PPM_mapping[4]=EEPROM_read(0,42);
 506   2                      PPM_mapping[5]=EEPROM_read(0,43);
 507   2                      PPM_mapping[6]=EEPROM_read(0,44);
 508   2                      PPM_mapping[7]=EEPROM_read(0,45);
 509   2      
 510   2                      train_switch=EEPROM_read(0,46);
 511   2                      RC_TX=EEPROM_read(0,47);
 512   2                      Model_number=EEPROM_read(0,48);Model_current=Model_number;
 513   2                      PPM_OUT=EEPROM_read(0,49);
 514   2                      PPM_IN=EEPROM_read(0,50);
 515   2                      
 516   2                      auto_switch=EEPROM_read(0,51);
 517   2                      auto_star=EEPROM_read(0,52);
 518   2                      auto_end=EEPROM_read(0,53);
 519   2                      auto_middle=EEPROM_read(0,54);
 520   2      //              auto_mapping=EEPROM_read(0,55);
 521   2                      auto_speed=EEPROM_read(0,56);
 522   2                      
 523   2                      New_ratio[0][0]=EEPROM_read(0,57);
 524   2                      New_ratio[0][1]=EEPROM_read(0,58);
 525   2                      New_ratio[0][2]=EEPROM_read(0,59);
 526   2                      New_ratio[0][3]=EEPROM_read(0,60);
 527   2                      New_ratio[1][0]=EEPROM_read(0,61);
 528   2                      New_ratio[1][1]=EEPROM_read(0,62);
 529   2                      New_ratio[1][2]=EEPROM_read(0,63);
 530   2                      New_ratio[1][3]=EEPROM_read(0,64);
 531   2                      
 532   2                      Com_Swt_IN1=EEPROM_read(0,65);
 533   2                      Com_Swt_IN2=EEPROM_read(0,66);
 534   2                      Com_Swt_mapping=EEPROM_read(0,67);
 535   2                      Com_Swt_out[0]=EEPROM_read(0,68);
 536   2                      Com_Swt_out[1]=EEPROM_read(0,69);
 537   2                      Com_Swt_out[2]=EEPROM_read(0,70);
 538   2                      Com_Swt_out[3]=EEPROM_read(0,71);
 539   2                      Com_Swt_out[4]=EEPROM_read(0,72);
 540   2                      Com_Swt_out[5]=EEPROM_read(0,73);
 541   2                      /***************+军刀破+****************/
 542   2                      //读取回传报警值
 543   2                      Power_V=EEPROM_read(0,74); //报警动力电压
 544   2                      Chip_V=EEPROM_read(0,75);       //IC电压
 545   2                      TX_min=EEPROM_read(0,76);       //最小发射信号
 546   2                      RX_min=EEPROM_read(0,77);       //最小接收信号
 547   2                      /***************+军刀破+****************/               
 548   2                      
 549   2              }
 550   1              
 551   1      
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 10  

 552   1              IAP_CONTR=0;
 553   1      }
 554          
 555          
 556          void DATA_save1()       //保存系统参数
 557          {
 558   1              u8 i;u16 sum=0;
 559   1              
 560   1              IAP_CONTR=0x83;
 561   1      
 562   1              
 563   1              
 564   1                      EEPROM_clean(0);
 565   1                      EEPROM_write(0,0,Version);
 566   1      
 567   1      //              EEPROM_write(0,1,system);
 568   1                      EEPROM_write(0,2,Battery_1s);
 569   1                      EEPROM_write(0,3,LCD_vop);
 570   1                      EEPROM_write(0,4,LCD_light);
 571   1                      EEPROM_write(0,5,CH1_offset);
 572   1                      EEPROM_write(0,6,CH2_offset);
 573   1                      EEPROM_write(0,7,CH3_offset);
 574   1                      EEPROM_write(0,8,CH4_offset);
 575   1              
 576   1                      EEPROM_write(0,9,address[0]);
 577   1                      EEPROM_write(0,10,address[1]);
 578   1                      EEPROM_write(0,11,address[2]);
 579   1                      EEPROM_write(0,12,address[3]);
 580   1                      EEPROM_write(0,13,address[4]);
 581   1                      EEPROM_write(0,14,hopping[0]);
 582   1                      EEPROM_write(0,15,hopping[1]);
 583   1                      EEPROM_write(0,16,hopping[2]);
 584   1                      EEPROM_write(0,17,hopping[3]);
 585   1                      EEPROM_write(0,18,hopping[4]);
 586   1                      
 587   1                      EEPROM_write(0,19,VLD1);
 588   1                      EEPROM_write(0,20,VLD2);
 589   1                      EEPROM_write(0,21,Sound_enable);
 590   1      
 591   1                      
 592   1      
 593   1                      EEPROM_write(0,22,LCD_big);
 594   1                      EEPROM_write(0,23,TX_power);
 595   1                      EEPROM_write(0,24,v_trim1);
 596   1                      EEPROM_write(0,25,v_trim2);
 597   1      
 598   1                      EEPROM_write(0,26,clock_set);
 599   1                      EEPROM_write(0,27,boot_screen);
 600   1      //              EEPROM_write(0,28,Right_throttle);
 601   1                      EEPROM_write(0,29,Throttle_check);
 602   1      
 603   1                      EEPROM_write(0,30,Auto_lock);
 604   1                      EEPROM_write(0,31,clock_switch);
 605   1                      EEPROM_write(0,32,ratio_switch);
 606   1                      EEPROM_write(0,33,PPM_offset);
 607   1                      EEPROM_write(0,34,boot_screen_en);
 608   1                      EEPROM_write(0,35,LCD_reverse);
 609   1                      EEPROM_write(0,36,Return_alarm_switch);
 610   1      /*              EEPROM_write(0,37,NRF_mapping[7]);*/
 611   1                      
 612   1                      EEPROM_write(0,38,PPM_mapping[0]);
 613   1                      EEPROM_write(0,39,PPM_mapping[1]);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 11  

 614   1                      EEPROM_write(0,40,PPM_mapping[2]);
 615   1                      EEPROM_write(0,41,PPM_mapping[3]);
 616   1                      EEPROM_write(0,42,PPM_mapping[4]);
 617   1                      EEPROM_write(0,43,PPM_mapping[5]);
 618   1                      EEPROM_write(0,44,PPM_mapping[6]);
 619   1                      EEPROM_write(0,45,PPM_mapping[7]);
 620   1                      
 621   1                      EEPROM_write(0,46,train_switch);
 622   1      
 623   1                      EEPROM_write(0,47,RC_TX);
 624   1                      EEPROM_write(0,48,Model_number);
 625   1                      EEPROM_write(0,49,PPM_OUT);
 626   1                      EEPROM_write(0,50,PPM_IN);
 627   1                      
 628   1                      EEPROM_write(0,51,auto_switch);
 629   1                      EEPROM_write(0,52,auto_star);
 630   1                      EEPROM_write(0,53,auto_end);
 631   1                      EEPROM_write(0,54,auto_middle);
 632   1      //              EEPROM_write(0,55,auto_mapping);
 633   1                      EEPROM_write(0,56,auto_speed);
 634   1                      
 635   1                      EEPROM_write(0,57,New_ratio[0][0]);
 636   1                      EEPROM_write(0,58,New_ratio[0][1]);
 637   1                      EEPROM_write(0,59,New_ratio[0][2]);
 638   1                      EEPROM_write(0,60,New_ratio[0][3]);
 639   1                      EEPROM_write(0,61,New_ratio[1][0]);
 640   1                      EEPROM_write(0,62,New_ratio[1][1]);
 641   1                      EEPROM_write(0,63,New_ratio[1][2]);
 642   1                      EEPROM_write(0,64,New_ratio[1][3]);
 643   1                      
 644   1                      EEPROM_write(0,65,Com_Swt_IN1);
 645   1                      EEPROM_write(0,66,Com_Swt_IN2);
 646   1                      EEPROM_write(0,67,Com_Swt_mapping);
 647   1                      EEPROM_write(0,68,Com_Swt_out[0]);
 648   1                      EEPROM_write(0,69,Com_Swt_out[1]);
 649   1                      EEPROM_write(0,70,Com_Swt_out[2]);
 650   1                      EEPROM_write(0,71,Com_Swt_out[3]);
 651   1                      EEPROM_write(0,72,Com_Swt_out[4]);
 652   1                      EEPROM_write(0,73,Com_Swt_out[5]);
 653   1                      /****+军刀破+****/
 654   1                      EEPROM_write(0,74,Power_V); //报警动力电压
 655   1                      EEPROM_write(0,75,Chip_V);      //IC电压
 656   1                      EEPROM_write(0,76,TX_min);      //最小发射信号
 657   1                      EEPROM_write(0,77,RX_min);      //最小接收信号
 658   1                      /***************+军刀破+****************/
 659   1              //将原来的74改为78，增加保存回传报警内容        
 660   1              for(i=0;i<78;i++)
 661   1              {
 662   2                      sum+=EEPROM_read(0,i);
 663   2              }
 664   1              EEPROM_write(0,78,sum>>8);
 665   1              EEPROM_write(0,79,sum); 
 666   1                      
 667   1              IAP_CONTR=0;
 668   1      }
 669          
 670          
 671          void Model_data_reset()//模型数据复位
 672          {
 673   1              u8 i;
 674   1              for(i=0;i<8;i++)
 675   1                      CH_middle[i]=0;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 12  

 676   1              
 677   1              for(i=0;i<8;i++)                
 678   1                      CH_ratio[0][i]=100;
 679   1              
 680   1              for(i=0;i<8;i++)                
 681   1                      CH_ratio[1][i]=100;
 682   1              
 683   1              for(i=0;i<8;i++)
 684   1                      CH_inverted[i]=0;
 685   1                      
 686   1                      mixer1=0;
 687   1                      mixer2=0;
 688   1                      mixer3=0;
 689   1                      mixer4=0;
 690   1                      mixer1_same=1;
 691   1                      mixer1_contrary=0;
 692   1                      mixer2_same=2;
 693   1                      mixer2_contrary=3;
 694   1                      mixer3_same=3;
 695   1                      mixer3_contrary=0;
 696   1                      mixer4_same=5;
 697   1                      mixer4_contrary=0;
 698   1              
 699   1              for(i=0;i<6;i++)
 700   1                      IN_mapping[i]=i;
 701   1      
 702   1                      IN_mapping[6]=7;
 703   1                      IN_mapping[7]=8;
 704   1                      
 705   1              for(i=0;i<8;i++)        
 706   1                      NRF_mapping[i]=i;
 707   1                      
 708   1              for(i=0;i<8;i++)
 709   1                      receiver_mode[i]=0;
 710   1                      
 711   1              for(i=0;i<8;i++)
 712   1                      out_control[i]=0;
 713   1                      
 714   1              out_control[2]=-100;
 715   1      
 716   1              CH_index[0]=0;
 717   1              CH_index[1]=0;
 718   1              CH_index[2]=0;
 719   1              for(i=0;i<5;i++)
 720   1              {
 721   2                      turnning_point[i][0]=0;
 722   2                      turnning_point[i][1]=16;
 723   2                      turnning_point[i][2]=32;
 724   2                      turnning_point[i][3]=50;
 725   2                      turnning_point[i][4]=68;
 726   2                      turnning_point[i][5]=84;
 727   2                      turnning_point[i][6]=100;
 728   2              }
 729   1              /***************+军刀破+****************/
 730   1              //置空模型名
 731   1              for(i=0;i<7;i++)
 732   1              {
 733   2                      Model_name[i]=0;
 734   2              }
 735   1              /**************************************/
 736   1      
 737   1      }
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 13  

 738          
 739          u16 Model_adress(u16 num)//模型数据基地址
 740          {
 741   1              if(num>2)num-=3,Model_addrH=4;
 742   1              else Model_addrH=2;
 743   1      
 744   1              if(num==0)num=0;
 745   1              else if(num==1)num=Model_length;
 746   1              else num=Model_length*2;
 747   1              
 748   1              return num;
 749   1      }
 750          
 751          void DATA_read2()       //读取模型数据
 752          {
 753   1              u16 i,base;
 754   1              u16 sum,sum_read;
 755   1              
 756   1              IAP_CONTR=0x83;
 757   1              base=Model_adress(Model_current);       //读出所有数据
 758   1              for(i=0;i<Model_length*3;i++)
 759   1              {
 760   2                      TEMP_DATA[i]=EEPROM_read(Model_addrH,i);        
 761   2              }
 762   1              
 763   1              sum=0;
 764   1              for(i=base;i<base+Model_length-2;i++)//计算校验和
 765   1              {
 766   2                      sum+=TEMP_DATA[i];
 767   2              }
 768   1              sum_read=TEMP_DATA[base+Model_length-2];//读校验和
 769   1              sum_read<<=8;
 770   1              sum_read+=TEMP_DATA[base+Model_length-1];
 771   1              
 772   1              if(TEMP_DATA[base]!=Version||sum!=sum_read)//比较校验和
 773   1              {
 774   2                      Model_data_reset();
 775   2              }
 776   1              else
 777   1              {
 778   2                      
 779   2                              
 780   2                              CH_middle[0]=TEMP_DATA[1+base];                         //读出目标模型数据
 781   2                              CH_middle[1]=TEMP_DATA[2+base];
 782   2                              CH_middle[2]=TEMP_DATA[3+base];
 783   2                              CH_middle[3]=TEMP_DATA[4+base];
 784   2                              CH_middle[4]=TEMP_DATA[5+base];
 785   2                              CH_middle[5]=TEMP_DATA[6+base];
 786   2                              CH_middle[6]=TEMP_DATA[7+base];
 787   2                              CH_middle[7]=TEMP_DATA[8+base];
 788   2                              CH_ratio[0][0]=TEMP_DATA[9+base];
 789   2                              CH_ratio[0][1]=TEMP_DATA[10+base];
 790   2                              CH_ratio[0][2]=TEMP_DATA[11+base];
 791   2                              CH_ratio[0][3]=TEMP_DATA[12+base];
 792   2                              CH_ratio[0][4]=TEMP_DATA[13+base];
 793   2                              CH_ratio[0][5]=TEMP_DATA[14+base];
 794   2                              CH_ratio[0][6]=TEMP_DATA[15+base];
 795   2                              CH_ratio[0][7]=TEMP_DATA[16+base];
 796   2                              CH_ratio[1][0]=TEMP_DATA[17+base];
 797   2                              CH_ratio[1][1]=TEMP_DATA[18+base];
 798   2                              CH_ratio[1][2]=TEMP_DATA[19+base];
 799   2                              CH_ratio[1][3]=TEMP_DATA[20+base];
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 14  

 800   2                              CH_ratio[1][4]=TEMP_DATA[21+base];
 801   2                              CH_ratio[1][5]=TEMP_DATA[22+base];
 802   2                              CH_ratio[1][6]=TEMP_DATA[23+base];
 803   2                              CH_ratio[1][7]=TEMP_DATA[24+base];                      
 804   2                              CH_inverted[0]=TEMP_DATA[25+base];
 805   2                              CH_inverted[1]=TEMP_DATA[26+base];
 806   2                              CH_inverted[2]=TEMP_DATA[27+base];
 807   2                              CH_inverted[3]=TEMP_DATA[28+base];
 808   2                              CH_inverted[4]=TEMP_DATA[29+base];
 809   2                              CH_inverted[5]=TEMP_DATA[30+base];
 810   2                              CH_inverted[6]=TEMP_DATA[31+base];
 811   2                              CH_inverted[7]=TEMP_DATA[32+base];
 812   2                              mixer1=TEMP_DATA[33+base];
 813   2                              mixer2=TEMP_DATA[34+base];
 814   2                              mixer3=TEMP_DATA[35+base];
 815   2                              mixer4=TEMP_DATA[36+base];
 816   2                              mixer1_same=TEMP_DATA[37+base];
 817   2                              mixer1_contrary=TEMP_DATA[38+base];
 818   2                              mixer2_same=TEMP_DATA[39+base];
 819   2                              mixer2_contrary=TEMP_DATA[40+base];
 820   2                              mixer3_same=TEMP_DATA[41+base];
 821   2                              mixer3_contrary=TEMP_DATA[42+base];
 822   2                              mixer4_same=TEMP_DATA[43+base];
 823   2                              mixer4_contrary=TEMP_DATA[44+base];
 824   2                              
 825   2                              IN_mapping[0]=TEMP_DATA[45+base];
 826   2                              IN_mapping[1]=TEMP_DATA[46+base];
 827   2                              IN_mapping[2]=TEMP_DATA[47+base];
 828   2                              IN_mapping[3]=TEMP_DATA[48+base];
 829   2                              IN_mapping[4]=TEMP_DATA[49+base];
 830   2                              IN_mapping[5]=TEMP_DATA[50+base];
 831   2                              IN_mapping[6]=TEMP_DATA[51+base];
 832   2                              IN_mapping[7]=TEMP_DATA[52+base];
 833   2                              NRF_mapping[0]=TEMP_DATA[53+base];
 834   2                              NRF_mapping[1]=TEMP_DATA[54+base];
 835   2                              NRF_mapping[2]=TEMP_DATA[55+base];
 836   2                              NRF_mapping[3]=TEMP_DATA[56+base];
 837   2                              NRF_mapping[4]=TEMP_DATA[57+base];
 838   2                              NRF_mapping[5]=TEMP_DATA[58+base];
 839   2                              NRF_mapping[6]=TEMP_DATA[59+base];
 840   2                              NRF_mapping[7]=TEMP_DATA[60+base];
 841   2                              receiver_mode[0]=TEMP_DATA[61+base];
 842   2                              receiver_mode[1]=TEMP_DATA[62+base];
 843   2                              receiver_mode[2]=TEMP_DATA[63+base];
 844   2                              receiver_mode[3]=TEMP_DATA[64+base];
 845   2                              receiver_mode[4]=TEMP_DATA[65+base];
 846   2                              receiver_mode[5]=TEMP_DATA[66+base];
 847   2                              receiver_mode[6]=TEMP_DATA[67+base];
 848   2                              receiver_mode[7]=TEMP_DATA[68+base];
 849   2                              out_control[0]=TEMP_DATA[69+base];
 850   2                              out_control[1]=TEMP_DATA[70+base];
 851   2                              out_control[2]=TEMP_DATA[71+base];
 852   2                              out_control[3]=TEMP_DATA[72+base];
 853   2                              out_control[4]=TEMP_DATA[73+base];
 854   2                              out_control[5]=TEMP_DATA[74+base];
 855   2                              out_control[6]=TEMP_DATA[75+base];
 856   2                              out_control[7]=TEMP_DATA[76+base];
 857   2                              
 858   2                              CH_index[0]=TEMP_DATA[77+base];
 859   2                              CH_index[1]=TEMP_DATA[78+base];
 860   2                              CH_index[2]=TEMP_DATA[79+base];
 861   2                              turnning_point[0][0]=TEMP_DATA[80+base];
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 15  

 862   2                              turnning_point[0][1]=TEMP_DATA[81+base];
 863   2                              turnning_point[0][2]=TEMP_DATA[82+base];
 864   2                              turnning_point[0][3]=TEMP_DATA[83+base];
 865   2                              turnning_point[0][4]=TEMP_DATA[84+base];
 866   2                              turnning_point[0][5]=TEMP_DATA[85+base];
 867   2                              turnning_point[0][6]=TEMP_DATA[86+base];
 868   2                              
 869   2                              turnning_point[1][0]=TEMP_DATA[87+base];
 870   2                              turnning_point[1][1]=TEMP_DATA[88+base];
 871   2                              turnning_point[1][2]=TEMP_DATA[89+base];
 872   2                              turnning_point[1][3]=TEMP_DATA[90+base];
 873   2                              turnning_point[1][4]=TEMP_DATA[91+base];
 874   2                              turnning_point[1][5]=TEMP_DATA[92+base];
 875   2                              turnning_point[1][6]=TEMP_DATA[93+base];
 876   2                              
 877   2                              turnning_point[2][0]=TEMP_DATA[94+base];
 878   2                              turnning_point[2][1]=TEMP_DATA[95+base];
 879   2                              turnning_point[2][2]=TEMP_DATA[96+base];
 880   2                              turnning_point[2][3]=TEMP_DATA[97+base];
 881   2                              turnning_point[2][4]=TEMP_DATA[98+base];
 882   2                              turnning_point[2][5]=TEMP_DATA[99+base];
 883   2                              turnning_point[2][6]=TEMP_DATA[100+base];
 884   2                              
 885   2                              turnning_point[3][0]=TEMP_DATA[101+base];
 886   2                              turnning_point[3][1]=TEMP_DATA[102+base];
 887   2                              turnning_point[3][2]=TEMP_DATA[103+base];
 888   2                              turnning_point[3][3]=TEMP_DATA[104+base];
 889   2                              turnning_point[3][4]=TEMP_DATA[105+base];
 890   2                              turnning_point[3][5]=TEMP_DATA[106+base];
 891   2                              turnning_point[3][6]=TEMP_DATA[107+base];
 892   2                              
 893   2                              turnning_point[4][0]=TEMP_DATA[108+base];
 894   2                              turnning_point[4][1]=TEMP_DATA[109+base];
 895   2                              turnning_point[4][2]=TEMP_DATA[110+base];
 896   2                              turnning_point[4][3]=TEMP_DATA[111+base];
 897   2                              turnning_point[4][4]=TEMP_DATA[112+base];
 898   2                              turnning_point[4][5]=TEMP_DATA[113+base];
 899   2                              turnning_point[4][6]=TEMP_DATA[114+base];
 900   2                              /*************+军刀破+************/
 901   2                              //读模型名
 902   2                              Model_name[0]=TEMP_DATA[115+base];
 903   2                              Model_name[1]=TEMP_DATA[116+base];
 904   2                              Model_name[2]=TEMP_DATA[117+base];
 905   2                              Model_name[3]=TEMP_DATA[118+base];
 906   2                              Model_name[4]=TEMP_DATA[119+base];
 907   2                              Model_name[5]=TEMP_DATA[120+base];
 908   2                              Model_name[6]=TEMP_DATA[121+base];
 909   2                              /*************+军刀破+************/
 910   2              }
 911   1      
 912   1              IAP_CONTR=0;
 913   1      }
 914          
 915          void DATA_save2()       //保存模型数据
 916          {
 917   1              u16 i,base;
 918   1              u16 sum;
 919   1              IAP_CONTR=0x83;
 920   1              base=Model_adress(Model_current);
 921   1                      EEPROM_clean(Model_addrH);
 922   1                      
 923   1                              TEMP_DATA[base]=Version;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 16  

 924   1      
 925   1                              TEMP_DATA[1+base]=CH_middle[0]; //修改目标模型数据
 926   1                              TEMP_DATA[2+base]=CH_middle[1];
 927   1                              TEMP_DATA[3+base]=CH_middle[2];
 928   1                              TEMP_DATA[4+base]=CH_middle[3];
 929   1                              TEMP_DATA[5+base]=CH_middle[4];
 930   1                              TEMP_DATA[6+base]=CH_middle[5];
 931   1                              TEMP_DATA[7+base]=CH_middle[6];
 932   1                              TEMP_DATA[8+base]=CH_middle[7];
 933   1                              TEMP_DATA[9+base]=CH_ratio[0][0];
 934   1                              TEMP_DATA[10+base]=CH_ratio[0][1];
 935   1                              TEMP_DATA[11+base]=CH_ratio[0][2];
 936   1                              TEMP_DATA[12+base]=CH_ratio[0][3];
 937   1                              TEMP_DATA[13+base]=CH_ratio[0][4];
 938   1                              TEMP_DATA[14+base]=CH_ratio[0][5];
 939   1                              TEMP_DATA[15+base]=CH_ratio[0][6];
 940   1                              TEMP_DATA[16+base]=CH_ratio[0][7];
 941   1                              TEMP_DATA[17+base]=CH_ratio[1][0];
 942   1                              TEMP_DATA[18+base]=CH_ratio[1][1];
 943   1                              TEMP_DATA[19+base]=CH_ratio[1][2];
 944   1                              TEMP_DATA[20+base]=CH_ratio[1][3];
 945   1                              TEMP_DATA[21+base]=CH_ratio[1][4];
 946   1                              TEMP_DATA[22+base]=CH_ratio[1][5];
 947   1                              TEMP_DATA[23+base]=CH_ratio[1][6];
 948   1                              TEMP_DATA[24+base]=CH_ratio[1][7];                      
 949   1                              TEMP_DATA[25+base]=CH_inverted[0];
 950   1                              TEMP_DATA[26+base]=CH_inverted[1];
 951   1                              TEMP_DATA[27+base]=CH_inverted[2];
 952   1                              TEMP_DATA[28+base]=CH_inverted[3];
 953   1                              TEMP_DATA[29+base]=CH_inverted[4];
 954   1                              TEMP_DATA[30+base]=CH_inverted[5];
 955   1                              TEMP_DATA[31+base]=CH_inverted[6];
 956   1                              TEMP_DATA[32+base]=CH_inverted[7];
 957   1                              TEMP_DATA[33+base]=mixer1;
 958   1                              TEMP_DATA[34+base]=mixer2;
 959   1                              TEMP_DATA[35+base]=mixer3;
 960   1                              TEMP_DATA[36+base]=mixer4;
 961   1                              TEMP_DATA[37+base]=mixer1_same;
 962   1                              TEMP_DATA[38+base]=mixer1_contrary;
 963   1                              TEMP_DATA[39+base]=mixer2_same;
 964   1                              TEMP_DATA[40+base]=mixer2_contrary;
 965   1                              TEMP_DATA[41+base]=mixer3_same;
 966   1                              TEMP_DATA[42+base]=mixer3_contrary;
 967   1                              TEMP_DATA[43+base]=mixer4_same;
 968   1                              TEMP_DATA[44+base]=mixer4_contrary;
 969   1                              
 970   1                              TEMP_DATA[45+base]=IN_mapping[0];
 971   1                              TEMP_DATA[46+base]=IN_mapping[1];
 972   1                              TEMP_DATA[47+base]=IN_mapping[2];
 973   1                              TEMP_DATA[48+base]=IN_mapping[3];
 974   1                              TEMP_DATA[49+base]=IN_mapping[4];
 975   1                              TEMP_DATA[50+base]=IN_mapping[5];
 976   1                              TEMP_DATA[51+base]=IN_mapping[6];
 977   1                              TEMP_DATA[52+base]=IN_mapping[7];
 978   1                              TEMP_DATA[53+base]=NRF_mapping[0];
 979   1                              TEMP_DATA[54+base]=NRF_mapping[1];
 980   1                              TEMP_DATA[55+base]=NRF_mapping[2];
 981   1                              TEMP_DATA[56+base]=NRF_mapping[3];
 982   1                              TEMP_DATA[57+base]=NRF_mapping[4];
 983   1                              TEMP_DATA[58+base]=NRF_mapping[5];
 984   1                              TEMP_DATA[59+base]=NRF_mapping[6];
 985   1                              TEMP_DATA[60+base]=NRF_mapping[7];
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 17  

 986   1                              TEMP_DATA[61+base]=receiver_mode[0];
 987   1                              TEMP_DATA[62+base]=receiver_mode[1];
 988   1                              TEMP_DATA[63+base]=receiver_mode[2];
 989   1                              TEMP_DATA[64+base]=receiver_mode[3];
 990   1                              TEMP_DATA[65+base]=receiver_mode[4];
 991   1                              TEMP_DATA[66+base]=receiver_mode[5];
 992   1                              TEMP_DATA[67+base]=receiver_mode[6];
 993   1                              TEMP_DATA[68+base]=receiver_mode[7];
 994   1                              TEMP_DATA[69+base]=out_control[0];
 995   1                              TEMP_DATA[70+base]=out_control[1];
 996   1                              TEMP_DATA[71+base]=out_control[2];
 997   1                              TEMP_DATA[72+base]=out_control[3];
 998   1                              TEMP_DATA[73+base]=out_control[4];
 999   1                              TEMP_DATA[74+base]=out_control[5];
1000   1                              TEMP_DATA[75+base]=out_control[6];
1001   1                              TEMP_DATA[76+base]=out_control[7];
1002   1                              
1003   1                              TEMP_DATA[77+base]=CH_index[0];
1004   1                              TEMP_DATA[78+base]=CH_index[1];
1005   1                              TEMP_DATA[79+base]=CH_index[2];
1006   1                              TEMP_DATA[80+base]=turnning_point[0][0];
1007   1                              TEMP_DATA[81+base]=turnning_point[0][1];
1008   1                              TEMP_DATA[82+base]=turnning_point[0][2];
1009   1                              TEMP_DATA[83+base]=turnning_point[0][3];
1010   1                              TEMP_DATA[84+base]=turnning_point[0][4];
1011   1                              TEMP_DATA[85+base]=turnning_point[0][5];
1012   1                              TEMP_DATA[86+base]=turnning_point[0][6];
1013   1                              
1014   1                              TEMP_DATA[87+base]=turnning_point[1][0];
1015   1                              TEMP_DATA[88+base]=turnning_point[1][1];
1016   1                              TEMP_DATA[89+base]=turnning_point[1][2];
1017   1                              TEMP_DATA[90+base]=turnning_point[1][3];
1018   1                              TEMP_DATA[91+base]=turnning_point[1][4];
1019   1                              TEMP_DATA[92+base]=turnning_point[1][5];
1020   1                              TEMP_DATA[93+base]=turnning_point[1][6];
1021   1                              
1022   1                              TEMP_DATA[94+base]=turnning_point[2][0];
1023   1                              TEMP_DATA[95+base]=turnning_point[2][1];
1024   1                              TEMP_DATA[96+base]=turnning_point[2][2];
1025   1                              TEMP_DATA[97+base]=turnning_point[2][3];
1026   1                              TEMP_DATA[98+base]=turnning_point[2][4];
1027   1                              TEMP_DATA[99+base]=turnning_point[2][5];
1028   1                              TEMP_DATA[100+base]=turnning_point[2][6];
1029   1                              
1030   1                              TEMP_DATA[101+base]=turnning_point[3][0];
1031   1                              TEMP_DATA[102+base]=turnning_point[3][1];
1032   1                              TEMP_DATA[103+base]=turnning_point[3][2];
1033   1                              TEMP_DATA[104+base]=turnning_point[3][3];
1034   1                              TEMP_DATA[105+base]=turnning_point[3][4];
1035   1                              TEMP_DATA[106+base]=turnning_point[3][5];
1036   1                              TEMP_DATA[107+base]=turnning_point[3][6];
1037   1                              
1038   1                              TEMP_DATA[108+base]=turnning_point[4][0];
1039   1                              TEMP_DATA[109+base]=turnning_point[4][1];
1040   1                              TEMP_DATA[110+base]=turnning_point[4][2];
1041   1                              TEMP_DATA[111+base]=turnning_point[4][3];
1042   1                              TEMP_DATA[112+base]=turnning_point[4][4];
1043   1                              TEMP_DATA[113+base]=turnning_point[4][5];
1044   1                              TEMP_DATA[114+base]=turnning_point[4][6];
1045   1                              /*************+军刀破+************/
1046   1                              //模型名
1047   1                              TEMP_DATA[115+base]=Model_name[0];
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 18  

1048   1                              TEMP_DATA[116+base]=Model_name[1];
1049   1                              TEMP_DATA[117+base]=Model_name[2];
1050   1                              TEMP_DATA[118+base]=Model_name[3];
1051   1                              TEMP_DATA[119+base]=Model_name[4];
1052   1                              TEMP_DATA[120+base]=Model_name[5];
1053   1                              TEMP_DATA[121+base]=Model_name[6];
1054   1                              /*************+军刀破+************/
1055   1                              
1056   1                                                      
1057   1      
1058   1              sum=0;
1059   1              for(i=base;i<base+Model_length-2;i++)//计算校验和
1060   1              {
1061   2                      sum+=TEMP_DATA[i];
1062   2              }
1063   1              TEMP_DATA[Model_length-2+base]=sum>>8;//写入校验和
1064   1              TEMP_DATA[Model_length-1+base]=sum;
1065   1              
1066   1      
1067   1              for(i=0;i<Model_length*3;i++)
1068   1              {
1069   2                      EEPROM_write(Model_addrH,i,TEMP_DATA[i]);       //写入所有数据
1070   2              }
1071   1              IAP_CONTR=0;
1072   1      }
1073          
1074          /**************************************************************************/
1075          //NRF24L01+
1076          u8 SPI(u8 byte)
1077          {
1078   1              u8 i;
1079   1              for(i=0;i<8;i++)
1080   1              {
1081   2                      MDI=(byte&0x80);
1082   2                      SCK=1;
1083   2                      byte<<=1;
1084   2                      byte|=MDO;
1085   2                      SCK=0;
1086   2              }
1087   1              return byte;
1088   1      }
1089          
1090          void REG_write(u8 address,u8 command)
1091          {
1092   1              CSN=0;
1093   1              SPI(0x20+address);
1094   1              SPI(command);
1095   1              CSN=1;
1096   1      }
1097          
1098          u8 REG_read(u8 address)
1099          {
1100   1              u8 m;
1101   1              CSN=0;
1102   1              SPI(address);
1103   1              m=SPI(0);
1104   1              CSN=1;
1105   1              return m;
1106   1      }
1107          
1108          void FIFO_write(u8 DATA_OUT[],u8 lengh)
1109          {
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 19  

1110   1              u8 i;
1111   1              CSN=0;
1112   1              SPI(0xa0);
1113   1              for(i=0;i<lengh;i++)
1114   1              SPI(DATA_OUT[i]);
1115   1              CSN=1;
1116   1      }
1117          void FIFO_write2(u8 DATA_OUT[],u8 lengh)
1118          {
1119   1              u8 i;
1120   1              CSN=0;
1121   1              SPI(0xa0);
1122   1              for(i=0;i<lengh;i++)
1123   1              SPI(DATA_OUT[i]);
1124   1              CSN=1;
1125   1      }
1126          void FIFO_read(u8 DATA_IN[],u8 lengh)           //读取接收数据缓冲区
1127          {
1128   1              u8 i;
1129   1              CSN=0;
1130   1              SPI(0x61);      //读取命令
1131   1              for(i=0;i<lengh;i++)
1132   1              DATA_IN[i]=SPI(0);         
1133   1              CSN=1;
1134   1      }
1135          void FIFO_read2(u8 DATA_IN[],u8 lengh)          //读取接收数据缓冲区
1136          {
1137   1              u8 i;
1138   1              CSN=0;
1139   1              SPI(0x61);      //读取命令
1140   1              for(i=0;i<lengh;i++)
1141   1              DATA_IN[i]=SPI(0);         
1142   1              CSN=1;
1143   1      }
1144          void TX_address(u8 DATA_IN[])
1145          {
1146   1              CSN=0;           
1147   1              SPI(0x20+0x10);
1148   1              SPI(DATA_IN[0]);
1149   1              SPI(DATA_IN[1]);
1150   1              SPI(DATA_IN[2]);
1151   1              SPI(DATA_IN[3]);
1152   1              SPI(DATA_IN[4]);
1153   1              CSN=1;  
1154   1      }  
1155          void RX_address(u8 DATA_IN[])
1156          {
1157   1              CSN=0;           
1158   1              SPI(0x20+0x0a);
1159   1              SPI(DATA_IN[0]);
1160   1              SPI(DATA_IN[1]);
1161   1              SPI(DATA_IN[2]);
1162   1              SPI(DATA_IN[3]);
1163   1              SPI(DATA_IN[4]);
1164   1              CSN=1;  
1165   1      }
1166          void RX_mode()                           
1167          {
1168   1              CE=0;
1169   1              REG_write(0x00,0x3b); //CRC,8 bit,Power on,RX
1170   1              CE=1;
1171   1      }                                  
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 20  

1172                  
1173          void TX_mode()                           
1174          {
1175   1              CE=0;
1176   1              REG_write(0x00,0x0a);
1177   1        CE=1;
1178   1      }
1179          
1180          void  NRF_power(u8 P)                           //发射功率设置
1181          {
1182   1              CE=0;
1183   1              if(P==3)REG_write(0x06,0x27);             //0db 修正之前注释错误
1184   1              else if(P==2)REG_write(0x06,0x25);        //-6db
1185   1              else if(P==1)REG_write(0x06,0x23);        //-12db
1186   1              else if(P==0)REG_write(0x06,0x21);    //-18db
1187   1              CE=1;
1188   1      }
1189          
1190          void NRF_size(u8 l)
1191          {
1192   1              CE=0;
1193   1              REG_write(0x11,l);  
1194   1              CE=1;
1195   1      }
1196          
1197          void NRF_channel(u8 c)
1198          {
1199   1              CE=0;
1200   1              REG_write(0x05,c);  
1201   1              CE=1;
1202   1      }
1203          
1204          
1205          void NRF_init()
1206          {       
1207   1              CE=0;
1208   1              SCK=0;
1209   1              REG_write(0x01,0x00); //禁止 自动应答
1210   1              REG_write(0x02,0x01); //允许 P0信道
1211   1              REG_write(0x04,0x00); //禁止 自动重发
1212   1              TX_mode(); //REG_write(0x1d,0x01);                       
1213   1              NRF_channel(66);
1214   1              NRF_power(TX_power);
1215   1              NRF_size(11);
1216   1              TX_address(address);
1217   1              RX_address(address);
1218   1      }
1219          
1220          void NRF_test() //无线模块终极测试
1221          {       
1222   1              u8 reset_err=0;
1223   1              
1224   1              if(MDO==0){NRF_error|=0x02;}//MOSI bad
1225   1              if(MDI==0)NRF_error|=0x10;              //MISO bad
1226   1              if(IRQ==0)NRF_error|=0x08;      //IRQ bad
1227   1                      if(CSN==0)NRF_error|=0x01;//CSN,CLK bad
1228   1              
1229   1              CE=0;
1230   1              SCK=0;
1231   1              CSN=0;
1232   1              
1233   1              if(SPI(0x20)!=0x0e){reset_err=1;}
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 21  

1234   1              SPI(0x0a);
1235   1      
1236   1              CSN=1;
1237   1      
1238   1              CSN=0;
1239   1              SPI(0x00);
1240   1      
1241   1              if(SPI(0x00)!=0x0a){NRF_error|=0x02;}//MOSI bad
1242   1              CSN=1;
1243   1      
1244   1              REG_write(0x01,0x00);
1245   1              REG_write(0x04,0x00);
1246   1              REG_write(0x11,1);
1247   1              
1248   1              FIFO_write(tx_buff,1);
1249   1              CE=1;
1250   1      
1251   1              delay_ms(2);
1252   1              
1253   1              CSN=0;
1254   1      
1255   1              if(SPI(0x00)!=0x2e){NRF_error|=0x04;}//CE bad
1256   1              CSN=1;
1257   1                      
1258   1              if(IRQ)NRF_error|=0x18; //IRQ bad
1259   1              else 
1260   1              {
1261   2                      if(NRF_error&0x04==0)NRF_error|=0x10;           //MISO bad
1262   2              }
1263   1              CE=1;
1264   1              
1265   1              if(reset_err&&NRF_error>1)NRF_error|=0x01;//CSN,CLK bad
1266   1              
1267   1              REG_write(0x07,0x20);   //清除TX中断信号
1268   1      }
1269          
1270          void device_connect()
1271          {
1272   1              u8 n;
1273   1              
1274   1              RC_TX=0;
1275   1               
1276   1              tx_order[0]=0xa0;
1277   1              tx_order[1]=hopping[0];
1278   1              tx_order[2]=hopping[1];
1279   1              tx_order[3]=hopping[2];
1280   1              tx_order[4]=hopping[3];
1281   1              tx_order[5]=hopping[4];
1282   1              tx_order[6]=address[0];
1283   1              tx_order[7]=address[1];
1284   1              tx_order[8]=address[2];
1285   1              tx_order[9]=address[3];
1286   1              tx_order[10]=address[4];        
1287   1                       
1288   1              NRF_channel(33);
1289   1              NRF_power(0);
1290   1              NRF_size(11);
1291   1              TX_address(address_0);
1292   1              RX_address(address_0);
1293   1              
1294   1              cancel=0;connecting=1;
1295   1              while(!cancel&connecting)                                        //把对频信息发给接收机，若收到回复表面通信成功，
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 22  

1296   1              {                                                                //收不到继续发送
1297   2                      TX_mode();
1298   2                      FIFO_write(tx_order,11);
1299   2                      Delay1ms();
1300   2                      RX_mode();
1301   2                      
1302   2                      while(1)
1303   2                      {               
1304   3                              Delay1ms();
1305   3                              if(IRQ==0)
1306   3                              {
1307   4                                      FIFO_read(rx,11);               //读取接收数据
1308   4                                      CE=0;
1309   4                                      REG_write(0x07,0x40);   //清除RX中断信号
1310   4                                      CE=1;   
1311   4                                      if(rx[0]=='O'&&rx[1]=='K')
1312   4                                      {
1313   5                                              cancel=0;connecting=0;
1314   5                                      }
1315   4                              }
1316   3                                      
1317   3                              n++;if(n>50){n=0;break;}
1318   3                      }
1319   2              }
1320   1      
1321   1      
1322   1              RC_TX=1;
1323   1              NRF_power(TX_power);//恢复发射状态
1324   1              NRF_size(11);
1325   1              TX_address(address);
1326   1              RX_address(address); 
1327   1                               
1328   1      }
1329          
1330          
1331          
1332          
1333          
1334          
1335          /***********************************************/
1336          //12864液晶操作函数
1337          void LCD(u8 D)
1338          {
1339   1              DATA=D;
1340   1              CLK=0;SDA=D_7;CLK=1;
1341   1              CLK=0;SDA=D_6;CLK=1;
1342   1              CLK=0;SDA=D_5;CLK=1;
1343   1              CLK=0;SDA=D_4;CLK=1;
1344   1              CLK=0;SDA=D_3;CLK=1;
1345   1              CLK=0;SDA=D_2;CLK=1;
1346   1              CLK=0;SDA=D_1;CLK=1;
1347   1              CLK=0;SDA=D_0;CLK=1;
1348   1              CLK=0;
1349   1      }
1350          
1351          
1352          void location(u8 x,u8 y)
1353          {
1354   1              RS=0;
1355   1              if(LCD_reverse)
1356   1              {
1357   2                      if(LCD_big)x+=3;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 23  

1358   2                      else x+=4;
1359   2              }
1360   1              else
1361   1              {
1362   2                      if(LCD_big)x++; 
1363   2              }
1364   1              
1365   1              LCD(0xb0+y);
1366   1              LCD(((x>>4)&0x0f)+0x10);
1367   1              LCD(x&0x0f);
1368   1              RS=1;
1369   1      }
1370          
1371          void LCD_ON()
1372          {CS=0;}
1373          
1374          void LCD_OFF()
1375          {CS=1;}
1376          
1377          void LCD_clean(u8 x,u8 y,u8 length,u8 width)//清空指定区域
1378          {
1379   1              u8 i,j;
1380   1        for(i=0;i<width;i++)
1381   1        {
1382   2                      location(x,i+y);
1383   2                      for(j=0;j<length;j++)
1384   2                LCD(0);
1385   2        }
1386   1      }
1387          
1388          void LCD_init()
1389          {
1390   1        LCD_ON();
1391   1              
1392   1              RST=0;
1393   1        delay_ms(2);
1394   1        RST=1;
1395   1        delay_ms(10);
1396   1      
1397   1        RS=0;
1398   1        LCD(0xe2);//软复位
1399   1              Delay1ms();
1400   1        
1401   1        LCD(0x2c);
1402   1              LCD(0x2e);
1403   1              LCD(0x2f);//开启升压
1404   1        LCD(0x23);//粗调对比度
1405   1        LCD(0x81);//微调对比度
1406   1        LCD(LCD_vop);
1407   1              
1408   1              LCD(0xa0);//从左到右
1409   1        LCD(0xa2);//偏压1:9 
1410   1              LCD(0xa4);//正常显示
1411   1              LCD(0xa6);//正显 
1412   1        LCD(0xc8);//从上到下
1413   1        
1414   1              if(LCD_big)LCD(0x60);//起始行2
1415   1        else LCD(0x40);//起始行1
1416   1        LCD(0xaf);
1417   1        RS=1;
1418   1              
1419   1        LCD_clean(0,0,128,8);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 24  

1420   1        LCD_OFF();
1421   1       
1422   1      }
1423          
1424          void send(u8 k)
1425          {
1426   1              u8 j;
1427   1              for(j=0;j<6;j++)
1428   1              LCD(font[k-32][j]);             
1429   1      }
1430          
1431          void send2(u8 k,u8 x,u8 y)               //写大字母
1432          {
1433   1              u8 i;
1434   1              k-=32;
1435   1              location(x,y);
1436   1              for(i=0;i<8;i++)
1437   1              {
1438   2                      LCD(font_big[k][i]);    
1439   2              }
1440   1              location(x,y+1);
1441   1              for(i=8;i<16;i++)
1442   1              {
1443   2                      LCD(font_big[k][i]);    
1444   2              }
1445   1      }
1446          
1447          /**
1448          写大字母，反显
1449          */
1450          void send2_rev(u8 k,u8 x, u8 y)
1451          {
1452   1              u8 i;
1453   1              k-=32;
1454   1              location(x,y);
1455   1              for(i=0;i<8;i++)
1456   1              {
1457   2                      LCD(~font_big[k][i]);   
1458   2              }
1459   1              location(x,y+1);
1460   1              for(i=8;i<16;i++)
1461   1              {
1462   2                      LCD(~font_big[k][i]);   
1463   2              }
1464   1      }
1465          
1466          void send2_hex(u8 k,u8 x,u8 y)
1467          {
1468   1              u8 i;
1469   1              if(k>9)
1470   1              {
1471   2                      k+=23;
1472   2                      location(x,y);
1473   2                      for(i=0;i<8;i++)
1474   2                      {
1475   3                              LCD(font_big[k][i]);    
1476   3                      }
1477   2                      location(x,y+1);
1478   2                      for(i=8;i<16;i++)
1479   2                      {
1480   3                              LCD(font_big[k][i]);    
1481   3                      }
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 25  

1482   2              }
1483   1              else
1484   1              {
1485   2                      k+=16;
1486   2                      location(x,y);
1487   2                      for(i=0;i<8;i++)
1488   2                      {
1489   3                              LCD(font_big[k][i]);    
1490   3                      }
1491   2                      location(x,y+1);
1492   2                      for(i=8;i<16;i++)
1493   2                      {
1494   3                              LCD(font_big[k][i]);    
1495   3                      }
1496   2              }
1497   1              
1498   1      }
1499          
1500          void send3(u8 *p,u8 x,u8 y)              //写汉字
1501          {
1502   1              u8 i;
1503   1              location(x,y);
1504   1              for(i=0;i<12;i++)
1505   1              {
1506   2                      LCD(*p),p++;    
1507   2              }
1508   1              location(x,y+1);
1509   1              for(i=0;i<12;i++)
1510   1              {
1511   2                      LCD(*p),p++;    
1512   2              }
1513   1      }
1514          
1515          void write(u8 x,u8 y)                   //显示汉字
1516          {
1517   1              u8 *d;
1518   1              d=word;
1519   1              while(*d)
1520   1              {               
1521   2                      send3(hzk[*d],x,y);
1522   2                      d++;x+=12;
1523   2              }
1524   1      
1525   1      }
1526          void write0(u8 *d,u8 x,u8 y)                    //显示汉字串
1527          {
1528   1      
1529   1              while(*d)
1530   1              {               
1531   2                      send3(hzk[*d],x,y);
1532   2                      d++;x+=12;
1533   2              }
1534   1      
1535   1      }
1536          /*
1537          void write2(u8 x,u8 y)                  //显示大字母
1538          {
1539                  u8 *d;
1540                  d=word;
1541                  while(*d)
1542                  {               
1543                          send2(*d,x,y);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 26  

1544                          d++;x+=8;
1545                  }
1546          
1547          }*/
1548          
1549          
1550          void photo(u8 *p,u8 x,u8 y,u8 length,u8 width)//显示指定大小的图片
1551          {
1552   1        u8 i,j;
1553   1        for(i=0;i<width;i++)
1554   1        {
1555   2                      location(x,i+y);
1556   2                      for(j=0;j<length;j++)
1557   2                LCD(*p),p++;
1558   2        }     
1559   1      }
1560          
1561          void display_trim1(u8 v,u8 base)//显示竖微调
1562          {
1563   1              u8 i;unsigned long L1,L2=0,L3,L4=0;
1564   1              L1=0x03e00000;v/=5;
1565   1              for(i=0;i<v;i++)
1566   1              {
1567   2                      if(L1&1)
1568   2                      {
1569   3                              L1>>=1,L2>>=1;L2|=0x80000000;
1570   3                      }
1571   2                      else L1>>=1,L2>>=1;
1572   2              }
1573   1              L2|=0x40000000;
1574   1      
1575   1              if(v==0)L3=0x00100000,L4=0;
1576   1              else if(v==50)L3=0,L4=0x00000100;
1577   1              else
1578   1              {
1579   2                      L3=0x02080000;L4=0;
1580   2                      for(i=1;i<v;i++)
1581   2                      {
1582   3                              if(L3&1)
1583   3                              {
1584   4                                      L3>>=1,L4>>=1;L4|=0x80000000;
1585   4                              }
1586   3                              else L3>>=1,L4>>=1;
1587   3                      }
1588   2              }
1589   1              L4|=0x40000000;
1590   1      
1591   1              location(base,7);LCD(L1>>24);LCD(L3>>24);LCD(0x03);LCD(L3>>24);LCD(L1>>24);
1592   1              location(base,6);LCD(L1>>16);LCD(L3>>16);LCD(0xff);LCD(L3>>16);LCD(L1>>16);
1593   1              location(base,5);LCD(L1>>8); LCD(L3>>8); LCD(0xff);LCD(L3>>8); LCD(L1>>8);
1594   1              location(base,4);LCD(L1);    LCD(L3);    LCD(0xff);LCD(L3);    LCD(L1);
1595   1              location(base,3);LCD(L2>>24);LCD(L4>>24);LCD(0xff);LCD(L4>>24);LCD(L2>>24);
1596   1              location(base,2);LCD(L2>>16);LCD(L4>>16);LCD(0xff);LCD(L4>>16);LCD(L2>>16);
1597   1              location(base,1);LCD(L2>>8); LCD(L4>>8); LCD(0xff);LCD(L4>>8); LCD(L2>>8);  
1598   1              location(base,0);LCD(L2);        LCD(L4);        LCD(0xf8);LCD(L4);    LCD(L2);          
1599   1      }
1600          
1601          void display_trim2(u8 v)//显示横微调
1602          {
1603   1              u8 i;char m;
1604   1              v=v/5+2;                
1605   1              for(i=0;i<55;i++)
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 27  

1606   1              {               
1607   2                      if(i==27)LCD(0x7c);
1608   2                      else
1609   2                      {
1610   3                              m=v-i;
1611   3                              if(m==3)LCD(0x38);
1612   3                              else if(m==2)LCD(0x54); 
1613   3                              else if(m==1)LCD(0x54);
1614   3                              else if(m==0)LCD(0x54);
1615   3                              else if(m==-1)LCD(0x54);
1616   3                              else if(m==-2)LCD(0x54);
1617   3                              else if(m==-3)LCD(0x38);
1618   3                              else LCD(0x10);
1619   3                      }
1620   2                      
1621   2              }
1622   1      }
1623          
1624          void display_throttle(u8 x)//显示油门
1625          {
1626   1              u8 i;long L=0;
1627   1              x=x/8;
1628   1              for(i=0;i<x;i++)
1629   1              {
1630   2                      L>>=1;
1631   2                      L|=0x80000000;
1632   2              }
1633   1              L++;
1634   1              location(9,6);LCD(L>>24);LCD(L>>24);
1635   1              location(9,5);LCD(L>>16);LCD(L>>16);
1636   1              location(9,4);LCD(L>>8);LCD(L>>8);
1637   1              location(9,3);LCD(L);LCD(L);
1638   1      }
1639          
1640          void warning(u8 x,u8 y,u8 W)//警告
1641          {
1642   1              location(x,y);
1643   1              if(W)
1644   1              {
1645   2                      LCD(0x40);LCD(0x60);LCD(0x50);LCD(0x48);LCD(0x44);LCD(0x42);LCD(0x6d);
1646   2                      LCD(0x42);LCD(0x44);LCD(0x48);LCD(0x50);LCD(0x60);LCD(0x40);    
1647   2              }
1648   1              else
1649   1              {
1650   2                      LCD(0x00);LCD(0x00);LCD(0x00);LCD(0x00);LCD(0x00);LCD(0x00);LCD(0x00);
1651   2                      LCD(0x00);LCD(0x00);LCD(0x00);LCD(0x00);LCD(0x00);LCD(0x00);
1652   2              }
1653   1              
1654   1      }
1655          
1656          void write_num100(int num,u8 x,u8 y,u8 c)//写1000内数字，c为类型选择
1657          {
1658   1              if(c=='-'||c=='/'||c=='#')
1659   1              {
1660   2                      if(num>0)send2('+',x-8,y);
1661   2                      else if(num<0)num=-num,send2('-',x-8,y);
1662   2                      else send2(' ',x-8,y);
1663   2              }
1664   1              if(num>99)send2(num/100+48,x,y);
1665   1              else send2(' ',x,y);
1666   1              send2(num%100/10+48,x+8,y);
1667   1              if(c=='.'||c=='#')
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 28  

1668   1              {
1669   2                      send2('.',x+16,y);
1670   2                      send2(num%10+48,x+24,y);
1671   2                      if(c=='#')send2('%',x+32,y);
1672   2                      
1673   2              }
1674   1              else
1675   1              {
1676   2                      send2(num%10+48,x+16,y);
1677   2                      if(c=='%'||c=='/')send2('%',x+24,y);
1678   2              }
1679   1              
1680   1      }
1681          
1682          void write_num1000(int num,u8 c)//写10000内数字
1683          {               
1684   1              
1685   1              if(num>999)
1686   1              {
1687   2                      if(c==0)send(49);
1688   2                      else num/=10;
1689   2                      
1690   2                      send(num%1000/100+48);                                                  
1691   2                      send(num%100/10+48);
1692   2                              if(c=='.')LCD(0x00),LCD(0x40);                  
1693   2                      send(num%10+48);
1694   2              }
1695   1              else 
1696   1              {
1697   2                      if(c==0)send(' ');
1698   2                      else if(c=='-')
1699   2                      {
1700   3                              if(num>0)send('+');
1701   3                              else if(num<0)num=-num,send('-');
1702   3                              else send(' ');
1703   3                      }
1704   2                      send(num%1000/100+48);
1705   2                              if(c=='.')LCD(0x00),LCD(0x40);                          
1706   2                      send(num%100/10+48);                    
1707   2                      send(num%10+48);
1708   2              }       
1709   1              
1710   1              
1711   1                                                                              
1712   1              
1713   1      }
1714          
1715          u8 move_cursor(u8 line,u8 line_max)//光标移动
1716          {
1717   1              if(last_line!=line)LCD_clean(0,0,128,8);
1718   1              last_line=line;
1719   1              
1720   1              if(up)
1721   1              {
1722   2                      up=0;
1723   2                      if(line>0)line--;
1724   2                      else line=line_max;
1725   2              }
1726   1              if(down)
1727   1              {
1728   2                      down=0;
1729   2                      if(line<line_max)line++;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 29  

1730   2                      else line=0;
1731   2              }
1732   1              
1733   1              return line;
1734   1      }
1735          
1736          /*********+军刀破+******************
1737          显示当前模型名称，当模型未有命名时，显示第几号模型，即当时系统所有的模型号数
1738          */
1739          void displayModel()
1740          {
1741   1                              u8 i=0;
1742   1                      bit have=0;
1743   1                      for(i=0;i<7;i++)
1744   1                      {
1745   2                              send2(Model_name[i]+32,70+i*8,3);
1746   2                              if(Model_name[i]>0 && Model_name[i]<=90) have=1;
1747   2                      }
1748   1              //没有命名的模型显示序号 
1749   1              if(!have)
1750   1              {
1751   2                      int idx=70;
1752   2                      if(Model_current<10)
1753   2                      {
1754   3                      send3(hzk[Model_current+81],idx,3);
1755   3                      idx+=12;
1756   3                      send3(hzk[68],idx,3);  //号
1757   3                      idx+=12;
1758   3                      send3(hzk[8],idx,3);   //模
1759   3                      idx+=12;
1760   3                      send3(hzk[159],idx,3); //型
1761   3                      }
1762   2                      else if(Model_current<19)
1763   2                      {
1764   3                              idx=64;
1765   3                              send3(hzk[90],idx,3);
1766   3                              idx+=12;
1767   3                              send3(hzk[Model_current+71],idx,3);  
1768   3                              idx+=12;
1769   3                              send3(hzk[68],idx,3);  //号
1770   3                              idx+=12;
1771   3                              send3(hzk[8],idx,3);   //模
1772   3                              idx+=12;
1773   3                              send3(hzk[159],idx,3); //型
1774   3                      }
1775   2                      else
1776   2                      {
1777   3                              idx=64;
1778   3                              send3(hzk[(Model_current+1)/10+80],idx,3);
1779   3                              idx+=12;
1780   3                              send3(hzk[90],idx,3);  
1781   3                              idx+=12;
1782   3                              send3(hzk[68],idx,3);  //号
1783   3                              idx+=12;
1784   3                              send3(hzk[8],idx,3);   //模
1785   3                              idx+=12;
1786   3                              send3(hzk[159],idx,3); //型
1787   3                      }
1788   2              }
1789   1      }
1790          /*******+军刀破+******************/
1791                  
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 30  

1792          void display_menu(u8 line,u8 line_max)//显示菜单
1793          {
1794   1              
1795   1              if(line_max<4)send3(hzk[1],0,line+line);
1796   1              else 
1797   1              {
1798   2                      if(line<3)send3(hzk[1],0,line+line);
1799   2                      else if(line==line_max)send3(hzk[1],0,6);
1800   2                      else send3(hzk[1],0,4);
1801   2              }
1802   1              
1803   1              if(line<3)
1804   1              {
1805   2                      if(line_max==2)
1806   2                      {
1807   3                              write0(WW[0],12,0);
1808   3                              write0(WW[1],12,2);
1809   3                              write0(WW[2],12,4);
1810   3                      }
1811   2                      else
1812   2                      {
1813   3                              write0(WW[0],12,0);
1814   3                              write0(WW[1],12,2);
1815   3                              write0(WW[2],12,4);
1816   3                              write0(WW[3],12,6);     
1817   3                      }
1818   2                      
1819   2              }
1820   1              else if(line==line_max)
1821   1              {
1822   2                      write0(WW[line-3],12,0);
1823   2                      write0(WW[line-2],12,2);
1824   2                      write0(WW[line-1],12,4);
1825   2                      write0(WW[line],12,6);
1826   2              }
1827   1              else if(line<line_max)
1828   1              {
1829   2                      write0(WW[line-2],12,0);
1830   2                      write0(WW[line-1],12,2);
1831   2                      write0(WW[line],12,4);
1832   2                      write0(WW[line+1],12,6);
1833   2              }
1834   1              
1835   1              
1836   1              if(line_max>=9)
1837   1              {
1838   2                      location(97,7);
1839   2                      if(line>=9)send('1'),send(line+49-10);
1840   2                      else send(' '),send(line+49);
1841   2                      
1842   2                      send('/');send('1');send(line_max+49-10);
1843   2              }
1844   1              else
1845   1              {
1846   2                      location(109,7);send(line+49);send('/');send(line_max+49);
1847   2              }       
1848   1                      
1849   1      }
1850          
1851          void display_mapping(u8 mode,u8 x,u8 y)//显示映射对象
1852          {
1853   1              switch(mode)
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 31  

1854   1              {
1855   2                      case 0:send3(hzk[96],x,y);send3(hzk[97],x+12,y);send2('1',x+24,y);break;
1856   2                      case 1:send3(hzk[96],x,y);send3(hzk[97],x+12,y);send2('2',x+24,y);break;
1857   2                      case 2:send3(hzk[96],x,y);send3(hzk[97],x+12,y);send2('3',x+24,y);break;
1858   2                      case 3:send3(hzk[96],x,y);send3(hzk[97],x+12,y);send2('4',x+24,y);break;
1859   2                      case 4:send3(hzk[100],x,y);send3(hzk[101],x+12,y);send2('1',x+24,y);break;
1860   2                      case 5:send3(hzk[100],x,y);send3(hzk[101],x+12,y);send2('2',x+24,y);break;
1861   2                      case 6:send3(hzk[100],x,y);send3(hzk[101],x+12,y);send2('3',x+24,y);break;
1862   2                      case 7:send3(hzk[58],x,y);send3(hzk[59],x+12,y);send2('A',x+24,y);break;
1863   2                      case 8:send3(hzk[58],x,y);send3(hzk[59],x+12,y);send2('B',x+24,y);break;
1864   2                      case 9:send3(hzk[58],x,y);send3(hzk[59],x+12,y);send2('C',x+24,y);break;
1865   2                      case 10:send3(hzk[58],x,y);send3(hzk[59],x+12,y);send2('D',x+24,y);break;
1866   2                      case 11:send3(hzk[58],x,y);send3(hzk[59],x+12,y);send2('E',x+24,y);break;
1867   2                      
1868   2                      case 12:send3(hzk[104],x,y);send3(hzk[105],x+12,y);send2('1',x+24,y);break;
1869   2      /*              case 14:send3(hzk[104],x,y);send3(hzk[105],x+12,y);send2('2',x+24,y);break;*/
1870   2                      case 13:send2('P',x,y);send2('P',x+8,y);send2('M',x+16,y);send2('1',x+24,y);break;
1871   2                      case 14:send2('P',x,y);send2('P',x+8,y);send2('M',x+16,y);send2('2',x+24,y);break;
1872   2                      case 15:send2('P',x,y);send2('P',x+8,y);send2('M',x+16,y);send2('3',x+24,y);break;
1873   2                      case 16:send2('P',x,y);send2('P',x+8,y);send2('M',x+16,y);send2('4',x+24,y);break;
1874   2                      case 17:send2('P',x,y);send2('P',x+8,y);send2('M',x+16,y);send2('5',x+24,y);break;
1875   2                      case 18:send2('P',x,y);send2('P',x+8,y);send2('M',x+16,y);send2('6',x+24,y);break;
1876   2                      case 19:send2('P',x,y);send2('P',x+8,y);send2('M',x+16,y);send2('7',x+24,y);break;
1877   2                      case 20:send2('P',x,y);send2('P',x+8,y);send2('M',x+16,y);send2('8',x+24,y);break;
1878   2              }
1879   1              
1880   1      }
1881          
1882          void display_receiver_mode(u8 mode,u8 x,u8 y)//显示接收机模式
1883          {
1884   1              switch(mode)
1885   1              {
1886   2                      case 0:send3(hzk[36],x,y);send3(hzk[37],x+12,y);break;
1887   2                      case 1:send3(hzk[175],x,y);send3(hzk[180],x+12,y);break;
1888   2                      case 2:send2('P',x,y);send2('W',x+8,y);send2('M',x+16,y);break;
1889   2                      case 3:send2('P',x,y);send2('P',x+8,y);send2('M',x+16,y);break;
1890   2                      case 4:send2('S',x,y);send2('.',x+8,y);send2('B',x+16,y);break;
1891   2              }       
1892   1      }
1893          
1894          void display_switch(u8 sw,u8 x,u8 y)//显示开关
1895          {
1896   1              switch(sw)
1897   1              {
1898   2                      case 0:send2(' ',x,y);send2('-',x+4,y);send3(hzk[10],x+12,y);send2('-',x+24,y);break;
1899   2                      case 1:send3(hzk[58],x,y);send3(hzk[59],x+12,y);send2('A',x+24,y);break;
1900   2                      case 2:send3(hzk[58],x,y);send3(hzk[59],x+12,y);send2('B',x+24,y);break;
1901   2                      case 3:send3(hzk[58],x,y);send3(hzk[59],x+12,y);send2('C',x+24,y);break;
1902   2                      case 4:send3(hzk[58],x,y);send3(hzk[59],x+12,y);send2('D',x+24,y);break;
1903   2                      case 5:send3(hzk[58],x,y);send3(hzk[59],x+12,y);send2('E',x+24,y);break;
1904   2              }
1905   1      }
1906          
1907          void display_bar(int *p)//显示条形图
1908          {
1909   1              u8 i,j;
1910   1              for(i=0;i<8;i++)
1911   1              {
1912   2                      location(20,i);LCD(0x3e);LCD(0x41);
1913   2                      for(j=0;j<103;j++)
1914   2                      {
1915   3                              
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 32  

1916   3                              if(j==8)LCD(0x7f);
1917   3                              else if(j==51)LCD(0x7f);
1918   3                              else if(j==94)LCD(0x7f);
1919   3                              else if(j>51)
1920   3                              {
1921   4                                      if(j>*p/10)LCD(0x41);
1922   4                                      else LCD(0x5d);
1923   4                              }
1924   3                              else if(j<51)
1925   3                              {
1926   4                                      if(j>*p/10)LCD(0x5d);
1927   4                                      else LCD(0x41);
1928   4                              }       
1929   3                              
1930   3                      }
1931   2                      LCD(0x41);LCD(0x3e);
1932   2                      p++;
1933   2              }
1934   1      
1935   1      }
1936          
1937          void point(u8 x,u8 z,u8 line)                     //画点
1938          {
1939   1              u8 d0=0,d1=0,d2=0,d3=0,d4=0,d5=0,d6=0,d7=0;
1940   1              
1941   1              if(z<8)
1942   1              {
1943   2                      d0=0x80;d0>>=z;                 
1944   2              }
1945   1              else if(z<16)
1946   1              {
1947   2                      d1=0x80;d1>>=z-8;       
1948   2              }
1949   1              else if(z<24)
1950   1              {
1951   2                      d2=0x80;d2>>=z-16;      
1952   2              }
1953   1              else if(z<32)
1954   1              {
1955   2                      d3=0x80;d3>>=z-24;      
1956   2              }
1957   1              else if(z<40)
1958   1              {
1959   2                      d4=0x80;d4>>=z-32;      
1960   2              }
1961   1              else if(z<48)
1962   1              {
1963   2                      d5=0x80;d5>>=z-40;      
1964   2              }
1965   1              else if(z<56)
1966   1              {
1967   2                      d6=0x80;d6>>=z-48;      
1968   2              }
1969   1              else if(z<64)
1970   1              {
1971   2                      d7=0x80;d7>>=z-56;      
1972   2              }
1973   1              
1974   1              if(x==line)
1975   1              {
1976   2                      d0=0x3f,d1=0xff,d2=0xff,d3=0xff,d4=0xff,d5=0xff,d6=0xff,d7=0xf8;
1977   2              }
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 33  

1978   1              if(x<3)
1979   1              {
1980   2                      d0|=0x80;d7|=0x02;
1981   2              }
1982   1              else if(x>47)
1983   1              {
1984   2                      d0|=0x80;d7|=0x02;
1985   2              } 
1986   1              
1987   1              
1988   1              d3|=0x01;
1989   1              
1990   1              if(x==0)
1991   1              {
1992   2                      location(73,0);LCD(0x1e);LCD(0x02);
1993   2                      location(73,7);LCD(0xf0);LCD(0x80);
1994   2                      location(126,0);LCD(0x02);LCD(0x1e);
1995   2                      location(126,7);LCD(0x80);LCD(0xf0);    
1996   2              }
1997   1              
1998   1              location(75+x,0);LCD(d7);
1999   1              location(75+x,1);LCD(d6);
2000   1              location(75+x,2);LCD(d5);
2001   1              location(75+x,3);LCD(d4);
2002   1              location(75+x,4);LCD(d3);
2003   1              location(75+x,5);LCD(d2);
2004   1              location(75+x,6);LCD(d1);
2005   1              location(75+x,7);LCD(d0);
2006   1      }
2007          
2008          void display_curve() //显示指数曲线
2009          {
2010   1              u8 i;
2011   1                      
2012   1      
2013   1              point(25,31,25);
2014   1              for(i=0;i<25;i++)
2015   1              {
2016   2      
2017   2                      point(i+26,curve_buff[i]+31,25);
2018   2                      point(24-i,31-curve_buff[i],25);                
2019   2      
2020   2              }
2021   1              
2022   1      }
2023          
2024          
2025          
2026          void display_curve2() //显示折线曲线
2027          {
2028   1              u8 i,n;
2029   1              
2030   1      
2031   1              if(point_num==0)n=0;
2032   1              if(point_num==1)n=8;
2033   1              if(point_num==2)n=16;
2034   1              if(point_num==3)n=25;
2035   1              if(point_num==4)n=34;
2036   1              if(point_num==5)n=42;
2037   1              if(point_num==6)n=50;
2038   1      
2039   1              for(i=0;i<51;i++)
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 34  

2040   1              {
2041   2      
2042   2                      point(i,curve_buff[i]+6,n);
2043   2                      
2044   2              }
2045   1              
2046   1      }
2047          
2048          
2049          
2050          /************************************************************************/
2051          //数据运算函数
2052          /*
2053          void data_check(int x,int max,int min)
2054          {
2055                  
2056                  if(x>max)x=max;
2057                  if(x<min)x=min;
2058          
2059          }
2060          */
2061          
2062          
2063          void Xdata_check(int *p)//坑爹的STC Xdata，只能用指针来调用，否则会出错
2064          {
2065   1              u8 i;
2066   1              for(i=0;i<8;i++)
2067   1              {
2068   2                      if(*p>1023)*p=1023;
2069   2                      if(*p<0)*p=0; 
2070   2                      p++;
2071   2              }
2072   1              
2073   1      }
2074          
2075          u8 rounding(float x)//四舍五入
2076          {
2077   1              u8 y;
2078   1              y=x;
2079   1              if((x-y)>0.5)y++;
2080   1              return y;
2081   1      }
2082          
2083          void get_curve(float index)//计算指数曲线
2084          {
2085   1              u8 i;
2086   1              
2087   1              if(index>=0)
2088   1              {
2089   2                      index=index/100+1;
2090   2                      
2091   2                      for(i=1;i<26;i++)
2092   2                      {
2093   3      
2094   3                              
2095   3                              curve_buff[i-1]=rounding(pow(i*0.04,index)*25);
2096   3      
2097   3                      }
2098   2              }
2099   1              else if(index<0)
2100   1              {
2101   2                      index=-index/100+1;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 35  

2102   2                      for(i=1;i<26;i++)
2103   2                      {
2104   3      
2105   3                              
2106   3                              curve_buff[i-1]=rounding(25-pow(1-i*0.04,index)*25);
2107   3      
2108   3                      }
2109   2              }
2110   1              
2111   1              
2112   1      }
2113          
2114          void get_curve2()//油门曲线数据
2115          {
2116   1              
2117   1              int i;
2118   1              u8 b[7];
2119   1              for(i=0;i<7;i++)
2120   1              {
2121   2                      b[i]=turnning_point[curve_num][i]/2;
2122   2              }
2123   1              
2124   1              
2125   1              for(i=0;i<51;i++)
2126   1              {
2127   2                      if(i<8)
2128   2                      {
2129   3      
2130   3                              curve_buff[i]=i*(b[1]-b[0])/8+b[0];
2131   3                      }
2132   2                      else if(i<16)
2133   2                      {
2134   3      
2135   3                              curve_buff[i]=(i-8)*(b[2]-b[1])/8+b[1];
2136   3                      }
2137   2                      
2138   2                      else if(i<25)
2139   2                      {
2140   3      
2141   3                              curve_buff[i]=(i-16)*(b[3]-b[2])/9+b[2];
2142   3                      }
2143   2                      else if(i<34)
2144   2                      {
2145   3      
2146   3                              curve_buff[i]=(i-25)*(b[4]-b[3])/9+b[3];
2147   3                      }
2148   2                      else if(i<42)
2149   2                      {
2150   3      
2151   3                              curve_buff[i]=(i-34)*(b[5]-b[4])/8+b[4];
2152   3                      }
2153   2                      else
2154   2                      {
2155   3      
2156   3                              curve_buff[i]=(i-42)*(b[6]-b[5])/8+b[5];
2157   3                      }                       
2158   2              }
2159   1      }
2160          
2161          void function_size(u8 num,u8 mode)//舵量函数
2162          {
2163   1              u8 r0,r1;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 36  

2164   1              if(mode)
2165   1              {
2166   2                      r0=New_ratio[0][num];
2167   2                      r1=New_ratio[1][num];
2168   2              }
2169   1              else
2170   1              {
2171   2                      r0=CH_ratio[0][num];
2172   2                      r1=CH_ratio[1][num];
2173   2              }
2174   1              
2175   1              if(operation[num]>0)
2176   1              {
2177   2                      operation[num]=(long)operation[num]*r1/100;
2178   2              }
2179   1              else
2180   1              {
2181   2                      operation[num]=(long)operation[num]*r0/100;
2182   2              }
2183   1              
2184   1      }
2185          
2186          void function_inverted(u8 num)//反转函数
2187          {
2188   1              
2189   1              if(CH_inverted[num]==1)operation[num]=-operation[num]+CH_middle[num];
2190   1              else operation[num]+=CH_middle[num];
2191   1      }
2192          
2193          
2194          void function_mix(u8 same,u8 contrary)//混控函数 
2195          {
2196   1              int y1,y2;
2197   1              
2198   1              y1=operation[same]+operation[contrary];
2199   1              y2=operation[same]-operation[contrary];
2200   1              
2201   1              operation[same]=y1;
2202   1              operation[contrary]=y2;
2203   1                              
2204   1      }
2205          
2206          void function_curve(u8 num)//指数曲线
2207          {
2208   1              float Index;int temp;
2209   1              
2210   1              if(num==2)num++;
2211   1              if(CH_index[num]>0)
2212   1              {
2213   2                      Index=(float)CH_index[num]/100+1;
2214   2              
2215   2                      temp=operation[num];
2216   2                      if(temp<0)temp=-temp;
2217   2      
2218   2                      temp=pow(0.0023474*temp,Index)*426;
2219   2                      
2220   2                      
2221   2                      if(operation[num]<0)temp=-temp;
2222   2                      
2223   2                      operation[num]=temp;    
2224   2                      
2225   2              }
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 37  

2226   1              else if(CH_index[num]<0)
2227   1              {
2228   2                      Index=(float)-CH_index[num]/100+1;
2229   2                      
2230   2                      temp=operation[num];
2231   2                      if(temp<0)temp=-temp;
2232   2      
2233   2                      temp=426-pow(1-0.0023474*temp,Index)*426;
2234   2                      
2235   2                      
2236   2                      if(operation[num]<0)temp=-temp;
2237   2                      
2238   2                      operation[num]=temp;
2239   2              }
2240   1      
2241   1              
2242   1              
2243   1      }
2244          
2245          void function_curve2(u8 num)//多点曲线
2246          {
2247   1              u16 temp;
2248   1              int b[7];
2249   1              u8 i;
2250   1              for(i=0;i<7;i++)
2251   1              {
2252   2                      b[i]=turnning_point[num][i]*17/2;
2253   2              }
2254   1              
2255   1      
2256   1              
2257   1              if(num==0)temp=operation[2]+426;
2258   1              else temp=operation[num+3]+426;
2259   1      
2260   1              
2261   1      
2262   1                      if(temp<136)
2263   1                      {
2264   2      
2265   2                              temp=(long)temp*(b[1]-b[0])/136+b[0];
2266   2                      }
2267   1                      else if(temp<272)
2268   1                      {
2269   2      
2270   2                              temp=(long)(temp-136)*(b[2]-b[1])/136+b[1];
2271   2                      }
2272   1                      
2273   1                      else if(temp<426)
2274   1                      {
2275   2      
2276   2                              temp=(long)(temp-272)*(b[3]-b[2])/154+b[2];
2277   2                      }
2278   1                      else if(temp<580)
2279   1                      {
2280   2      
2281   2                              temp=(long)(temp-426)*(b[4]-b[3])/154+b[3];
2282   2                      }
2283   1                      else if(temp<716)
2284   1                      {
2285   2      
2286   2                              temp=(long)(temp-580)*(b[5]-b[4])/136+b[4];
2287   2                      }
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 38  

2288   1                      else
2289   1                      {
2290   2      
2291   2                              temp=(long)(temp-716)*(b[6]-b[5])/136+b[5];
2292   2                      }                       
2293   1              
2294   1              
2295   1                      
2296   1                      
2297   1              if(num==0)throttle=temp,operation[2]=temp-426;
2298   1              else operation[num+3]=temp-426;
2299   1                      
2300   1      }
2301          
2302          
2303          
2304          
2305          
2306          void function_mapping(u8 num)//输入映射
2307          {
2308   1      
2309   1              switch(IN_mapping[num])
2310   1              {
2311   2                      case 0:operation[num]=CH_value[0]*5/6-426;break;
2312   2                      case 1:operation[num]=CH_value[1]*5/6-426;break;
2313   2                      case 2:operation[num]=CH_value[2]*5/6-426;break;
2314   2                      case 3:operation[num]=CH_value[3]*5/6-426;break;
2315   2                      case 4:operation[num]=adc[1]*5/6-426;break;
2316   2                      case 5:operation[num]=adc[2]*5/6-426;break;
2317   2                      case 6:operation[num]=adc[3]*5/6-426;break;
2318   2                      
2319   2                      case 7:if(Switch_A==1)operation[num]=-426;
2320   2                                                      else if(Switch_A==2)operation[num]=0;
2321   2                                                      else operation[num]=426;break;
2322   2                      case 8:if(Switch_B==1)operation[num]=-426;
2323   2                                                      else if(Switch_B==2)operation[num]=0;
2324   2                                                      else operation[num]=426;break;
2325   2                      case 9:if(Switch_C==1)operation[num]=-426;
2326   2                                                      else if(Switch_C==2)operation[num]=0;
2327   2                                                      else operation[num]=426;break;
2328   2                      case 10:if(Switch_D==1)operation[num]=-426;
2329   2                                                      else if(Switch_D==2)operation[num]=0;
2330   2                                                      else operation[num]=426;break;
2331   2                      case 11:if(Switch_E==1)operation[num]=-426;
2332   2                                                      else if(Switch_E==2)operation[num]=0;
2333   2                                                      else operation[num]=426;break;
2334   2                      
2335   2                      /*start------改自“柴门”--------*/
2336   2                      //舵量增加时遥控首界面中的开关状态显示却是往下，改为开关在上时是舵量增加
2337   2                      /*case 7:if(Switch_A==1)operation[num]=426;
2338   2                                                      else if(Switch_A==2)operation[num]=0;
2339   2                                                      else operation[num]=-426;break;
2340   2                      case 8:if(Switch_B==1)operation[num]=426;
2341   2                                                      else if(Switch_B==2)operation[num]=0;
2342   2                                                      else operation[num]=-426;break;
2343   2                      case 9:if(Switch_C==1)operation[num]=426;
2344   2                                                      else if(Switch_C==2)operation[num]=0;
2345   2                                                      else operation[num]=-426;break;
2346   2                      case 10:if(Switch_D==1)operation[num]=426;
2347   2                                                      else if(Switch_D==2)operation[num]=0;
2348   2                                                      else operation[num]=-426;break;
2349   2                      case 11:if(Switch_E==1)operation[num]=426;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 39  

2350   2                                                      else if(Switch_E==2)operation[num]=0;
2351   2                                                      else operation[num]=-426;break;
2352   2                      *//*end------改自“柴门”--------*/
2353   2                                                      
2354   2                      case 12:operation[num]=auto_value-426;break;                            
2355   2                      case 13:operation[num]=PPM_DATA[0]-426;break;
2356   2                      case 14:operation[num]=PPM_DATA[1]-426;break;
2357   2                      case 15:operation[num]=PPM_DATA[2]-426;break;
2358   2                      case 16:operation[num]=PPM_DATA[3]-426;break;
2359   2                      case 17:operation[num]=PPM_DATA[4]-426;break;
2360   2                      case 18:operation[num]=PPM_DATA[5]-426;break;
2361   2                      case 19:operation[num]=PPM_DATA[6]-426;break;
2362   2                      case 20:operation[num]=PPM_DATA[7]-426;break;
2363   2              
2364   2              }
2365   1      }
2366          
2367          void change_trim(u8 num,u8 direction)//按键微调
2368          {
2369   1              if(direction)
2370   1              {
2371   2                      if(CH_inverted[num]==0)
2372   2                      {
2373   3                              if(CH_middle[num]<125)
2374   3                              {
2375   4                                      if(Trim_step)CH_middle[num]++;
2376   4                                      else if(CH_middle[num]%5)CH_middle[num]+=(5-CH_middle[num]%5);
2377   4                                      else CH_middle[num]+=5; 
2378   4                                      
2379   4                      //              Data_change(2);
2380   4                              }
2381   3                      }
2382   2                      else
2383   2                      {
2384   3                              if(CH_middle[num]>-125)
2385   3                              {
2386   4                                      if(Trim_step)CH_middle[num]--;
2387   4                                      else if(CH_middle[num]%5)CH_middle[num]-=(CH_middle[num]%5);
2388   4                                      else CH_middle[num]-=5;
2389   4                                      
2390   4                      //              Data_change(2);
2391   4                              }
2392   3                                      
2393   3                              
2394   3                      }       
2395   2              }
2396   1              else
2397   1              {
2398   2                      if(CH_inverted[num]==0)
2399   2                      {
2400   3                              if(CH_middle[num]>-125)
2401   3                              {
2402   4                                      if(Trim_step)CH_middle[num]--;
2403   4                                      else if(CH_middle[num]%5)CH_middle[num]-=(CH_middle[num]%5);
2404   4                                      else CH_middle[num]-=5;
2405   4                                      
2406   4                      //              Data_change(2);
2407   4                              }
2408   3                                      
2409   3                              
2410   3                      }
2411   2                      else
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 40  

2412   2                      {
2413   3                              if(CH_middle[num]<125)
2414   3                              {
2415   4                                      if(Trim_step)CH_middle[num]++;
2416   4                                      else if(CH_middle[num]%5)CH_middle[num]+=(5-CH_middle[num]%5);
2417   4                                      else CH_middle[num]+=5;
2418   4                                      
2419   4                      //              Data_change(2);
2420   4                              }
2421   3                                      
2422   3                              
2423   3                      }       
2424   2              }
2425   1      
2426   1              
2427   1              if(CH_middle[num]==0)Message_KeyTone=2;
2428   1              CH_middle_change=num,event1=1,t1=0;
2429   1      }
2430          
2431          
2432          
2433          int CH_calib(int x,u8 offset)                           //修正摇杆行程
2434          {
2435   1      
2436   1              x=512+(x-512)*51/offset;
2437   1      
2438   1              if(x>1023)x=1023;
2439   1              if(x<0)x=0;
2440   1              return x;               
2441   1      }
2442          
2443          
2444          void function_filter(u8 num)  //ADC滤波
2445          {
2446   1              if(num==0)
2447   1              {
2448   2                      adc[0]=(adc_buff[0]+(long)adc[0]*9/10);
2449   2              }
2450   1      //      else adc[num]=(adc_buff[num]*5+adc[num]*5)/10;
2451   1              else adc[num]=adc_buff[num];
2452   1      }
2453          
2454          u8 Switch_Check(u8 num)//获取开关状态
2455          {
2456   1              switch(num)
2457   1              {
2458   2                      case 1:num=Switch_A;break;
2459   2                      case 2:num=Switch_B;break;
2460   2                      case 3:num=Switch_C;break;
2461   2                      case 4:num=Switch_D;break;
2462   2                      case 5:num=Switch_E;break;
2463   2              }
2464   1              return num;
2465   1      }
2466          
2467          
2468          /**********************************************************/
2469          
2470          void UartInit(void)             //57600bps@12.000MHz
2471          {
2472   1              PCON |= 0x80;           //使能波特率倍速位SMOD
2473   1              SCON = 0x50;            //8位数据,可变波特率
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 41  

2474   1              AUXR |= 0x04;           //独立波特率发生器时钟为Fosc,即1T
2475   1              BRT = 0xF3;             //设定独立波特率发生器重装值
2476   1              AUXR |= 0x01;           //串口1选择独立波特率发生器为波特率发生器
2477   1              AUXR |= 0x10;           //启动独立波特率发生器
2478   1      }
2479          
2480          void initial()                   //硬件初始化
2481          {
2482   1              ADC_CONTR=0x80;          //ADC配置
2483   1              P1ASF=0xff;
2484   1              
2485   1              LEDA=0;
2486   1              P4SW=0x70;                       //允许P4 IO
2487   1              P2M0=0x20;                       //推挽点亮背光
2488   1              
2489   1              
2490   1      
2491   1      
2492   1              TMOD=0x11;
2493   1              TCON=0x04;           
2494   1                      
2495   1        CCAPM0=0x49;             //PCA定时器初始化
2496   1              
2497   1              value0 += 3000;    //3ms
2498   1              CCAP0L = value0;
2499   1          CCAP0H = value0>> 8;
2500   1              value0 += 3000;    //3ms
2501   1              
2502   1              value1 += 20000;           //20ms
2503   1              CCAP1L = value1;
2504   1          CCAP1H = value1>> 8;  
2505   1                      value1 += 3000;    //3ms
2506   1              
2507   1              IP=0x80;
2508   1              IPH=0x0c;                        //优先级非常重要
2509   1              
2510   1              CCON=0x40;//打开PCA定时器
2511   1              IE=0x82;
2512   1        
2513   1      }       
2514                  
2515          
2516          main()
2517          {
2518   1              int temp;u8 i;
2519   1      
2520   1              delay_ms(200);
2521   1              initial();
2522   1      /*
2523   1              while(PCON&0x20)//低压判断
2524   1              {
2525   1                      PCON=0;
2526   1                      Delay1ms();
2527   1              }
2528   1      */      
2529   1              DATA_read1();//系统数据
2530   1              DATA_read2();//模型数据
2531   1              LCD_init();
2532   1              LEDA=LCD_light;
2533   1              
2534   1              UartInit();
2535   1      
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 42  

2536   1              LCD_ON();
2537   1              
2538   1              if(KEY==0)//强制恢复出厂
2539   1              {
2540   2                      delay_ms(3000);
2541   2                      if(KEY==0)
2542   2                      {
2543   3                              IAP_CONTR=0x82;         //擦除所有数据
2544   3                              EEPROM_clean(0);
2545   3                              EEPROM_clean(2);
2546   3                              EEPROM_clean(4);
2547   3      //                      EEPROM_clean(6);
2548   3                              IAP_CONTR=0;
2549   3                              word[0]=106,word[1]=107,word[2]=32,word[3]=136,word[4]=0,write(40,2);
2550   3                              word[0]=138,word[1]=139,word[2]=140,word[3]=57,word[4]=0,write(40,4);
2551   3                              while(1);
2552   3                      }       
2553   2              }
2554   1              
2555   1              if(first)//首次开机
2556   1              {
2557   2                      while(1)//设置
2558   2                      {
2559   3                              word[0]=130,word[1]=81,word[2]=131,word[3]=58,word[4]=132,word[5]=0,write(30,0);
2560   3                              word[0]=141,word[1]=142,word[2]=18,word[3]=13,word[4]=0,write(0,2);
2561   3                              word[0]=149,word[1]=150,word[2]=137,word[3]=109,word[4]=0,write(64,2);
2562   3                              if(adc_buff[4]>510)
2563   3                              {
2564   4                                      send3(hzk[1],0,4);send2('1',12,4);send2('2',20,4);send2('L',28,4);send2('E',36,4);
2565   4                                      send3(hzk[2],0,6);send2('1',12,6);send2('2',20,6);send2('C',28,6);send2(' ',36,6);
2566   4                                      if(KEY==0)
2567   4                                      {
2568   5                                              Battery_1s=1;
2569   5                                              while(!KEY);break;
2570   5                                      }
2571   4                                      
2572   4                              }
2573   3                              else 
2574   3                              {
2575   4                                      send3(hzk[2],0,4);send2('1',12,4);send2('2',20,4);send2('L',28,4);send2('E',36,4);
2576   4                                      send3(hzk[1],0,6);send2('1',12,6);send2('2',20,6);send2('C',28,6);send2(' ',36,6);
2577   4                                      if(KEY==0)
2578   4                                      {
2579   5                                              Battery_1s=0;
2580   5                                              while(!KEY);break;
2581   5                                      }
2582   4                              }
2583   3                              delay_ms(100);
2584   3      
2585   3                      }
2586   2                      
2587   2      
2588   2                      if(hopping[0]>125)hopping[0]=(hopping[0]-5)/2;
2589   2                      if(hopping[1]>125)hopping[1]=(hopping[1]-5)/2;
2590   2                      if(hopping[2]>125)hopping[2]=(hopping[2]-5)/2;
2591   2                      if(hopping[3]>125)hopping[3]=(hopping[3]-5)/2;
2592   2                      if(hopping[4]>125)hopping[4]=(hopping[4]-5)/2;
2593   2                      
2594   2                      DATA_save1();
2595   2                      
2596   2                      word[0]=157,word[1]=132,word[2]=12,word[3]=13,word[4]=52,word[5]=53;word[6]=0,write(0,4);
2597   2                      delay_ms(500);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 43  

2598   2                      send3(hzk[1],0,6);delay_ms(200);
2599   2                      send3(hzk[1],12,6);delay_ms(200);
2600   2                      send3(hzk[1],24,6);delay_ms(200);
2601   2                      send3(hzk[1],36,6);delay_ms(200);
2602   2                      send3(hzk[1],48,6);delay_ms(200);
2603   2                      send3(hzk[1],60,6);delay_ms(200);
2604   2      
2605   2                      
2606   2              }
2607   1              else if(Throttle_check)//开机安全油门
2608   1              {
2609   2                      delay_ms(100);
2610   2                      CH_value[2]=CH_calib(adc_buff[4],CH3_offset);
2611   2                      if(CH_value[2]>80)      
2612   2                              {
2613   3                                      while(1)
2614   3                                      {
2615   4                                              if(boot_screen==0)photo(bmp5,40,2,50,4);
2616   4                                              else
2617   4                                              {
2618   5                                                      word[0]=141,word[1]=142,word[2]=185,word[3]=186,word[4]=0,write(38,4);
2619   5                                              }
2620   4                                      
2621   4                                              word[0]=147,word[1]=148,word[2]=149,word[3]=150,word[4]=151,
2622   4                                              word[5]=52,word[6]=153,word[7]=0,write(20,6); 
2623   4                              
2624   4                                              delay_ms(100);
2625   4                                              if(KEY==0)break;
2626   4                                              CH_value[2]=CH_calib(adc_buff[4],CH3_offset);
2627   4                                              if(CH_value[2]<80)break;
2628   4                                      }  
2629   3                              }       
2630   2                      
2631   2              }
2632   1              
2633   1              
2634   1              
2635   1              
2636   1              NRF_test();
2637   1              NRF_init();
2638   1              if(NRF_error)
2639   1              {
2640   2                      photo(screen2,0,0,128,8);
2641   2                      if(NRF_error&0x01)location(39,5),send(133),location(106,5),send(133);
2642   2                      if(NRF_error&0x02)location(83,5),send(133);
2643   2                      if(NRF_error&0x04)location(29,5),send(133);
2644   2                      if(NRF_error&0x08)location(64,5),send(133);
2645   2                      if(NRF_error&0x10)location(49,5),send(133);
2646   2                      delay_ms(2000);
2647   2              }
2648   1              else if(boot_screen_en)
2649   1              {
2650   2      
2651   2                      if(boot_screen==0)//开机画面
2652   2                      {
2653   3                              photo(screen3,0,0,128,8);
2654   3                              if(i<100)
2655   3                              {
2656   4                                      delay_ms(500);
2657   4                                      photo(bmp4,80,4,46,4);
2658   4                                      location(107,6);LCD(0);LCD(0x20);LCD(0xf0);LCD(0);
2659   4                                      location(107,7);LCD(0xc0);LCD(0xc8);LCD(0xcf);LCD(0xc8);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 44  

2660   4                                      delay_ms(500);
2661   4                              }
2662   3                              else if(i<200)
2663   3                              {
2664   4                                      delay_ms(1000);
2665   4                                      photo(bmp4,80,4,46,4);
2666   4                                      location(107,6);LCD(0x20);LCD(0x10);LCD(0x10);LCD(0xe0);
2667   4                                      location(107,7);LCD(0xcc);LCD(0xca);LCD(0xc9);LCD(0xc8);
2668   4                                      delay_ms(1000);
2669   4                              }
2670   3                              else 
2671   3                              {
2672   4                                      delay_ms(2000);
2673   4                                      photo(bmp4,80,4,46,4);
2674   4                                      delay_ms(1500);
2675   4                              }       
2676   3                      }
2677   2                      else if(boot_screen==1)
2678   2                      {
2679   3                              photo(screen4,0,0,128,8);
2680   3                              location(37,7);
2681   3                              for(i=0;i<50;i++)
2682   3                              {
2683   4                                      LCD(0xf7);
2684   4                                      delay_ms(40);
2685   4                              }               
2686   3                              delay_ms(500);  
2687   3                      }
2688   2      
2689   2                      
2690   2      
2691   2              }
2692   1      
2693   1      
2694   1      
2695   1              if(PPM_OUT)
2696   1              {
2697   2                      TMOD=0x11;
2698   2                      EX1=0;ET1=1;P3M0=0x08;
2699   2              }
2700   1              if(PPM_IN)
2701   1              {
2702   2                      TMOD=0x91;
2703   2                      EX1=1;ET1=0;
2704   2              }
2705   1      
2706   1              auto_max=auto_end*4.25+511;
2707   1              auto_min=auto_star*4.25+511;                     
2708   1                      
2709   1              
2710   1              TR1=1;
2711   1              TR0=1;
2712   1              delay_ms(50);
2713   1              CCAPM1=0x49;
2714   1      
2715   1      
2716   1              adc[0]=adc_buff[0]*10;
2717   1              
2718   1      //menu=1;menu_1=1;menu_2=30;
2719   1              
2720   1              
2721   1              
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 45  

2722   1              while(1)        //主函数做刷新显示、菜单处理
2723   1              {
2724   2                      
2725   2                      if(flag_20ms)
2726   2                      {
2727   3                              flag_20ms=0,tt++;
2728   3      /*************************************************************/
2729   3      //按键检测                      
2730   3                              
2731   3                              if(K1)                                  
2732   3                              {
2733   4                                      s1_press_time=0;
2734   4                                      s1_long_press=0;
2735   4                                      if(s1)                             
2736   4                                      {                                          
2737   5                                              s1=0;                     
2738   5                                              key1=1;
2739   5                                      } 
2740   4                              }
2741   3                              else 
2742   3                              {
2743   4                                      s1=1;
2744   4                                      s1_press_time++;
2745   4                                      if(s1_press_time>50)
2746   4                                      {
2747   5                                              s1_press_time=0;s1=0;
2748   5                                              s1_long_press=1;
2749   5                                      }
2750   4                              }                                 
2751   3              
2752   3                              if(K2)                                  
2753   3                              {
2754   4                                      s2_press_time=0;
2755   4                                      s2_long_press=0;
2756   4                                      if(s2)                             
2757   4                                      {                                          
2758   5                                              s2=0;                     
2759   5                                              key2=1;
2760   5                                      } 
2761   4                              }
2762   3                              else 
2763   3                              {
2764   4                                      s2=1;
2765   4                                      s2_press_time++;
2766   4                                      if(s2_press_time>50)
2767   4                                      {
2768   5                                              s2_press_time=0;s2=0;
2769   5                                              s2_long_press=1;
2770   5                                      }
2771   4                              }
2772   3                              
2773   3                              if(K3)                                  
2774   3                              {
2775   4                                      s3_press_time=0;
2776   4                                      s3_long_press=0;
2777   4                                      if(s3)                             
2778   4                                      {                                          
2779   5                                              s3=0;                     
2780   5                                              key3=1;
2781   5                                      } 
2782   4                              }
2783   3                              else 
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 46  

2784   3                              {
2785   4                                      s3=1;
2786   4                                      s3_press_time++;
2787   4                                      if(s3_press_time>50)
2788   4                                      {
2789   5                                              s3_press_time=0;s3=0;
2790   5                                              s3_long_press=1;
2791   5                                      }
2792   4                              }
2793   3                              
2794   3                              if(K4)                                  
2795   3                              {
2796   4                                      s4_press_time=0;
2797   4                                      s4_long_press=0;
2798   4                                      if(s4)                             
2799   4                                      {                                          
2800   5                                              s4=0;                     
2801   5                                              key4=1;
2802   5                                      } 
2803   4                              }
2804   3                              else 
2805   3                              {
2806   4                                      s4=1;
2807   4                                      s4_press_time++;
2808   4                                      if(s4_press_time>50)
2809   4                                      {
2810   5                                              s4_press_time=0;s4=0;
2811   5                                              s4_long_press=1;
2812   5                                      }
2813   4                              }
2814   3                              
2815   3                              if(K5)                                  
2816   3                              {
2817   4                                      s5_press_time=0;
2818   4                                      s5_long_press=0;
2819   4                                      if(s5)                             
2820   4                                      {                                          
2821   5                                              s5=0;                     
2822   5                                              key5=1;
2823   5                                      } 
2824   4                              }
2825   3                              else 
2826   3                              {
2827   4                                      s5=1;
2828   4                                      s5_press_time++;
2829   4                                      if(s5_press_time>50)
2830   4                                      {
2831   5                                              s5_press_time=0;s5=0;
2832   5                                              s5_long_press=1;
2833   5                                      }
2834   4                              }
2835   3                              
2836   3                              if(K6)                                  
2837   3                              {
2838   4                                      s6_press_time=0;
2839   4                                      s6_long_press=0;
2840   4                                      if(s6)                             
2841   4                                      {                                          
2842   5                                              s6=0;                     
2843   5                                              key6=1;
2844   5                                      } 
2845   4                              }
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 47  

2846   3                              else 
2847   3                              {
2848   4                                      s6=1;
2849   4                                      s6_press_time++;
2850   4                                      if(s6_press_time>50)
2851   4                                      {
2852   5                                              s6_press_time=0;s6=0;
2853   5                                              s6_long_press=1;
2854   5                                      }
2855   4                              }
2856   3                                      
2857   3                      
2858   3                              
2859   3                      }
2860   2                      else
2861   2                      {
2862   3                              while(!flag_20ms);
2863   3                      }
2864   2                      
2865   2                              
2866   2                      if(tt==1)//按键处理
2867   2                      {
2868   3                              
2869   3                              if(s1_long_press)
2870   3                              {
2871   4                                      key_time=!key_time;
2872   4                                      if(key_time)key1=1;
2873   4                              }
2874   3                              if(s2_long_press)
2875   3                              {
2876   4                                      key_time=!key_time;
2877   4                                      if(key_time)key2=1;
2878   4                              }
2879   3                                                      
2880   3                              if(menu==0)
2881   3                              {
2882   4                                      if(s3_long_press)
2883   4                                      {
2884   5                                              key_time=!key_time;
2885   5                                              if(key_time)key3=1;
2886   5                                      }
2887   4                                      if(s4_long_press)
2888   4                                      {
2889   5                                              key_time=!key_time;
2890   5                                              if(key_time)key4=1;
2891   5                                      }               
2892   4                              }
2893   3                              
2894   3                              if(s5_long_press)
2895   3                              {
2896   4                                      key_time=!key_time;
2897   4                                      if(key_time)key5=1;
2898   4                              }
2899   3                              if(s6_long_press)
2900   3                              {
2901   4                                      key_time=!key_time;
2902   4                                      if(key_time)key6=1;
2903   4                              }
2904   3      
2905   3                              if(key1)
2906   3                              {
2907   4                                      key1=0;Message_KeyTone=1;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 48  

2908   4                                      if(menu)decrease=1;
2909   4                                      else 
2910   4                                      {
2911   5                                              change_trim(3,0);
2912   5                                      }
2913   4                              }
2914   3                              if(key2)
2915   3                              {
2916   4                                      key2=0;Message_KeyTone=1;
2917   4                                      if(menu)increase=1;
2918   4                                      else 
2919   4                                      {
2920   5                                              change_trim(3,1);
2921   5                                      }
2922   4                              }
2923   3                              if(key3)
2924   3                              {
2925   4                                      key3=0;Message_KeyTone=1;
2926   4                                      if(menu)
2927   4                                              left=1;
2928   4                                      else 
2929   4                                      {
2930   5                                              change_trim(0,0);
2931   5                                              
2932   5                                      }
2933   4                              }
2934   3                              if(key4)
2935   3                              {
2936   4                                      key4=0;Message_KeyTone=1;
2937   4                                      if(menu)right=1;
2938   4                                      else 
2939   4                                      {
2940   5                                              change_trim(0,1);
2941   5                                              
2942   5                                      }
2943   4                              }
2944   3                              if(key5)
2945   3                              {
2946   4                                      key5=0;Message_KeyTone=1;
2947   4                                      if(menu)down=1;
2948   4                                      else 
2949   4                                      {
2950   5                                              change_trim(1,0);
2951   5                                      }
2952   4                              }
2953   3                              if(key6)
2954   3                              {
2955   4                                      key6=0;Message_KeyTone=1;
2956   4                                      if(menu)up=1;
2957   4                                      else 
2958   4                                      {
2959   5                                              change_trim(1,1);
2960   5                                      }
2961   4                              }
2962   3      
2963   3                      }
2964   2                      else if(tt==2)
2965   2                      {
2966   3                              LCD_ON();
2967   3                              if(menu)        //主菜单                         
2968   3                              {                       
2969   4                                      if(star)
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 49  

2970   4                                      {
2971   5                                              star=0;
2972   5                                              up=0,down=0,left=0,right=0,increase=0,decrease=0;
2973   5                                              LCD_clean(0,0,128,8);
2974   5                                      }
2975   4                                      
2976   4                                      
2977   4                              
2978   4                                      if(menu_1)//一级菜单
2979   4                                      {
2980   5                                                                      
2981   5                                              
2982   5                                              if(menu_2)//二级菜单
2983   5                                              {
2984   6                                              
2985   6                                                      
2986   6                                                      if(menu_3)//三级菜单
2987   6                                                      {
2988   7                                                              
2989   7                                                              
2990   7                                                              
2991   7                                                              if(menu_3==1)//新舵量
2992   7                                                              {
2993   8                                                                      line_3=move_cursor(line_3,3);
2994   8                                                                      
2995   8                                                                      WW[0][0]=94,WW[0][1]=95,WW[0][2]=81,WW[0][3]=0;
2996   8                                                                      WW[1][0]=94,WW[1][1]=95,WW[1][2]=82,WW[1][3]=0;
2997   8                                                                      WW[2][0]=94,WW[2][1]=95,WW[2][2]=83,WW[2][3]=0;
2998   8                                                                      WW[3][0]=94,WW[3][1]=95,WW[3][2]=84,WW[3][3]=0;
2999   8                                                                      
3000   8                                                                      display_menu(line_3,3);
3001   8                                                                      
3002   8                                                                      if(increase)
3003   8                                                                      {
3004   9                                                                              increase=0;
3005   9                                                                              if(New_ratio[ratio_mode][line_3]<120)
3006   9                                                                              {
3007  10                                                                                      New_ratio[ratio_mode][line_3]++;Data_change(1);
3008  10                                                                              }
3009   9                                                                              
3010   9                                                                      }
3011   8                                                                      if(decrease)
3012   8                                                                      {
3013   9                                                                              decrease=0;
3014   9                                                                              if(New_ratio[ratio_mode][line_3]>0)
3015   9                                                                              {
3016  10                                                                                      New_ratio[ratio_mode][line_3]--;Data_change(1);
3017  10                                                                              }
3018   9                                                                              
3019   9                                                                      }
3020   8                                                                      
3021   8                                                                      
3022   8                                                                              write_num100(New_ratio[ratio_mode][0],70,0,'%');
3023   8                                                                              write_num100(New_ratio[ratio_mode][1],70,2,'%');
3024   8                                                                              write_num100(New_ratio[ratio_mode][2],70,4,'%');
3025   8                                                                              write_num100(New_ratio[ratio_mode][3],70,6,'%');
3026   8                                                                      
3027   8                                                                      if(ratio_mode)
3028   8                                                                      {
3029   9                                                                              send2('+',62,0);
3030   9                                                                              send2('+',62,2);
3031   9                                                                              send2('+',62,4);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 50  

3032   9                                                                              send2('+',62,6);
3033   9                                                                      }
3034   8                                                                      else
3035   8                                                                      {
3036   9                                                                              send2('-',62,0);
3037   9                                                                              send2('-',62,2);
3038   9                                                                              send2('-',62,4);
3039   9                                                                              send2('-',62,6);
3040   9                                                                      }
3041   8                                                              
3042   8                                                              }
3043   7                                                              else if(menu_3==2)//组合舵量
3044   7                                                              {
3045   8                                                                      line_3=move_cursor(line_3,5);
3046   8                                                                      
3047   8                                                                      WW[0][0]=8,WW[0][1]=9,WW[0][2]=81,WW[0][3]=0;
3048   8                                                                      WW[1][0]=8,WW[1][1]=9,WW[1][2]=82,WW[1][3]=0;
3049   8                                                                      WW[2][0]=8,WW[2][1]=9,WW[2][2]=83,WW[2][3]=0;
3050   8                                                                      WW[3][0]=8,WW[3][1]=9,WW[3][2]=84,WW[3][3]=0;
3051   8                                                                      WW[4][0]=8,WW[4][1]=9,WW[4][2]=85,WW[4][3]=0;
3052   8                                                                      WW[5][0]=8,WW[5][1]=9,WW[5][2]=86,WW[5][3]=0;
3053   8                                                                      
3054   8                                                                      display_menu(line_3,5);
3055   8                                                                      
3056   8                                                                      if(increase)
3057   8                                                                      {
3058   9                                                                              increase=0;
3059   9                                                                              if(Com_Swt_out[line_3]<100)
3060   9                                                                              {
3061  10                                                                                      Com_Swt_out[line_3]++;Data_change(1);
3062  10                                                                              }
3063   9                                                                              
3064   9                                                                      }
3065   8                                                                      if(decrease)
3066   8                                                                      {
3067   9                                                                              decrease=0;
3068   9                                                                              if(Com_Swt_out[line_3]>0)
3069   9                                                                              {
3070  10                                                                                      Com_Swt_out[line_3]--;Data_change(1);
3071  10                                                                              }
3072   9                                                                              
3073   9                                                                      }
3074   8                                                                      
3075   8                                                                      if(line_3<3)
3076   8                                                                      {
3077   9                                                                              write_num100(Com_Swt_out[0],70,0,'%');
3078   9                                                                              write_num100(Com_Swt_out[1],70,2,'%');
3079   9                                                                              write_num100(Com_Swt_out[2],70,4,'%');
3080   9                                                                              write_num100(Com_Swt_out[3],70,6,'%');
3081   9                                                                      }
3082   8                                                                      else if(line_3<4)
3083   8                                                                      {
3084   9                                                                              write_num100(Com_Swt_out[1],70,0,'%');
3085   9                                                                              write_num100(Com_Swt_out[2],70,2,'%');
3086   9                                                                              write_num100(Com_Swt_out[3],70,4,'%');
3087   9                                                                              write_num100(Com_Swt_out[4],70,6,'%');
3088   9                                                                      }
3089   8                                                                      else
3090   8                                                                      {
3091   9                                                                              write_num100(Com_Swt_out[2],70,0,'%');
3092   9                                                                              write_num100(Com_Swt_out[3],70,2,'%');
3093   9                                                                              write_num100(Com_Swt_out[4],70,4,'%');
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 51  

3094   9                                                                              write_num100(Com_Swt_out[5],70,6,'%');
3095   9                                                                      }
3096   8                                                                              
3097   8                                                                      
3098   8                                                              }
3099   7                                                              
3100   7                                                              
3101   7                                                              
3102   7                                                              
3103   7                                                              if(left)left=0,menu_3=0;//,star=1;
3104   7                                                              increase=0;decrease=0;right=0;
3105   7                                                              
3106   7                                                      }
3107   6                                                      else
3108   6                                                      {
3109   7                                                              if(menu_2==1)//正反
3110   7                                                              {
3111   8                                                                      line_2=move_cursor(line_2,7);
3112   8                                                                      
3113   8                                                                      WW[0][0]=94,WW[0][1]=95,WW[0][2]=81,WW[0][3]=0;
3114   8                                                                      WW[1][0]=94,WW[1][1]=95,WW[1][2]=82,WW[1][3]=0;
3115   8                                                                      WW[2][0]=94,WW[2][1]=95,WW[2][2]=83,WW[2][3]=0;
3116   8                                                                      WW[3][0]=94,WW[3][1]=95,WW[3][2]=84,WW[3][3]=0;
3117   8                                                                      WW[4][0]=94,WW[4][1]=95,WW[4][2]=85,WW[4][3]=0;
3118   8                                                                      WW[5][0]=94,WW[5][1]=95,WW[5][2]=86,WW[5][3]=0;
3119   8                                                                      WW[6][0]=94,WW[6][1]=95,WW[6][2]=87,WW[6][3]=0;
3120   8                                                                      WW[7][0]=94,WW[7][1]=95,WW[7][2]=88,WW[7][3]=0;
3121   8                                                                      display_menu(line_2,7);
3122   8                                                                      
3123   8                                                                      if(line_2<3)
3124   8                                                                      {
3125   9                                                                              if(CH_inverted[0])send3(hzk[35],60,0);
3126   9                                                                              else send3(hzk[34],60,0);
3127   9                                                                              if(CH_inverted[1])send3(hzk[35],60,2);
3128   9                                                                              else send3(hzk[34],60,2);
3129   9                                                                              if(CH_inverted[2])send3(hzk[35],60,4);
3130   9                                                                              else send3(hzk[34],60,4);
3131   9                                                                              if(CH_inverted[3])send3(hzk[35],60,6);
3132   9                                                                              else send3(hzk[34],60,6);
3133   9                                                                      }
3134   8                                                                      else if(line_2==7)
3135   8                                                                      {
3136   9                                                                              if(CH_inverted[4])send3(hzk[35],60,0);
3137   9                                                                              else send3(hzk[34],60,0);
3138   9                                                                              if(CH_inverted[5])send3(hzk[35],60,2);
3139   9                                                                              else send3(hzk[34],60,2);
3140   9                                                                              if(CH_inverted[6])send3(hzk[35],60,4);
3141   9                                                                              else send3(hzk[34],60,4);
3142   9                                                                              if(CH_inverted[7])send3(hzk[35],60,6);
3143   9                                                                              else send3(hzk[34],60,6);
3144   9                                                                      }
3145   8                                                                      else
3146   8                                                                      {
3147   9                                                                              if(CH_inverted[line_2-2])send3(hzk[35],60,0);
3148   9                                                                              else send3(hzk[34],60,0);
3149   9                                                                              if(CH_inverted[line_2-1])send3(hzk[35],60,2);
3150   9                                                                              else send3(hzk[34],60,2);
3151   9                                                                              if(CH_inverted[line_2])send3(hzk[35],60,4);
3152   9                                                                              else send3(hzk[34],60,4);
3153   9                                                                              if(CH_inverted[line_2+1])send3(hzk[35],60,6);
3154   9                                                                              else send3(hzk[34],60,6);
3155   9                                                                      }
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 52  

3156   8                                                                              
3157   8                                                                              
3158   8                                                                      if(increase|decrease)
3159   8                                                                      {
3160   9                                                                              increase=0;decrease=0;
3161   9                                                                              if(CH_inverted[line_2])
3162   9                                                                              {
3163  10                                                                                      CH_inverted[line_2]=0;Data_change(2);
3164  10                                                                              }
3165   9                                                                              else
3166   9                                                                              {
3167  10                                                                                      CH_inverted[line_2]=1;Data_change(2);
3168  10                                                                              }
3169   9                                                                              
3170   9                                                                      }                                               
3171   8                                                                      
3172   8                                                                      
3173   8                                                              }
3174   7                                                              else if(menu_2==2)//舵量
3175   7                                                              {
3176   8                                                                      line_2=move_cursor(line_2,7);
3177   8                                                                      
3178   8                                                                      WW[0][0]=94,WW[0][1]=95,WW[0][2]=81,WW[0][3]=0;
3179   8                                                                      WW[1][0]=94,WW[1][1]=95,WW[1][2]=82,WW[1][3]=0;
3180   8                                                                      WW[2][0]=94,WW[2][1]=95,WW[2][2]=83,WW[2][3]=0;
3181   8                                                                      WW[3][0]=94,WW[3][1]=95,WW[3][2]=84,WW[3][3]=0;
3182   8                                                                      WW[4][0]=94,WW[4][1]=95,WW[4][2]=85,WW[4][3]=0;
3183   8                                                                      WW[5][0]=94,WW[5][1]=95,WW[5][2]=86,WW[5][3]=0;
3184   8                                                                      WW[6][0]=94,WW[6][1]=95,WW[6][2]=87,WW[6][3]=0;
3185   8                                                                      WW[7][0]=94,WW[7][1]=95,WW[7][2]=88,WW[7][3]=0;
3186   8                                                                      display_menu(line_2,7);
3187   8                                                                      
3188   8                                                                      if(increase)
3189   8                                                                      {
3190   9                                                                              increase=0;
3191   9                                                                              if(CH_ratio[ratio_mode][line_2]<120)
3192   9                                                                              {
3193  10                                                                                      CH_ratio[ratio_mode][line_2]++;Data_change(2);
3194  10                                                                              }
3195   9                                                                              
3196   9                                                                      }
3197   8                                                                      if(decrease)
3198   8                                                                      {
3199   9                                                                              decrease=0;
3200   9                                                                              if(CH_ratio[ratio_mode][line_2]>0)
3201   9                                                                              {
3202  10                                                                                      CH_ratio[ratio_mode][line_2]--;Data_change(2);
3203  10                                                                              }
3204   9                                                                              
3205   9                                                                      }
3206   8                                                                      
3207   8                                                                      if(line_2<3)
3208   8                                                                      {
3209   9                                                                              write_num100(CH_ratio[ratio_mode][0],70,0,'%');
3210   9                                                                              write_num100(CH_ratio[ratio_mode][1],70,2,'%');
3211   9                                                                              write_num100(CH_ratio[ratio_mode][2],70,4,'%');
3212   9                                                                              write_num100(CH_ratio[ratio_mode][3],70,6,'%');
3213   9                                                                      }
3214   8                                                                      else if(line_2==7)
3215   8                                                                      {
3216   9                                                                              write_num100(CH_ratio[ratio_mode][4],70,0,'%');
3217   9                                                                              write_num100(CH_ratio[ratio_mode][5],70,2,'%');
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 53  

3218   9                                                                              write_num100(CH_ratio[ratio_mode][6],70,4,'%');
3219   9                                                                              write_num100(CH_ratio[ratio_mode][7],70,6,'%');
3220   9                                                                      }
3221   8                                                                      else
3222   8                                                                      {
3223   9                                                                              write_num100(CH_ratio[ratio_mode][line_2-2],70,0,'%');
3224   9                                                                              write_num100(CH_ratio[ratio_mode][line_2-1],70,2,'%');
3225   9                                                                              write_num100(CH_ratio[ratio_mode][line_2],70,4,'%');
3226   9                                                                              write_num100(CH_ratio[ratio_mode][line_2+1],70,6,'%');
3227   9                                                                      }
3228   8                                                                      
3229   8                                                                      if(ratio_mode)
3230   8                                                                      {
3231   9                                                                              send2('+',62,0);
3232   9                                                                              send2('+',62,2);
3233   9                                                                              send2('+',62,4);
3234   9                                                                              send2('+',62,6);
3235   9                                                                      }
3236   8                                                                      else
3237   8                                                                      {
3238   9                                                                              send2('-',62,0);
3239   9                                                                              send2('-',62,2);
3240   9                                                                              send2('-',62,4);
3241   9                                                                              send2('-',62,6);
3242   9                                                                      }
3243   8                                                                      
3244   8                                                                      
3245   8                                                              }
3246   7                                                              else if(menu_2==3)//输入映射
3247   7                                                              {
3248   8                                                                      line_2=move_cursor(line_2,7);
3249   8                                                                      
3250   8                                                                      WW[0][0]=94,WW[0][1]=95,WW[0][2]=81,WW[0][3]=0;
3251   8                                                                      WW[1][0]=94,WW[1][1]=95,WW[1][2]=82,WW[1][3]=0;
3252   8                                                                      WW[2][0]=94,WW[2][1]=95,WW[2][2]=83,WW[2][3]=0;
3253   8                                                                      WW[3][0]=94,WW[3][1]=95,WW[3][2]=84,WW[3][3]=0;
3254   8                                                                      WW[4][0]=94,WW[4][1]=95,WW[4][2]=85,WW[4][3]=0;
3255   8                                                                      WW[5][0]=94,WW[5][1]=95,WW[5][2]=86,WW[5][3]=0;
3256   8                                                                      WW[6][0]=94,WW[6][1]=95,WW[6][2]=87,WW[6][3]=0;
3257   8                                                                      WW[7][0]=94,WW[7][1]=95,WW[7][2]=88,WW[7][3]=0;
3258   8                                                                      display_menu(line_2,7);
3259   8                                                                      
3260   8                                                                      send3(hzk[4],60,0);
3261   8                                                                      send3(hzk[4],60,2);
3262   8                                                                      send3(hzk[4],60,4);
3263   8                                                                      send3(hzk[4],60,6);
3264   8                                                                      
3265   8                                                                      if(increase)
3266   8                                                                      {
3267   9                                                                              increase=0;
3268   9                                                                              if(IN_mapping[line_2]<20)IN_mapping[line_2]++,Data_change(2);
3269   9                                                                      }
3270   8                                                                      if(decrease)
3271   8                                                                      {
3272   9                                                                              decrease=0;
3273   9                                                                              if(IN_mapping[line_2]>0)IN_mapping[line_2]--,Data_change(2);
3274   9                                                                      }
3275   8                                                                      
3276   8                                                                      if(line_2<3)
3277   8                                                                      {
3278   9                                                                              display_mapping(IN_mapping[0],72,0);
3279   9                                                                              display_mapping(IN_mapping[1],72,2);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 54  

3280   9                                                                              display_mapping(IN_mapping[2],72,4);
3281   9                                                                              display_mapping(IN_mapping[3],72,6);
3282   9                                                                      }
3283   8                                                                      else if(line_2==7)
3284   8                                                                      {
3285   9                                                                              display_mapping(IN_mapping[4],72,0);
3286   9                                                                              display_mapping(IN_mapping[5],72,2);
3287   9                                                                              display_mapping(IN_mapping[6],72,4);
3288   9                                                                              display_mapping(IN_mapping[7],72,6);
3289   9                                                                      }
3290   8                                                                      else 
3291   8                                                                      {
3292   9                                                                              display_mapping(IN_mapping[line_2-2],72,0);
3293   9                                                                              display_mapping(IN_mapping[line_2-1],72,2);
3294   9                                                                              display_mapping(IN_mapping[line_2],72,4);
3295   9                                                                              display_mapping(IN_mapping[line_2+1],72,6);
3296   9                                                                      }
3297   8                                                                      
3298   8                                                                      
3299   8                                                                      
3300   8                                                                      
3301   8                                                              }
3302   7                                                              else if(menu_2==4)//微调
3303   7                                                              {
3304   8                                                                      line_2=move_cursor(line_2,7);
3305   8                                                                      
3306   8                                                                      WW[0][0]=94,WW[0][1]=95,WW[0][2]=81,WW[0][3]=0;
3307   8                                                                      WW[1][0]=94,WW[1][1]=95,WW[1][2]=82,WW[1][3]=0;
3308   8                                                                      WW[2][0]=94,WW[2][1]=95,WW[2][2]=83,WW[2][3]=0;
3309   8                                                                      WW[3][0]=94,WW[3][1]=95,WW[3][2]=84,WW[3][3]=0;
3310   8                                                                      WW[4][0]=94,WW[4][1]=95,WW[4][2]=85,WW[4][3]=0;
3311   8                                                                      WW[5][0]=94,WW[5][1]=95,WW[5][2]=86,WW[5][3]=0;
3312   8                                                                      WW[6][0]=94,WW[6][1]=95,WW[6][2]=87,WW[6][3]=0;
3313   8                                                                      WW[7][0]=94,WW[7][1]=95,WW[7][2]=88,WW[7][3]=0;
3314   8                                                                      display_menu(line_2,7);
3315   8                                                                      
3316   8                                                                      if(increase)
3317   8                                                                      {
3318   9                                                                              increase=0;
3319   9                                                                              if(CH_middle[line_2]<100)
3320   9                                                                              {
3321  10                                                                                      CH_middle[line_2]++;Data_change(2);
3322  10                                                                              }
3323   9                                                                              
3324   9                                                                      }
3325   8                                                                      if(decrease)
3326   8                                                                      {
3327   9                                                                              decrease=0;
3328   9                                                                              if(CH_middle[line_2]>-100)
3329   9                                                                              {
3330  10                                                                                      CH_middle[line_2]--;Data_change(2);
3331  10                                                                              }
3332   9                                                                              
3333   9                                                                      }
3334   8                                                                      
3335   8                                                                      if(line_2<3)
3336   8                                                                      {
3337   9                                                                              write_num100(CH_middle[0],70,0,'-');
3338   9                                                                              write_num100(CH_middle[1],70,2,'-');
3339   9                                                                              write_num100(CH_middle[2],70,4,'-');
3340   9                                                                              write_num100(CH_middle[3],70,6,'-');
3341   9                                                                      }
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 55  

3342   8                                                                      else if(line_2==7)
3343   8                                                                      {
3344   9                                                                              write_num100(CH_middle[4],70,0,'-');
3345   9                                                                              write_num100(CH_middle[5],70,2,'-');
3346   9                                                                              write_num100(CH_middle[6],70,4,'-');
3347   9                                                                              write_num100(CH_middle[7],70,6,'-');
3348   9                                                                      }
3349   8                                                                      else
3350   8                                                                      {
3351   9                                                                              write_num100(CH_middle[line_2-2],70,0,'-');
3352   9                                                                              write_num100(CH_middle[line_2-1],70,2,'-');
3353   9                                                                              write_num100(CH_middle[line_2],70,4,'-');
3354   9                                                                              write_num100(CH_middle[line_2+1],70,6,'-');
3355   9                                                                      }
3356   8                              
3357   8                                                              }
3358   7                                                              else if(menu_2==5)//混控
3359   7                                                              {
3360   8                                                                      line_2=move_cursor(line_2,2);
3361   8                                                                      
3362   8                                                                      WW[0][0]=91,WW[0][1]=79,WW[0][2]=92,WW[0][3]=0;
3363   8                                                                      WW[1][0]=93,WW[1][1]=79,WW[1][2]=92,WW[1][3]=0;
3364   8                                                                      WW[2][0]=106,WW[2][1]=107,WW[2][2]=108,WW[2][3]=109;WW[2][4]=0;
3365   8                                                                      display_menu(line_2,2);
3366   8                                                                      
3367   8                                                                      if(mixer_name==1)
3368   8                                                                      {
3369   9                                                                              word[0]=110;word[1]=111;word[2]=112;word[3]=0;write(64,4);
3370   9                                                                      }
3371   8                                                                      else if(mixer_name==2)
3372   8                                                                      {
3373   9                                                                              word[0]=113;word[1]=114;word[2]=0;write(64,4);
3374   9                                                                      }
3375   8                                                                      else if(mixer_name==3)
3376   8                                                                      {
3377   9                                                                              send2('V',64,4);send3(hzk[115],72,4);
3378   9                                                                      }
3379   8                                                                      else if(mixer_name==4)
3380   8                                                                      {
3381   9                                                                              word[0]=116;word[1]=117;word[2]=112;word[3]=0;write(64,4);
3382   9                                                                      }
3383   8                                                                      
3384   8                                                                      
3385   8                                                                      
3386   8                                                                      if(line_2<1)
3387   8                                                                      {
3388   9                                                                              
3389   9                                                                              if(increase)
3390   9                                                                              {
3391  10                                                                                      increase=0;
3392  10                                                                                      if(mixer_name==1)
3393  10                                                                                      {
3394  11                                                                                              if(mixer1_same<7)mixer1_same++,Data_change(2);
3395  11                                                                                      }
3396  10                                                                                      else if(mixer_name==2)
3397  10                                                                                      {
3398  11                                                                                              if(mixer2_same<7)mixer2_same++,Data_change(2);
3399  11                                                                                      }
3400  10                                                                                      else if(mixer_name==3)
3401  10                                                                                      {
3402  11                                                                                              if(mixer3_same<7)mixer3_same++,Data_change(2);
3403  11                                                                                      }
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 56  

3404  10                                                                                      else if(mixer_name==4)
3405  10                                                                                      {
3406  11                                                                                              if(mixer4_same<7)mixer4_same++,Data_change(2);
3407  11                                                                                      }
3408  10                                                                              }
3409   9                                                                              if(decrease)
3410   9                                                                              {
3411  10                                                                                      decrease=0;
3412  10                                                                                      if(mixer_name==1)
3413  10                                                                                      {
3414  11                                                                                              if(mixer1_same>0)mixer1_same--,Data_change(2);
3415  11                                                                                      }
3416  10                                                                                      else if(mixer_name==2)
3417  10                                                                                      {
3418  11                                                                                              if(mixer2_same>0)mixer2_same--,Data_change(2);
3419  11                                                                                      }
3420  10                                                                                      else if(mixer_name==3)
3421  10                                                                                      {
3422  11                                                                                              if(mixer3_same>0)mixer3_same--,Data_change(2);
3423  11                                                                                      }
3424  10                                                                                      else if(mixer_name==4)
3425  10                                                                                      {
3426  11                                                                                              if(mixer4_same>0)mixer4_same--,Data_change(2);
3427  11                                                                                      }
3428  10                                                                              }
3429   9                                                                              
3430   9                                                                      }
3431   8                                                                      else if(line_2<2)
3432   8                                                                      {
3433   9                                                                      if(increase)
3434   9                                                                              {
3435  10                                                                                      increase=0;
3436  10                                                                                      if(mixer_name==1)
3437  10                                                                                      {
3438  11                                                                                              if(mixer1_contrary<7)mixer1_contrary++,Data_change(2);
3439  11                                                                                      }
3440  10                                                                                      else if(mixer_name==2)
3441  10                                                                                      {
3442  11                                                                                              if(mixer2_contrary<7)mixer2_contrary++,Data_change(2);
3443  11                                                                                      }
3444  10                                                                                      else if(mixer_name==3)
3445  10                                                                                      {
3446  11                                                                                              if(mixer3_contrary<7)mixer3_contrary++,Data_change(2);
3447  11                                                                                      }
3448  10                                                                                      else if(mixer_name==4)
3449  10                                                                                      {
3450  11                                                                                              if(mixer4_contrary<7)mixer4_contrary++,Data_change(2);
3451  11                                                                                      }
3452  10                                                                              }
3453   9                                                                              if(decrease)
3454   9                                                                              {
3455  10                                                                                      decrease=0;
3456  10                                                                                      if(mixer_name==1)
3457  10                                                                                      {
3458  11                                                                                              if(mixer1_contrary>0)mixer1_contrary--,Data_change(2);
3459  11                                                                                      }
3460  10                                                                                      else if(mixer_name==2)
3461  10                                                                                      {
3462  11                                                                                              if(mixer2_contrary>0)mixer2_contrary--,Data_change(2);
3463  11                                                                                      }
3464  10                                                                                      else if(mixer_name==3)
3465  10                                                                                      {
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 57  

3466  11                                                                                              if(mixer3_contrary>0)mixer3_contrary--,Data_change(2);
3467  11                                                                                      }
3468  10                                                                                      else if(mixer_name==4)
3469  10                                                                                      {
3470  11                                                                                              if(mixer4_contrary>0)mixer4_contrary--,Data_change(2);
3471  11                                                                                      }
3472  10                                                                              }                                                                                                       
3473   9                                                                              
3474   9                                                                      }
3475   8                                                                      else if(line_2<3)
3476   8                                                                      {
3477   9                                                                      if(right)
3478   9                                                                              {
3479  10                                                                                      right=0;
3480  10                                                                                      if(mixer_name==1)
3481  10                                                                                      {
3482  11                                                                                              mixer1_same=1;mixer1_contrary=0;Data_change(2);
3483  11                                                                                      }
3484  10                                                                                      else if(mixer_name==2)
3485  10                                                                                      {
3486  11                                                                                              mixer2_same=2;mixer2_contrary=3;Data_change(2);
3487  11                                                                                      }
3488  10                                                                                      else if(mixer_name==3)
3489  10                                                                                      {
3490  11                                                                                              mixer3_same=0;mixer3_contrary=3;Data_change(2);
3491  11                                                                                      }
3492  10                                                                                      else if(mixer_name==4)
3493  10                                                                                      {
3494  11                                                                                              mixer4_same=5;mixer4_contrary=0;Data_change(2);
3495  11                                                                                      }
3496  10                                                                              }
3497   9                                                                      }       
3498   8                                                                              
3499   8                                                                                      
3500   8                                                                      
3501   8                                                                      if(mixer_name==1)
3502   8                                                                      {
3503   9                                                                              send2(mixer1_same+49,60,0);
3504   9                                                                              send2(mixer1_contrary+49,60,2);
3505   9                                                                      }
3506   8                                                                      else if(mixer_name==2)
3507   8                                                                      {
3508   9                                                                              send2(mixer2_same+49,60,0);
3509   9                                                                              send2(mixer2_contrary+49,60,2);
3510   9                                                                      }
3511   8                                                                      else if(mixer_name==3)
3512   8                                                                      {
3513   9                                                                              send2(mixer3_same+49,60,0);
3514   9                                                                              send2(mixer3_contrary+49,60,2);
3515   9                                                                      }
3516   8                                                                      else if(mixer_name==4)
3517   8                                                                      {
3518   9                                                                              send2(mixer4_same+49,60,0);
3519   9                                                                              send2(mixer4_contrary+49,60,2);
3520   9                                                                      }
3521   8                                                                      
3522   8                                                              }
3523   7                                                              else if(menu_2==6)//失控舵量
3524   7                                                              {
3525   8                                                                      line_2=move_cursor(line_2,7);
3526   8                                                                      
3527   8                                                                      WW[0][0]=29,WW[0][1]=30,WW[0][2]=81,WW[0][3]=0;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 58  

3528   8                                                                      WW[1][0]=29,WW[1][1]=30,WW[1][2]=82,WW[1][3]=0;
3529   8                                                                      WW[2][0]=29,WW[2][1]=30,WW[2][2]=83,WW[2][3]=0;
3530   8                                                                      WW[3][0]=29,WW[3][1]=30,WW[3][2]=84,WW[3][3]=0;
3531   8                                                                      WW[4][0]=29,WW[4][1]=30,WW[4][2]=85,WW[4][3]=0;
3532   8                                                                      WW[5][0]=29,WW[5][1]=30,WW[5][2]=86,WW[5][3]=0;
3533   8                                                                      WW[6][0]=29,WW[6][1]=30,WW[6][2]=87,WW[6][3]=0;
3534   8                                                                      WW[7][0]=29,WW[7][1]=30,WW[7][2]=88,WW[7][3]=0;
3535   8                                                                      display_menu(line_2,7);
3536   8                                                                      
3537   8                                                                      if(increase)
3538   8                                                                      {
3539   9                                                                              increase=0;
3540   9                                                                              if(out_control[line_2]<120)
3541   9                                                                              {
3542  10                                                                                      out_control[line_2]++;Data_change(2);config_change=1;
3543  10                                                                                      
3544  10                                                                              }
3545   9                                                                              
3546   9                                                                      }
3547   8                                                                      if(decrease)
3548   8                                                                      {
3549   9                                                                              decrease=0;
3550   9                                                                              if(out_control[line_2]>-120)
3551   9                                                                              {
3552  10                                                                                      out_control[line_2]--;Data_change(2);config_change=1;
3553  10                                                                                      
3554  10                                                                              }
3555   9                                                                              
3556   9                                                                      }
3557   8                                                                      
3558   8                                                                      if(config_change)
3559   8                                                                      {
3560   9                                                                              config_change=0;
3561   9                                                                              out_control_data[0]=(int)out_control[0]*4.25+511;
3562   9                                                                              out_control_data[1]=(int)out_control[1]*4.25+511;
3563   9                                                                              out_control_data[2]=(int)out_control[2]*4.25+511;
3564   9                                                                              out_control_data[3]=(int)out_control[3]*4.25+511;
3565   9                                                                              out_control_data[4]=(int)out_control[4]*4.25+511;
3566   9                                                                              out_control_data[5]=(int)out_control[5]*4.25+511;
3567   9                                                                              out_control_data[6]=(int)out_control[6]*4.25+511;
3568   9                                                                              out_control_data[7]=(int)out_control[7]*4.25+511;
3569   9                                                                              tx_order[1]=out_control_data[0]>>2;
3570   9                                                                              tx_order[2]=out_control_data[0]<<6;
3571   9                                                                              tx_order[2]+=out_control_data[1]>>4;
3572   9                                                                              tx_order[3]=out_control_data[1]<<4;
3573   9                                                                              tx_order[3]+=out_control_data[2]>>6;
3574   9                                                                              tx_order[4]=out_control_data[2]<<2;
3575   9                                                                              tx_order[4]+=out_control_data[3]>>8;
3576   9                                                                              tx_order[5]=out_control_data[3];
3577   9      
3578   9                                                                              tx_order[6]=out_control_data[4]>>2;
3579   9                                                                              tx_order[7]=out_control_data[4]<<6;
3580   9                                                                              tx_order[7]+=out_control_data[5]>>4;
3581   9                                                                              tx_order[8]=out_control_data[5]<<4;
3582   9                                                                              tx_order[8]+=out_control_data[6]>>6;
3583   9                                                                              tx_order[9]=out_control_data[6]<<2;
3584   9                                                                              tx_order[9]+=out_control_data[7]>>8;
3585   9                                                                              tx_order[10]=out_control_data[7];
3586   9                                                                              
3587   9                                                                              
3588   9                                                                              NRF_config_change=1;
3589   9                                                                      }
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 59  

3590   8                                                                      
3591   8                                                                      if(line_2<3)
3592   8                                                                      {
3593   9                                                                              write_num100(out_control[0],70,0,'/');
3594   9                                                                              write_num100(out_control[1],70,2,'/');
3595   9                                                                              write_num100(out_control[2],70,4,'/');
3596   9                                                                              write_num100(out_control[3],70,6,'/');
3597   9                                                                      }
3598   8                                                                      else if(line_2==7)
3599   8                                                                      {
3600   9                                                                              write_num100(out_control[4],70,0,'/');
3601   9                                                                              write_num100(out_control[5],70,2,'/');
3602   9                                                                              write_num100(out_control[6],70,4,'/');
3603   9                                                                              write_num100(out_control[7],70,6,'/');
3604   9                                                                      }
3605   8                                                                      else
3606   8                                                                      {
3607   9                                                                              write_num100(out_control[line_2-2],70,0,'/');
3608   9                                                                              write_num100(out_control[line_2-1],70,2,'/');
3609   9                                                                              write_num100(out_control[line_2],70,4,'/');
3610   9                                                                              write_num100(out_control[line_2+1],70,6,'/');
3611   9                                                                      }
3612   8                                                                      
3613   8                                                              }
3614   7                                                              else if(menu_2==7)//通信密码
3615   7                                                              {
3616   8                                                                      line_2=move_cursor(line_2,4);
3617   8                                                                      
3618   8                                                                      WW[0][0]=48,WW[0][1]=49,WW[0][2]=81,WW[0][3]=0;
3619   8                                                                      WW[1][0]=48,WW[1][1]=49,WW[1][2]=82,WW[1][3]=0;
3620   8                                                                      WW[2][0]=48,WW[2][1]=49,WW[2][2]=83,WW[2][3]=0;
3621   8                                                                      WW[3][0]=48,WW[3][1]=49,WW[3][2]=84,WW[3][3]=0;
3622   8                                                                      WW[4][0]=48,WW[4][1]=49,WW[4][2]=85,WW[4][3]=0;
3623   8      
3624   8                                                                      display_menu(line_2,4);
3625   8                                                                      if(line_2<3)
3626   8                                                                      {
3627   9                                                                              send2_hex((u8)(address[0]>>4),60,0);send2_hex((u8)(address[0]&0x0f),68,0);
3628   9                                                                              send2_hex((u8)(address[1]>>4),60,2);send2_hex((u8)(address[1]&0x0f),68,2);
3629   9                                                                              send2_hex((u8)(address[2]>>4),60,4);send2_hex((u8)(address[2]&0x0f),68,4);
3630   9                                                                              send2_hex((u8)(address[3]>>4),60,6);send2_hex((u8)(address[3]&0x0f),68,6);
3631   9                                                                      }
3632   8                                                                      else 
3633   8                                                                      {
3634   9                                                                              send2_hex((u8)(address[1]>>4),60,0);send2_hex((u8)(address[1]&0x0f),68,0);
3635   9                                                                              send2_hex((u8)(address[2]>>4),60,2);send2_hex((u8)(address[2]&0x0f),68,2);
3636   9                                                                              send2_hex((u8)(address[3]>>4),60,4);send2_hex((u8)(address[3]&0x0f),68,4);
3637   9                                                                              send2_hex((u8)(address[4]>>4),60,6);send2_hex((u8)(address[4]&0x0f),68,6);
3638   9      
3639   9                                                                      }
3640   8                                                                      
3641   8                                                                      if(increase)
3642   8                                                                      {
3643   9                                                                              increase=0;
3644   9                                                                              address[line_2]++;Data_change(1),NRF_change=1;
3645   9                                                                      }
3646   8                                                                      if(decrease)
3647   8                                                                      {
3648   9                                                                              decrease=0;
3649   9                                                                              address[line_2]--;Data_change(1),NRF_change=1;
3650   9                                                                      }
3651   8                                                                      
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 60  

3652   8                                                              }
3653   7                                                              else if(menu_2==8)//跳频
3654   7                                                              {
3655   8                                                                      line_2=move_cursor(line_2,4);
3656   8                                                                      
3657   8                                                                      WW[0][0]=53,WW[0][1]=51,WW[0][2]=81,WW[0][3]=0;
3658   8                                                                      WW[1][0]=53,WW[1][1]=51,WW[1][2]=82,WW[1][3]=0;
3659   8                                                                      WW[2][0]=53,WW[2][1]=51,WW[2][2]=83,WW[2][3]=0;
3660   8                                                                      WW[3][0]=53,WW[3][1]=51,WW[3][2]=84,WW[3][3]=0;
3661   8                                                                      WW[4][0]=53,WW[4][1]=51,WW[4][2]=85,WW[4][3]=0;
3662   8                                                                      display_menu(line_2,4);
3663   8                                                                      
3664   8                                                                      if(line_2<3)
3665   8                                                                      {
3666   9                                                                              write_num100(hopping[0],60,0,0);
3667   9                                                                              write_num100(hopping[1],60,2,0);
3668   9                                                                              write_num100(hopping[2],60,4,0);
3669   9                                                                              write_num100(hopping[3],60,6,0);
3670   9                                                                      }
3671   8                                                                      else 
3672   8                                                                      {
3673   9                                                                              write_num100(hopping[1],60,0,0);
3674   9                                                                              write_num100(hopping[2],60,2,0);
3675   9                                                                              write_num100(hopping[3],60,4,0);
3676   9                                                                              write_num100(hopping[4],60,6,0);
3677   9                                                                      }
3678   8                                                                      
3679   8                                                                      if(increase)
3680   8                                                                      {
3681   9                                                                              increase=0;
3682   9                                                                              if(hopping[line_2]<125)hopping[line_2]++;Data_change(1);
3683   9                                                                      }
3684   8                                                                      if(decrease)
3685   8                                                                      {
3686   9                                                                              decrease=0;
3687   9                                                                              if(hopping[line_2]>0)hopping[line_2]--;Data_change(1);
3688   9                                                                      }
3689   8                                                                      
3690   8                                                              }
3691   7                                                              else if(menu_2==9)//通道映射
3692   7                                                              {
3693   8                                                                      line_2=move_cursor(line_2,7);
3694   8                                                                      
3695   8                                                                      WW[0][0]=16,WW[0][1]=17,WW[0][2]=81,WW[0][3]=0;
3696   8                                                                      WW[1][0]=16,WW[1][1]=17,WW[1][2]=82,WW[1][3]=0;
3697   8                                                                      WW[2][0]=16,WW[2][1]=17,WW[2][2]=83,WW[2][3]=0;
3698   8                                                                      WW[3][0]=16,WW[3][1]=17,WW[3][2]=84,WW[3][3]=0;
3699   8                                                                      WW[4][0]=16,WW[4][1]=17,WW[4][2]=85,WW[4][3]=0;
3700   8                                                                      WW[5][0]=16,WW[5][1]=17,WW[5][2]=86,WW[5][3]=0;
3701   8                                                                      WW[6][0]=16,WW[6][1]=17,WW[6][2]=87,WW[6][3]=0;
3702   8                                                                      WW[7][0]=16,WW[7][1]=17,WW[7][2]=88,WW[7][3]=0;
3703   8                                                                      display_menu(line_2,7);
3704   8                                                                      
3705   8                                                                      word[0]=4;word[1]=94;word[2]=95;word[3]=0;write(60,0);
3706   8                                                                      write(60,2);write(60,4);write(60,6);
3707   8                                                                      
3708   8                                                                      if(increase)
3709   8                                                                      {
3710   9                                                                              increase=0;
3711   9                                                                              if(NRF_mapping[line_2]<7)NRF_mapping[line_2]++;Data_change(2);
3712   9                                                                      }
3713   8                                                                      if(decrease)
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 61  

3714   8                                                                      {
3715   9                                                                              decrease=0;
3716   9                                                                              if(NRF_mapping[line_2]>0)NRF_mapping[line_2]--;Data_change(2);
3717   9                                                                      }
3718   8                                                                      
3719   8                                                                      if(line_2<3)
3720   8                                                                      {
3721   9                                                                              send2(NRF_mapping[0]+49,96,0);
3722   9                                                                              send2(NRF_mapping[1]+49,96,2);
3723   9                                                                              send2(NRF_mapping[2]+49,96,4);
3724   9                                                                              send2(NRF_mapping[3]+49,96,6);
3725   9                                                                      }
3726   8                                                                      else if(line_2==7)
3727   8                                                                      {
3728   9                                                                              send2(NRF_mapping[4]+49,96,0);
3729   9                                                                              send2(NRF_mapping[5]+49,96,2);
3730   9                                                                              send2(NRF_mapping[6]+49,96,4);
3731   9                                                                              send2(NRF_mapping[7]+49,96,6);
3732   9                                                                      }
3733   8                                                                      else 
3734   8                                                                      {
3735   9                                                                              send2(NRF_mapping[line_2-2]+49,96,0);
3736   9                                                                              send2(NRF_mapping[line_2-1]+49,96,2);
3737   9                                                                              send2(NRF_mapping[line_2]+49,96,4);
3738   9                                                                              send2(NRF_mapping[line_2+1]+49,96,6);
3739   9                                                                      }
3740   8      
3741   8                                                              }
3742   7                                                              else if(menu_2==10)//版本信息
3743   7                                                              {
3744   8                                                                      photo(bmp0,4,0,120,3);
3745   8                                                                      send3(hzk[73],56,6);send3(hzk[74],68,6);
3746   8                                                                      send2('V',80,6);send2('3',88,6);send2('.',96,6);
3747   8                                                                      send2('A',104,6);send2('1',112,6);send2('2',120,6);
3748   8                                                                      
3749   8                                                              }
3750   7                                                              else if(menu_2==11)//对频
3751   7                                                              {
3752   8                                                                      word[0]=121;word[1]=122;word[2]=43;word[3]=44;word[4]=123;word[5]=0;write(24,0);
3753   8                                                                      send2('.',84,0);send2('.',92,0);send2('.',100,0);
3754   8                                                                      
3755   8                                                                                                                              
3756   8                                                                      device_connect();
3757   8      
3758   8                                                                      if(cancel)
3759   8                                                                      {
3760   9                                                                              word[0]=16;word[1]=47;word[2]=126;word[3]=127;word[4]=0;write(40,4);
3761   9                                                                              menu_2=0;cancel=0;
3762   9                                                                      }
3763   8                                                                      else
3764   8                                                                      {
3765   9                                                                              word[0]=16;word[1]=47;word[2]=124;word[3]=125;word[4]=0;write(40,4);
3766   9                                                                              menu_2=0;menu=0;
3767   9                                                                      }       
3768   8                                                                      delay_ms(500);star=1;
3769   8      
3770   8                                                              }
3771   7                                                              else if(menu_2==12)//恢复出厂
3772   7                                                              {
3773   8                                                                      word[0]=106,word[1]=107,word[2]=32,word[3]=136,word[4]=0,write(40,2);
3774   8                                                                      word[0]=137,word[1]=109,word[2]=0,write(52,4);send2('?',80,4);
3775   8                                                                      if(right)
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 62  

3776   8                                                                      {                                                               
3777   9                                                                              IAP_CONTR=0x83;         //擦除所有数据
3778   9                                                                              EEPROM_clean(0);
3779   9                                                                              EEPROM_clean(2);
3780   9                                                                              EEPROM_clean(4);
3781   9                                                                              IAP_CONTR=0;
3782   9                                                                              send3(hzk[3],80,4);
3783   9                                                                              word[0]=138,word[1]=139,word[2]=140,word[3]=57,word[4]=0,write(40,6);
3784   9                                                                              TR0=0,TR1=0,CCON=0;while(1);
3785   9                                                                      }
3786   8                                                              }
3787   7                                                              else if(menu_2==13)//回传报警
3788   7                                                              {
3789   8                                                                      line_2=move_cursor(line_2,5);
3790   8                                                                      
3791   8                                                                      WW[0][0]=160,WW[0][1]=161,WW[0][2]=0;
3792   8                                                                      WW[1][0]=58,WW[1][1]=59,WW[1][2]=0;
3793   8                                                                      WW[2][0]=105,WW[2][1]=206,WW[2][2]=0;
3794   8                                                                      WW[3][0]=207,WW[3][1]=208,WW[3][2]=0;
3795   8                                                                      WW[4][0]=29,WW[4][1]=30,WW[4][2]=0;
3796   8                                                                      WW[5][0]=66,WW[5][1]=67,WW[5][2]=0;
3797   8                                                                      
3798   8                                                                      display_menu(line_2,5);
3799   8                                                                      
3800   8                                                                      
3801   8                                                                      if(line_2<3)
3802   8                                                                      {
3803   9                                                                              if(Switch_Check(Return_alarm_switch)==3)send3(hzk[58],64,0);
3804   9                                                                              else send3(hzk[59],64,0);
3805   9                                                                      }
3806   8                                                                      
3807   8                                                                      
3808   8                                                                      
3809   8                                                                      if(line_2==1)
3810   8                                                                      {
3811   9                                                                              if(increase)
3812   9                                                                              {
3813  10                                                                                      increase=0;
3814  10                                                                                      if(Return_alarm_switch<5)Return_alarm_switch++,Data_change(1);
3815  10                                                                                      
3816  10                                                                              }
3817   9                                                                              if(decrease)
3818   9                                                                              {
3819  10                                                                                      decrease=0;
3820  10                                                                                      if(Return_alarm_switch>0)Return_alarm_switch--,Data_change(1);
3821  10      
3822  10                                                                              }
3823   9                                                                              
3824   9                                                                              display_switch(Return_alarm_switch,60,2);
3825   9                                                                      }
3826   8                                                                      else if(line_2==2)
3827   8                                                                      {
3828   9                                                                              if(increase)
3829   9                                                                              {
3830  10                                                                                      increase=0;
3831  10                                                                                      if(Power_V<200)
3832  10                                                                                      {
3833  11                                                                                              Power_V++,Data_change(1);
3834  11                                                                                      }
3835  10                                                                              }
3836   9                                                                              if(decrease)
3837   9                                                                              {
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 63  

3838  10                                                                                      decrease=0;
3839  10                                                                                      if(Power_V>0)
3840  10                                                                                      {
3841  11                                                                                              Power_V--,Data_change(1);
3842  11                                                                                      }
3843  10                                                                              }       
3844   9      
3845   9                                                                              write_num100(Power_V,60,4,'.');send2('V',92,4);
3846   9                                                                              
3847   9                                                                      }
3848   8                                                                      else if(line_2==3)
3849   8                                                                      {
3850   9                                                                              if(increase)
3851   9                                                                              {
3852  10                                                                                      increase=0;
3853  10                                                                                      if(Chip_V<50)
3854  10                                                                                      {
3855  11                                                                                              Chip_V++,Data_change(1);
3856  11                                                                                      }
3857  10                                                                              }
3858   9                                                                              if(decrease)
3859   9                                                                              {
3860  10                                                                                      decrease=0;
3861  10                                                                                      if(Chip_V>0)
3862  10                                                                                      {
3863  11                                                                                              Chip_V--,Data_change(1);
3864  11                                                                                      }
3865  10                                                                              }
3866   9      
3867   9                                                                              write_num100(Chip_V,60,4,'.');send2('V',92,4);                                                                  
3868   9                                                                              
3869   9                                                                      }
3870   8                                                                      else if(line_2==4)
3871   8                                                                      {
3872   9                                                                              if(increase)
3873   9                                                                              {
3874  10                                                                                      increase=0;
3875  10                                                                                      if(TX_min<100)
3876  10                                                                                      {
3877  11                                                                                              TX_min++,Data_change(1);
3878  11                                                                                      }
3879  10                                                                              }
3880   9                                                                              if(decrease)
3881   9                                                                              {
3882  10                                                                                      decrease=0;
3883  10                                                                                      if(TX_min>0)
3884  10                                                                                      {
3885  11                                                                                              TX_min--,Data_change(1);
3886  11                                                                                      }
3887  10                                                                              }
3888   9      
3889   9                                                                              write_num100(TX_min,68,4,'%');
3890   9                                                                              
3891   9                                                                      }
3892   8                                                                      else if(line_2==5)
3893   8                                                                      {
3894   9                                                                              if(increase)
3895   9                                                                              {
3896  10                                                                                      increase=0;
3897  10                                                                                      if(RX_min<100)
3898  10                                                                                      {
3899  11                                                                                              RX_min++,Data_change(1);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 64  

3900  11                                                                                      }
3901  10                                                                              }
3902   9                                                                              if(decrease)
3903   9                                                                              {
3904  10                                                                                      decrease=0;
3905  10                                                                                      if(RX_min>0)
3906  10                                                                                      {
3907  11                                                                                              RX_min--,Data_change(1);
3908  11                                                                                      }
3909  10                                                                              }
3910   9      
3911   9                                                                              write_num100(RX_min,68,6,'%');
3912   9                                                                              
3913   9                                                                      }
3914   8                                                                      
3915   8                                                                      
3916   8                                                              }
3917   7                                                              else if(menu_2==14)//显示设置
3918   7                                                              {
3919   8                                                                      line_2=move_cursor(line_2,3);
3920   8                                                                      
3921   8                                                                      WW[0][0]=187,WW[0][1]=188,WW[0][2]=103,WW[0][3]=0;
3922   8                                                                      WW[1][0]=178,WW[1][1]=179,WW[1][2]=64,WW[1][3]=0;
3923   8                                                                      WW[2][0]=60,WW[2][1]=61,WW[2][2]=0;
3924   8                                                                      WW[3][0]=213,WW[3][1]=79,WW[3][2]=0;                                                    
3925   8                                                                      
3926   8                                                                      display_menu(line_2,3);
3927   8                                                                      
3928   8                                                                      write_num100(LCD_vop,60,0,0);
3929   8                                                                      if(LCD_big)send3(hzk[178],68,2);
3930   8                                                                      else send3(hzk[179],68,2);
3931   8                                                                      
3932   8                                                                      if(LCD_light)send3(hzk[58],68,4);
3933   8                                                                      else send3(hzk[59],68,4);
3934   8                                                                      if(LCD_reverse)send3(hzk[35],68,6);
3935   8                                                                      else send3(hzk[34],68,6);
3936   8                                                                      
3937   8                                                                      if(line_2==0)
3938   8                                                                      {
3939   9                                                                              if(increase)
3940   9                                                                              {
3941  10                                                                                      increase=0;
3942  10                                                                                      if(LCD_vop<60)
3943  10                                                                                      {
3944  11                                                                                              LCD_vop++;Data_change(1);
3945  11                                                                                              
3946  11                                                                                              RS=0;
3947  11                                                                                              LCD(0x81);
3948  11                                                                                              LCD(LCD_vop);
3949  11                                                                                              RS=1;
3950  11                                                                                      }
3951  10                                                                              }
3952   9                                                                              
3953   9                                                                              if(decrease)
3954   9                                                                              {
3955  10                                                                                      decrease=0;
3956  10                                                                                      if(LCD_vop>10)
3957  10                                                                                      {
3958  11                                                                                              LCD_vop--;Data_change(1);
3959  11                                                                                              
3960  11                                                                                              RS=0;
3961  11                                                                                              LCD(0x81);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 65  

3962  11                                                                                              LCD(LCD_vop);
3963  11                                                                                              RS=1;
3964  11                                                                                      }
3965  10                                                                              }                                                               
3966   9                                                                              
3967   9                                                                      }
3968   8                                                                      else if(line_2==1)
3969   8                                                                      {
3970   9                                                                              if(increase|decrease)
3971   9                                                                              {
3972  10                                                                                      increase=0;decrease=0;
3973  10      
3974  10                                                                                      LCD_big=!LCD_big;Data_change(1);
3975  10                                                                                      RS=0;
3976  10                                                                                      if(LCD_big)LCD(0x60);
3977  10                                                                                      else LCD(0x40);
3978  10                                                                                      RS=1;
3979  10      
3980  10                                                                              }                                                                                                                                                       
3981   9                                                                              
3982   9                                                                      }
3983   8                                                                      else if(line_2==2)
3984   8                                                                      {
3985   9                                                                              if(increase|decrease)
3986   9                                                                              {
3987  10                                                                                      increase=0;decrease=0;Data_change(1);
3988  10      
3989  10                                                                                              LCD_light=!LCD_light;LEDA=LCD_light;
3990  10                                                                              
3991  10      
3992  10                                                                              }                                                                                                                                               
3993   9                                                                              
3994   9                                                                      }
3995   8                                                                      else
3996   8                                                                      {
3997   9                                                                              if(increase|decrease)
3998   9                                                                              {
3999  10                                                                                      increase=0;decrease=0;
4000  10      
4001  10                                                                                      LCD_reverse=!LCD_reverse;Data_change(1);
4002  10                                                                                      RS=0;
4003  10                                                                                      if(LCD_reverse)LCD(0xc0),LCD(0xa1);
4004  10                                                                                      else LCD(0xc8),LCD(0xa0);;
4005  10                                                                                      RS=1;
4006  10                                                                                      
4007  10                                                                                      star=1;
4008  10      
4009  10                                                                              }
4010   9                                                                      }
4011   8                                                              
4012   8                                                              }
4013   7                                                              else if(menu_2==15)//PPM映射
4014   7                                                              {
4015   8                                                                      line_2=move_cursor(line_2,7);
4016   8                                                                      
4017   8                                                                      WW[0][0]=192,WW[0][1]=193,WW[0][2]=81,WW[0][3]=0;
4018   8                                                                      WW[1][0]=192,WW[1][1]=193,WW[1][2]=82,WW[1][3]=0;
4019   8                                                                      WW[2][0]=192,WW[2][1]=193,WW[2][2]=83,WW[2][3]=0;
4020   8                                                                      WW[3][0]=192,WW[3][1]=193,WW[3][2]=84,WW[3][3]=0;
4021   8                                                                      WW[4][0]=192,WW[4][1]=193,WW[4][2]=85,WW[4][3]=0;
4022   8                                                                      WW[5][0]=192,WW[5][1]=193,WW[5][2]=86,WW[5][3]=0;
4023   8                                                                      WW[6][0]=192,WW[6][1]=193,WW[6][2]=87,WW[6][3]=0;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 66  

4024   8                                                                      WW[7][0]=192,WW[7][1]=193,WW[7][2]=88,WW[7][3]=0;
4025   8                                                                      display_menu(line_2,7);
4026   8                                                                      
4027   8                                                                      word[0]=4;word[1]=94;word[2]=95;word[3]=0;write(60,0);
4028   8                                                                      write(60,2);write(60,4);write(60,6);
4029   8                                                                      
4030   8                                                                      if(increase)
4031   8                                                                      {
4032   9                                                                              increase=0;
4033   9                                                                              if(PPM_mapping[line_2]<7)PPM_mapping[line_2]++;Data_change(1);
4034   9                                                                      }
4035   8                                                                      if(decrease)
4036   8                                                                      {
4037   9                                                                              decrease=0;
4038   9                                                                              if(PPM_mapping[line_2]>0)PPM_mapping[line_2]--;Data_change(1);
4039   9                                                                      }
4040   8                                                                      
4041   8                                                                      if(line_2<3)
4042   8                                                                      {
4043   9                                                                              send2(PPM_mapping[0]+49,96,0);
4044   9                                                                              send2(PPM_mapping[1]+49,96,2);
4045   9                                                                              send2(PPM_mapping[2]+49,96,4);
4046   9                                                                              send2(PPM_mapping[3]+49,96,6);
4047   9                                                                      }
4048   8                                                                      else if(line_2==7)
4049   8                                                                      {
4050   9                                                                              send2(PPM_mapping[4]+49,96,0);
4051   9                                                                              send2(PPM_mapping[5]+49,96,2);
4052   9                                                                              send2(PPM_mapping[6]+49,96,4);
4053   9                                                                              send2(PPM_mapping[7]+49,96,6);
4054   9                                                                      }
4055   8                                                                      else 
4056   8                                                                      {
4057   9                                                                              send2(PPM_mapping[line_2-2]+49,96,0);
4058   9                                                                              send2(PPM_mapping[line_2-1]+49,96,2);
4059   9                                                                              send2(PPM_mapping[line_2]+49,96,4);
4060   9                                                                              send2(PPM_mapping[line_2+1]+49,96,6);
4061   9                                                                      }
4062   8                                                              }
4063   7                                                              else if(menu_2==16)//大小舵
4064   7                                                              {
4065   8                                                                      line_2=move_cursor(line_2,3);
4066   8                                                                      
4067   8                                                                      WW[0][0]=160,WW[0][1]=161,WW[0][2]=0;
4068   8                                                                      WW[1][0]=58,WW[1][1]=59,WW[1][2]=0;
4069   8                                                                      WW[2][0]=202,WW[2][1]=34,WW[2][2]=36,WW[2][3]=37;
4070   8                                                                      WW[3][0]=202,WW[3][1]=134,WW[3][2]=36,WW[3][3]=37;
4071   8                                                                      
4072   8                                                                      display_menu(line_2,3);
4073   8                                                                      
4074   8                                                                      
4075   8                                                                              if(use_new_ratio)send3(hzk[202],60,0),send3(hzk[36],72,0),send3(hzk[37],84,0);
4076   8                                                                              else send3(hzk[201],60,0),send3(hzk[36],72,0),send3(hzk[37],84,0);
4077   8                                                                      
4078   8                                                                      display_switch(ratio_switch,60,2);
4079   8                                                                      
4080   8                                                                      if(line_2==1)
4081   8                                                                      {
4082   9                                                                              if(increase)
4083   9                                                                              {
4084  10                                                                                      increase=0;
4085  10                                                                                      if(ratio_switch<5)ratio_switch++,Data_change(1);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 67  

4086  10                                                                                      
4087  10                                                                              }
4088   9                                                                              if(decrease)
4089   9                                                                              {
4090  10                                                                                      decrease=0;
4091  10                                                                                      if(ratio_switch>0)ratio_switch--,Data_change(1);
4092  10      
4093  10                                                                              }
4094   9                                                                      }
4095   8                                                                      if(line_2==2)
4096   8                                                                      {
4097   9                                                                              if(right)
4098   9                                                                              {
4099  10                                                                                      right=0;menu_3=1,line_3=0,ratio_mode=1;
4100  10                                                                                      
4101  10                                                                              }
4102   9                                                                      }
4103   8                                                                      if(line_2==3)
4104   8                                                                      {
4105   9                                                                              if(right)
4106   9                                                                              {
4107  10                                                                                      right=0;menu_3=1,line_3=0,ratio_mode=0;
4108  10                                                                                      
4109  10                                                                              }
4110   9                                                                      }
4111   8                                                                      
4112   8                                                                      
4113   8                                                      
4114   8                                                              }
4115   7                                                              else if(menu_2==17)//原始数据
4116   7                                                              {
4117   8                                                                      for(i=0;i<8;i++)
4118   8                                                                      {
4119   9                                                                              location(0,i);
4120   9                                                                              send('A');send('D');send('1'+i);send(':');
4121   9                                                                              write_num1000(adc[7-i],0);
4122   9                                                                      }
4123   8                                                                      
4124   8                                                                      
4125   8                                                                                                                              
4126   8                                                              }
4127   7                                                              else if(menu_2==18)//无线协议
4128   7                                                              {
4129   8                                                                      line_2=move_cursor(line_2,2);
4130   8                                                                      
4131   8                                                                      WW[0][0]=65,WW[0][1]=79,WW[0][2]=50,WW[0][3]=53,WW[0][4]=51,WW[0][5]=0;
4132   8                                                                      WW[1][0]=66,WW[1][1]=67,WW[1][2]=65,WW[1][3]=53,WW[1][4]=51,WW[1][5]=0;
4133   8                                                                      WW[2][0]=66,WW[2][1]=67,WW[2][2]=50,WW[2][3]=53,WW[2][4]=51,WW[2][5]=0;
4134   8                                                                      
4135   8              //                                                      WW[3][0]=69,WW[3][1]=70,WW[3][2]=71,WW[3][3]=72,WW[3][4]=0,WW[3][5]=0;
4136   8                                                                      
4137   8                                                                      display_menu(line_2,2);
4138   8                                                                      
4139   8                                                                      if(right)
4140   8                                                                      {
4141   9                                                                              right=0;
4142   9                                                                              TX_protocol=line_2+1;Data_change(1);
4143   9                                                                      }
4144   8                                                                      
4145   8                                                                      if(TX_protocol==1)send3(hzk[3],80,0);
4146   8                                                                      if(TX_protocol==2)send3(hzk[3],80,2);
4147   8                                                                      if(TX_protocol==3)send3(hzk[3],80,4);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 68  

4148   8                                                              }
4149   7                                                              else if(menu_2==19)//全频扫描
4150   7                                                              {
4151   8                                                                      
4152   8                                                                      word[0]=76;word[1]=53;word[2]=77;word[3]=78;word[4]=0;write(0,0);
4153   8                                                                      location(54,0);send('2');send('4');send('0');send('0');send('-');
4154   8                                                                      send('2');send('5');send('2');send('5');send('M');send('h');send('z');
4155   8                                                                      
4156   8                                                                      location(0,2);LCD(0xff);
4157   8                                                                      location(0,4);LCD(0xff);
4158   8                                                                      location(0,6);LCD(0xff);
4159   8                                                                      location(127,2);LCD(0xff);
4160   8                                                                      location(127,4);LCD(0xff);
4161   8                                                                      location(127,6);LCD(0xff);
4162   8                                                                      
4163   8                                                                      location(63,3);LCD(0x3f);LCD(0x3f);
4164   8                                                                      location(63,5);LCD(0x3f);LCD(0x3f);
4165   8                                                                      location(63,7);LCD(0x3f);LCD(0x3f);
4166   8                                                                      location(31,3);LCD(0x0f);
4167   8                                                                      location(31,5);LCD(0x0f);
4168   8                                                                      location(31,7);LCD(0x0f);
4169   8                                                                      location(95,3);LCD(0x0f);
4170   8                                                                      location(95,5);LCD(0x0f);
4171   8                                                                      location(95,7);LCD(0x0f);
4172   8                                                                      location(0,3);send('0');
4173   8                                                                      location(116,3);send('4');send('1');
4174   8                                                                      location(0,5);send('4');send('2');
4175   8                                                                      location(116,5);send('8');send('3');
4176   8                                                                                              location(0,7);send('8');send('4');
4177   8                                                                      location(110,7);send('1');send('2');send('5');
4178   8                                                              
4179   8                                                                      
4180   8                                                                      
4181   8                                                                      for(i=0;i<126;i++)
4182   8                                                                      {
4183   9                                                                              if(i==0)location(1,2);
4184   9                                                                              else if(i==42)location(1,4);
4185   9                                                                              else if(i==84)location(1,6);
4186   9                                                                              
4187   9                                                                              if(CD_data[i/8]&(1<<(i%8)))LCD(0xbd),LCD(0xbd),LCD(0xbd);
4188   9                                                                              else LCD(0x81),LCD(0x81),LCD(0x81);
4189   9                                                                              
4190   9                                                                      }
4191   8      
4192   8                                                                      
4193   8                                                                      if(left)left=0,menu_2=0,star=1,RC_check=0;
4194   8                                                              }
4195   7                                                              else if(menu_2==20)//摇杆校准
4196   7                                                              {
4197   8                                                                      
4198   8                                                                      
4199   8                                                                      if(CH1_max<adc[6])CH1_max=adc[6];                //获取最大值
4200   8                                                                      if(CH2_max<adc[7])CH2_max=adc[7];
4201   8                                                                      if(CH3_max<adc[4])CH3_max=adc[4];
4202   8                                                                      if(CH4_max<adc[5])CH4_max=adc[5];
4203   8                                                                      
4204   8                                                                      if(CH1_min>adc[6])CH1_min=adc[6];                //获取最小值
4205   8                                                                      if(CH2_min>adc[7])CH2_min=adc[7];
4206   8                                                                      if(CH3_min>adc[4])CH3_min=adc[4];
4207   8                                                                      if(CH4_min>adc[5])CH4_min=adc[5];
4208   8      
4209   8                                                                      location(0,0);                                            //显示数值
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 69  

4210   8                                                                      send('C');send('H');send('1');send(' ');send('<');write_num1000(CH1_min,0);
4211   8                                                                      send(' ');send('-');send(' ');write_num1000(CH1_max,0);send('>');
4212   8                                                                      location(0,1);
4213   8                                                                      send('C');send('H');send('2');send(' ');send('<');write_num1000(CH2_min,0);
4214   8                                                                      send(' ');send('-');send(' ');write_num1000(CH2_max,0);send('>');
4215   8                                                                      location(0,2);
4216   8                                                                      send('C');send('H');send('3');send(' ');send('<');write_num1000(CH3_min,0);
4217   8                                                                      send(' ');send('-');send(' ');write_num1000(CH3_max,0);send('>');
4218   8                                                                      location(0,3);
4219   8                                                                      send('C');send('H');send('4');send(' ');send('<');write_num1000(CH4_min,0);
4220   8                                                                      send(' ');send('-');send(' ');write_num1000(CH4_max,0);send('>');
4221   8      
4222   8                                                                      
4223   8                                                                      
4224   8                                                                      if(right)
4225   8                                                                      {
4226   9                                                                              right=0;
4227   9                                                                              calibration_action=1;
4228   9                                                                              
4229   9                                                                              if(512-CH1_min<CH1_max-512)CH1_offset=(512-CH1_min)/10;//获取最小偏差
4230   9                                                                              else CH1_offset=(CH1_max-512)/10;
4231   9                                                                              if(512-CH2_min<CH2_max-512)CH2_offset=(512-CH2_min)/10;
4232   9                                                                              else CH2_offset=(CH2_max-512)/10;
4233   9                                                                              if(512-CH3_min<CH3_max-512)CH3_offset=(512-CH3_min)/10;
4234   9                                                                              else CH3_offset=(CH3_max-512)/10;
4235   9                                                                              if(512-CH4_min<CH4_max-512)CH4_offset=(512-CH4_min)/10;
4236   9                                                                              else CH4_offset=(CH4_max-512)/10;
4237   9                                                                              
4238   9                                                                              Data_change(1);
4239   9                                                                              
4240   9                                                              
4241   9                                                                      }
4242   8                                                                      
4243   8                                                                      send3(hzk[209],24,6);send3(hzk[210],36,6);
4244   8                                                                      send3(hzk[98],48,6);send3(hzk[99],60,6);
4245   8                                                                      
4246   8                                                                      if(calibration_action)
4247   8                                                                      {
4248   9                                                                              
4249   9                                                                              send3(hzk[3],84,6);     
4250   9                                                      
4251   9                                                                      
4252   9                                                                      }
4253   8                                                                      else send2('?',84,6);   
4254   8                                                                      
4255   8                                                                                                                                                              
4256   8                                                                      
4257   8                                                                      
4258   8                                                      
4259   8      
4260   8                                                              }
4261   7                                                              else if(menu_2==21)//PPM输入显示
4262   7                                                              {
4263   8                                                                      location(0,0);send('I');send('N');send('1');
4264   8                                                                      location(0,1);send('I');send('N');send('2');
4265   8                                                                      location(0,2);send('I');send('N');send('3');
4266   8                                                                      location(0,3);send('I');send('N');send('4');
4267   8                                                                      location(0,4);send('I');send('N');send('5');
4268   8                                                                      location(0,5);send('I');send('N');send('6');
4269   8                                                                      location(0,6);send('I');send('N');send('7');
4270   8                                                                      location(0,7);send('I');send('N');send('8');
4271   8                                                                      
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 70  

4272   8                                                                      if(increase)
4273   8                                                                      {
4274   9                                                                              increase=0;delay_time=5;
4275   9                                                                              if(PPM_offset<100)PPM_offset++,Data_change(1);
4276   9                                                                      }
4277   8                                                                      if(decrease)
4278   8                                                                      {
4279   9                                                                              decrease=0;delay_time=5;
4280   9                                                                              if(PPM_offset>-100)PPM_offset--,Data_change(1);
4281   9                                                                      }
4282   8                                                                      
4283   8                                                                      display_bar(PPM_DATA);
4284   8                                                                      
4285   8                                                                      
4286   8                                                                      if(delay_time>0)
4287   8                                                                      {
4288   9                                                                              delay_time--;
4289   9                                                                      
4290   9                                                                              photo(bmp3,57,5,32,3);
4291   9                                                                              location(60,6);
4292   9                                                                                                              
4293   9                                                                              write_num1000(PPM_offset,'-');
4294   9                                                                      }
4295   8                                                              }
4296   7                                                              else if(menu_2==22)//舵量监视
4297   7                                                              {
4298   8                                                                      location(0,0);send('C');send('H');send('1');
4299   8                                                                      location(0,1);send('C');send('H');send('2');
4300   8                                                                      location(0,2);send('C');send('H');send('3');
4301   8                                                                      location(0,3);send('C');send('H');send('4');
4302   8                                                                      location(0,4);send('C');send('H');send('5');
4303   8                                                                      location(0,5);send('C');send('H');send('6');
4304   8                                                                      location(0,6);send('C');send('H');send('7');
4305   8                                                                      location(0,7);send('C');send('H');send('8');
4306   8                              
4307   8                                                                      display_bar(operation);
4308   8                                                              }
4309   7                                                              else if(menu_2==23)//自动扫描
4310   7                                                              {
4311   8                                                                      line_2=move_cursor(line_2,2);
4312   8                                                                      
4313   8                                                                      WW[0][0]=172,WW[0][1]=51,WW[0][2]=0;
4314   8                                                                      WW[1][0]=173,WW[1][1]=51,WW[1][2]=0;
4315   8                                                                      WW[2][0]=114,WW[2][1]=103,WW[2][2]=0;
4316   8                                                                      display_menu(line_2,2);
4317   8                                                                      
4318   8                                                                      if(line_2<1)
4319   8                                                                      {
4320   9                                                                              if(increase)
4321   9                                                                              {
4322  10                                                                                      increase=0;
4323  10                                                                                      if(auto_star<120)auto_star++,Data_change(1);
4324  10                                                                                      auto_min=auto_star*4.25+511;
4325  10                                                                              }
4326   9                                                                              if(decrease)
4327   9                                                                              {
4328  10                                                                                      decrease=0;
4329  10                                                                                      if(auto_star>-120)auto_star--,Data_change(1);
4330  10                                                                                      auto_min=auto_star*4.25+511;
4331  10                                                                              }
4332   9                                                                      }
4333   8                                                                      else if(line_2<2)
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 71  

4334   8                                                                      {
4335   9                                                                              if(increase)
4336   9                                                                              {
4337  10                                                                                      increase=0;
4338  10                                                                                      if(auto_end<120)auto_end++,Data_change(1);
4339  10                                                                                      auto_max=auto_end*4.25+511;
4340  10                      
4341  10                                                                              }
4342   9                                                                              if(decrease)
4343   9                                                                              {
4344  10                                                                                      decrease=0;
4345  10                                                                                      if(auto_end>-120)auto_end--,Data_change(1);
4346  10                                                                                      auto_max=auto_end*4.25+511;
4347  10                                                                              }
4348   9                                                                      }
4349   8                                                                      else if(line_2<3)
4350   8                                                                      {
4351   9                                                                              if(increase)
4352   9                                                                              {
4353  10                                                                                      increase=0;
4354  10                                                                                      if(auto_speed<100)auto_speed++,Data_change(1);
4355  10                                                                              }
4356   9                                                                              if(decrease)
4357   9                                                                              {
4358  10                                                                                      decrease=0;
4359  10                                                                                      if(auto_speed>0)auto_speed--,Data_change(1);
4360  10                                                                              }
4361   9                                                                      }
4362   8                                                                      write_num100(auto_star,66,0,'/');
4363   8                                                                      write_num100(auto_end,66,2,'/');
4364   8                                                                      write_num100(auto_speed,66,4,0);
4365   8                                                                      
4366   8                                                                      
4367   8                                                              }
4368   7                                                              else if(menu_2==24)//电压设置
4369   7                                                              {
4370   8                                                                      line_2=move_cursor(line_2,2);
4371   8                                                                      
4372   8                                                                      WW[0][0]=175,WW[0][1]=70,WW[0][2]=0;
4373   8                                                                      WW[1][0]=71,WW[1][1]=72,WW[1][2]=0;
4374   8                                                                      WW[2][0]=39,WW[2][1]=40,WW[2][2]=0;                                                     
4375   8                                                                      
4376   8                                                              
4377   8                                                                      display_menu(line_2,2);
4378   8                                                                      
4379   8                                                                      temp=battery_voltage;
4380   8                                                                      if(temp>999)send2(temp%10000/1000+48,52,0);
4381   8                                                                      send2(temp%1000/100+48,60,0);
4382   8                                                                      send2('.',68,0);                                                        
4383   8                                                                      send2(temp%100/10+48,76,0);
4384   8                                                                      send2(temp%10+48,84,0);
4385   8                                                                      send2('V',92,0);
4386   8                                                                      
4387   8                                                                      
4388   8                                                                      if(Battery_1s==1)
4389   8                                                                      {
4390   9                                                                              write_num100(VLD1,60,2,'.');send2('V',92,2);
4391   9                                                                              write_num100(v_trim1,60,4,'#');
4392   9                                                                      }
4393   8                                                                      else if(Battery_1s==0)
4394   8                                                                      {
4395   9                                                                              write_num100(VLD2,60,2,'.');send2('V',92,2);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 72  

4396   9                                                                              write_num100(v_trim2,60,4,'#');
4397   9                                                                      }
4398   8                                                                      
4399   8                                                                      if(line_2<1)
4400   8                                                                      {
4401   9                                                                              
4402   9                                                                      }
4403   8                                                                      else if(line_2<2)
4404   8                                                                      {
4405   9      
4406   9                                                                              if(increase)
4407   9                                                                              {
4408  10                                                                                      increase=0;
4409  10                                                                                      if(Battery_1s==1)
4410  10                                                                                      {
4411  11                                                                                              if(VLD1<80)VLD1++;Data_change(1);
4412  11                                                                                      }
4413  10                                                                                      else if(Battery_1s==0)
4414  10                                                                                      {
4415  11                                                                                              if(VLD2<120)VLD2++;Data_change(1);
4416  11                                                                                      }
4417  10                                                                              }
4418   9                                                                              
4419   9                                                                              if(decrease)
4420   9                                                                              {
4421  10                                                                                      decrease=0;
4422  10                                                                                      if(Battery_1s==1)
4423  10                                                                                      {
4424  11                                                                                              if(VLD1>33)VLD1--;Data_change(1);
4425  11                                                                                      }
4426  10                                                                                      else if(Battery_1s==0)
4427  10                                                                                      {
4428  11                                                                                              if(VLD2>66)VLD2--;Data_change(1);
4429  11                                                                                      }
4430  10                                                                              }
4431   9                                                                              
4432   9                                                                              
4433   9                                                                                      
4434   9                                                                              
4435   9                                                                      }
4436   8                                                                      else if(line_2<3)
4437   8                                                                      {
4438   9                                                                                      
4439   9                                                                              if(increase)
4440   9                                                                              {
4441  10                                                                                      increase=0;
4442  10                                                                                      if(Battery_1s==1)
4443  10                                                                                      {
4444  11                                                                                              if(v_trim1<100)v_trim1++;Data_change(1);
4445  11                                                                                      }
4446  10                                                                                      else if(Battery_1s==0)
4447  10                                                                                      {
4448  11                                                                                              if(v_trim2<100)v_trim2++;Data_change(1);
4449  11                                                                                      }
4450  10                                                                              }
4451   9                                                                              
4452   9                                                                              if(decrease)
4453   9                                                                              {
4454  10                                                                                      decrease=0;
4455  10                                                                                      if(Battery_1s==1)
4456  10                                                                                      {
4457  11                                                                                              if(v_trim1>-100)v_trim1--;Data_change(1);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 73  

4458  11                                                                                      }
4459  10                                                                                      else if(Battery_1s==0)
4460  10                                                                                      {
4461  11                                                                                              if(v_trim2>-100)v_trim2--;Data_change(1);
4462  11                                                                                      }
4463  10                                                                              }
4464   9                                                                      }
4465   8                                                              
4466   8                                                              }
4467   7                                                              else if(menu_2==25)//接收机输出模式
4468   7                                                              {
4469   8                                                                      line_2=move_cursor(line_2,7);
4470   8                                                                      
4471   8                                                                      WW[0][0]=16,WW[0][1]=17,WW[0][2]=81,WW[0][3]=0;
4472   8                                                                      WW[1][0]=16,WW[1][1]=17,WW[1][2]=82,WW[1][3]=0;
4473   8                                                                      WW[2][0]=16,WW[2][1]=17,WW[2][2]=83,WW[2][3]=0;
4474   8                                                                      WW[3][0]=16,WW[3][1]=17,WW[3][2]=84,WW[3][3]=0;
4475   8                                                                      WW[4][0]=16,WW[4][1]=17,WW[4][2]=85,WW[4][3]=0;
4476   8                                                                      WW[5][0]=16,WW[5][1]=17,WW[5][2]=86,WW[5][3]=0;
4477   8                                                                      WW[6][0]=16,WW[6][1]=17,WW[6][2]=87,WW[6][3]=0;
4478   8                                                                      WW[7][0]=16,WW[7][1]=17,WW[7][2]=88,WW[7][3]=0;
4479   8                                                                      display_menu(line_2,7);
4480   8                                                                      send3(hzk[1],60,0);
4481   8                                                                      send3(hzk[1],60,2);
4482   8                                                                      send3(hzk[1],60,4);
4483   8                                                                      send3(hzk[1],60,6);
4484   8                                                              
4485   8                                                                      
4486   8                                                                      if(increase)
4487   8                                                                      {
4488   9                                                                              increase=0;
4489   9                                                                              if(line_2==0)
4490   9                                                                              {
4491  10                                                                                      if(receiver_mode[0]<3)receiver_mode[0]++,config_change=1,Data_change(2);
4492  10                                                                              }
4493   9                                                                              else if(line_2==1)
4494   9                                                                              {
4495  10                                                                                      if(receiver_mode[1]<2)receiver_mode[1]++,config_change=1,Data_change(2);
4496  10                                                                              }
4497   9                                                                              else if(line_2==4)
4498   9                                                                              {
4499  10                                                                                      if(receiver_mode[4]<4)receiver_mode[4]++;
4500  10                                                                                      if(receiver_mode[4]==2)
4501  10                                                                                      {
4502  11                                                                                              receiver_mode[4]=4;
4503  11                                                                                      }
4504  10                                                                                      
4505  10                                                                                      config_change=1,Data_change(2);
4506  10                                                                              }
4507   9                                                                              else if(line_2==6)
4508   9                                                                              {
4509  10                                                                                      if(receiver_mode[6]<2)receiver_mode[6]++,config_change=1,Data_change(2);
4510  10                                                                              }
4511   9                                                                              else
4512   9                                                                              {
4513  10                                                                                      if(receiver_mode[line_2]<1)receiver_mode[line_2]++,config_change=1,Data_change(2);
4514  10                                                                              }
4515   9                                                                              
4516   9                                                                      }
4517   8                                                                      if(decrease)
4518   8                                                                      {
4519   9                                                                              decrease=0;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 74  

4520   9                                                                              if(line_2==4)
4521   9                                                                              {
4522  10                                                                                      if(receiver_mode[4]>0)receiver_mode[4]--;
4523  10                                                                                      if(receiver_mode[4]==3)
4524  10                                                                                      {
4525  11                                                                                              receiver_mode[4]=1;
4526  11                                                                                      }
4527  10                                                                                      config_change=1,Data_change(2);
4528  10                                                                              }
4529   9                                                                              else
4530   9                                                                              {
4531  10                                                                                      if(receiver_mode[line_2]>0)receiver_mode[line_2]--,config_change=1,Data_change(2);
4532  10                                                                                      
4533  10                                                                              }
4534   9      
4535   9                                                                              
4536   9                                                                      }
4537   8                                                                      
4538   8                                                                      if(config_change)
4539   8                                                                      {
4540   9                                                                              config_change=0;
4541   9                                                                              tx_order[1]=0;
4542   9                                                                              if(receiver_mode[0]==3)
4543   9                                                                              {
4544  10                                                                                      tx_order[1]|=0x80;
4545  10                                                                                      
4546  10                                                                              }
4547   9                                                                              if(receiver_mode[4]==4)
4548   9                                                                              {
4549  10                                                                                      tx_order[1]|=0x40;
4550  10                                                                                      
4551  10                                                                              }
4552   9                                                                              
4553   9                                                                              if(receiver_mode[0]==2)
4554   9                                                                              {
4555  10                                                                                      tx_order[1]|=0x08;
4556  10                                                                              }
4557   9                                                                              if(receiver_mode[1]==2)
4558   9                                                                              {
4559  10                                                                                      tx_order[1]|=0x04;
4560  10                                                                              }
4561   9                                                                              if(receiver_mode[6]==2)
4562   9                                                                              {
4563  10                                                                                      tx_order[1]|=0x02;
4564  10                                                                              }
4565   9                                                                              
4566   9                                                                              tx_order[2]=0;
4567   9                                                                              if(receiver_mode[0]==1)
4568   9                                                                              {
4569  10                                                                                      tx_order[2]|=0x80;
4570  10                                                                              }
4571   9                                                                              if(receiver_mode[1]==1)
4572   9                                                                              {
4573  10                                                                                      tx_order[2]|=0x40;
4574  10                                                                              }
4575   9                                                                              if(receiver_mode[2]==1)
4576   9                                                                              {
4577  10                                                                                      tx_order[2]|=0x20;
4578  10                                                                              }
4579   9                                                                              if(receiver_mode[3]==1)
4580   9                                                                              {
4581  10                                                                                      tx_order[2]|=0x10;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 75  

4582  10                                                                              }
4583   9                                                                              if(receiver_mode[4]==1)
4584   9                                                                              {
4585  10                                                                                      tx_order[2]|=0x08;
4586  10                                                                              }
4587   9                                                                              if(receiver_mode[5]==1)
4588   9                                                                              {
4589  10                                                                                      tx_order[2]|=0x04;
4590  10                                                                              }
4591   9                                                                              if(receiver_mode[6]==1)
4592   9                                                                              {
4593  10                                                                                      tx_order[2]|=0x02;
4594  10                                                                              }
4595   9                                                                              if(receiver_mode[7]==1)
4596   9                                                                              {
4597  10                                                                                      tx_order[2]|=0x01;
4598  10                                                                              }
4599   9                                                                              
4600   9                                                                              Receiver_change=1;
4601   9                                                                      }
4602   8                                                                      
4603   8                                                                      if(line_2<3)
4604   8                                                                      {
4605   9                                                                              display_receiver_mode(receiver_mode[0],72,0);
4606   9                                                                              display_receiver_mode(receiver_mode[1],72,2);
4607   9                                                                              display_receiver_mode(receiver_mode[2],72,4);
4608   9                                                                              display_receiver_mode(receiver_mode[3],72,6);
4609   9                                                                      }
4610   8                                                                      else if(line_2==7)
4611   8                                                                      {
4612   9                                                                              display_receiver_mode(receiver_mode[4],72,0);
4613   9                                                                              display_receiver_mode(receiver_mode[5],72,2);
4614   9                                                                              display_receiver_mode(receiver_mode[6],72,4);
4615   9                                                                              display_receiver_mode(receiver_mode[7],72,6);
4616   9                                                                      }
4617   8                                                                      else 
4618   8                                                                      {
4619   9                                                                              display_receiver_mode(receiver_mode[line_2-2],72,0);
4620   9                                                                              display_receiver_mode(receiver_mode[line_2-1],72,2);
4621   9                                                                              display_receiver_mode(receiver_mode[line_2],72,4);
4622   9                                                                              display_receiver_mode(receiver_mode[line_2+1],72,6);
4623   9                                                                      }
4624   8                                                              }
4625   7                                                              else if(menu_2==26)//定时器
4626   7                                                              {
4627   8                                                                      line_2=move_cursor(line_2,2);
4628   8                                                                      
4629   8                                                                      WW[0][0]=160,WW[0][1]=161,WW[0][2]=0;
4630   8                                                                      WW[1][0]=58,WW[1][1]=59,WW[1][2]=0;
4631   8                                                                      WW[2][0]=71,WW[2][1]=72,WW[2][2]=0;                                                     
4632   8                                                                      
4633   8                                                              
4634   8                                                                      display_menu(line_2,2);
4635   8                                                                      
4636   8                                                                      if(clock_switch)
4637   8                                                                      {
4638   9                                                                              if(clock_go)send3(hzk[196],60,0),send3(hzk[182],72,0);
4639   9                                                                              else
4640   9                                                                              {
4641  10                                                                                      
4642  10                                                                                      if(Switch_Check(clock_switch)==2)send3(hzk[199],60,0),send3(hzk[200],72,0);
4643  10                                                                                      else send3(hzk[211],60,0),send3(hzk[212],72,0);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 76  

4644  10                                                                              
4645  10                                                                              }
4646   9                                                                      }
4647   8                                                                      else send3(hzk[0],60,0),send3(hzk[0],72,0);
4648   8                                                                              
4649   8                                                                                      
4650   8                                                                      
4651   8                                                                      display_switch(clock_switch,60,2);
4652   8                                                                      write_num100(clock_set,60,4,0);send3(hzk[174],84,4);send3(hzk[135],96,4);
4653   8                                                                      
4654   8                                                                      if(line_2==1)
4655   8                                                                      {
4656   9                                                                              if(increase)
4657   9                                                                              {
4658  10                                                                                      increase=0;
4659  10                                                                                      if(clock_switch<5)clock_switch++,Data_change(1);
4660  10                                                                                      
4661  10                                                                              }
4662   9                                                                              if(decrease)
4663   9                                                                              {
4664  10                                                                                      decrease=0;
4665  10                                                                                      if(clock_switch>0)clock_switch--,Data_change(1);
4666  10      
4667  10                                                                              }
4668   9                                                                      }
4669   8                                                                      if(line_2==2)
4670   8                                                                      {
4671   9                                                                              if(increase)
4672   9                                                                              {
4673  10                                                                                      increase=0;
4674  10                                                                                      
4675  10                                                                                              if(clock_set<60)clock_set++;Data_change(1);
4676  10                                                                                      
4677  10                                                                              }
4678   9                                                                              
4679   9                                                                              if(decrease)
4680   9                                                                              {
4681  10                                                                                      decrease=0;
4682  10                                                                                      
4683  10                                                                                              if(clock_set>0)clock_set--;Data_change(1);
4684  10                                                                                      
4685  10                                                                              }
4686   9                                                                      }                                                               
4687   8                                                                      
4688   8                                                                      
4689   8                                                              }
4690   7                                                              else if(menu_2==27)//开机画面
4691   7                                                              {
4692   8                                                                      line_2=move_cursor(line_2,1);
4693   8                                                                      
4694   8                                                                      if(line_2<1)
4695   8                                                                      {
4696   9                                                                              photo(screen3,0,0,128,8);
4697   9                                                                      }
4698   8                                                                      else if(line_2<2)
4699   8                                                                      {
4700   9                                                                              photo(screen4,0,0,128,8);
4701   9                                                                      }
4702   8                                                                      
4703   8                                                                      if(right)
4704   8                                                                      {
4705   9                                                                              right=0;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 77  

4706   9                                                                              boot_screen=line_2;Data_change(1);
4707   9                                                                              menu_2=0;
4708   9                                                                      }
4709   8                                                                      
4710   8                                                              }
4711   7                                                              else if(menu_2==28)//偏好设置
4712   7                                                              {
4713   8                                                                      line_2=move_cursor(line_2,3);
4714   8                                                                      
4715   8                                                                      WW[0][0]=56,WW[0][1]=57,WW[0][2]=0;
4716   8                                                                      WW[1][0]=141,WW[1][1]=142,WW[1][2]=104,WW[1][3]=194,WW[1][4]=0;
4717   8                                                                      WW[2][0]=141,WW[2][1]=142,WW[2][2]=195,WW[2][3]=196,WW[2][4]=0;
4718   8                                                                      WW[3][0]=39,WW[3][1]=40,WW[3][2]=197,WW[3][3]=198,WW[3][4]=0;
4719   8                                                                      
4720   8                                                                      display_menu(line_2,3);
4721   8                                                                      
4722   8                                                                      if(Sound_enable)send3(hzk[58],72,0);
4723   8                                                                      else send3(hzk[59],72,0);
4724   8                                                                      if(Throttle_check)send3(hzk[58],72,2),send3(hzk[132],84,2);
4725   8                                                                      else send3(hzk[10],72,2);
4726   8                                                                      if(Auto_lock)send3(hzk[104],72,4),send3(hzk[105],84,4);
4727   8                                                                      else send3(hzk[191],72,4),send3(hzk[105],84,4);
4728   8                                                                      if(Trim_step)send2('1',72,6);
4729   8                                                                      else send2('5',72,6);
4730   8                                              //                      if(Right_throttle)send3(hzk[190],68,2),send3(hzk[191],80,2);
4731   8                                              //                      else send3(hzk[189],68,2),send3(hzk[191],80,2);
4732   8                                                                      
4733   8                                                                      if(line_2<1)
4734   8                                                                      {
4735   9                                                                              if(increase|decrease)
4736   9                                                                              {
4737  10                                                                                      increase=0;decrease=0;
4738  10                                                                                      
4739  10                                                                                              Sound_enable=!Sound_enable;Data_change(1);
4740  10                                                                                      
4741  10                                                                              }       
4742   9                                                                      }
4743   8                                                                      if(line_2<2)
4744   8                                                                      {
4745   9                                                                              if(increase|decrease)
4746   9                                                                              {
4747  10                                                                                      increase=0;decrease=0;
4748  10                                                                                      
4749  10                                                                                              Throttle_check=!Throttle_check;Data_change(1);
4750  10                                                                                      
4751  10                                                                              }       
4752   9                                                                      }
4753   8                                                                      if(line_2<3)
4754   8                                                                      {
4755   9                                                                              if(increase|decrease)
4756   9                                                                              {
4757  10                                                                                      increase=0;decrease=0;
4758  10                                                                                      
4759  10                                                                                              Auto_lock=!Auto_lock;Data_change(1);
4760  10                                                                                      
4761  10                                                                              }       
4762   9                                                                      }
4763   8                                                                      if(line_2<4)
4764   8                                                                      {
4765   9                                                                              if(increase|decrease)
4766   9                                                                              {
4767  10                                                                                      increase=0;decrease=0;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 78  

4768  10                                                                                      
4769  10                                                                                              Trim_step=!Trim_step;Data_change(1);
4770  10                                                                                      
4771  10                                                                              }       
4772   9                                                                      }
4773   8                                      /*                              else if(line_2<2)
4774   8                                                                      {
4775   8                                                                              if(increase|decrease)
4776   8                                                                              {
4777   8                                                                                      increase=0;decrease=0;
4778   8                                                                                      
4779   8                                                                                              Right_throttle=!Right_throttle;Data_change(1);
4780   8                                                                                      
4781   8                                                                              }       
4782   8                                                                      }*/
4783   8                                                              }
4784   7                                                              else if(menu_2==29)//指数曲线
4785   7                                                              {
4786   8                                                                      line_2=move_cursor(line_2,1);
4787   8                                                                      
4788   8                                                                      if(line_2==0)
4789   8                                                                      {
4790   9                                                                              if(increase)
4791   9                                                                              {                                                                       
4792  10                                                                                      increase=0;
4793  10                                                                                      if(index_number<2)index_number++;
4794  10                                                                                      
4795  10                                                                              }
4796   9                                                                              if(decrease)
4797   9                                                                              {                                                                       
4798  10                                                                                      decrease=0;
4799  10                                                                                      if(index_number>0)index_number--;
4800  10                                                                                      
4801  10                                                                              }
4802   9                                                                      }
4803   8                                                                      if(line_2==1)
4804   8                                                                      {
4805   9                                                                              if(increase)
4806   9                                                                              {                                                                       
4807  10                                                                                      increase=0;
4808  10                                                                                      if(CH_index[index_number]<100)CH_index[index_number]++,Data_change(2);
4809  10                                                                                      
4810  10                                                                              }
4811   9                                                                              if(decrease)
4812   9                                                                              {                                                                       
4813  10                                                                                      decrease=0;
4814  10                                                                                      if(CH_index[index_number]>-100)CH_index[index_number]--,Data_change(2);
4815  10                                                                                      
4816  10                                                                              }
4817   9                                                                      }
4818   8                                                                      
4819   8                                                                      send3(hzk[1],0,line_2+line_2);
4820   8                                                                      send3(hzk[2],0,2-line_2-line_2);
4821   8      
4822   8                                                                      send3(hzk[94],12,0);send3(hzk[95],24,0);
4823   8                                                                      
4824   8                                                                      if(index_number==2)send3(hzk[84],36,0);
4825   8                                                                      else send3(hzk[81+index_number],36,0);
4826   8      
4827   8                                                                      write_num100(CH_index[index_number],24,2,'/');
4828   8                                                                      
4829   8                                                                      if(last_index!=CH_index[index_number])
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 79  

4830   8                                                                      {
4831   9                                                                              
4832   9                                                                              last_index=CH_index[index_number];
4833   9                                                                              index_change=1;
4834   9                                                                      }
4835   8                                                                      
4836   8                                                                      
4837   8                                                                      display_curve();
4838   8                                                                      
4839   8                                                              }
4840   7                                                              else if(menu_2==30)//多点曲线
4841   7                                                              {
4842   8                                                                      line_2=move_cursor(line_2,2);                                                                                                           
4843   8                                                                      
4844   8                                                                      
4845   8                                                                      if(line_2==0)
4846   8                                                                      {
4847   9                                                                              if(increase)
4848   9                                                                              {                                                                       
4849  10                                                                                      increase=0;
4850  10                                                                                      if(curve_num<4)curve_num++;
4851  10                                                                                      
4852  10                                                                              }
4853   9                                                                              if(decrease)
4854   9                                                                              {                                                                       
4855  10                                                                                      decrease=0;
4856  10                                                                                      if(curve_num>0)curve_num--;
4857  10                                                                                      
4858  10                                                                              }
4859   9                                                                              
4860   9                                                                              send3(hzk[1],0,0);
4861   9                                                                              send3(hzk[2],0,2);
4862   9                                                                              send3(hzk[2],0,4);
4863   9                                                                      }
4864   8                                                                      else if(line_2==1)
4865   8                                                                      {
4866   9                                                                              if(increase)
4867   9                                                                              {                                                                       
4868  10                                                                                      increase=0;
4869  10                                                                                      if(point_num<6)point_num++;
4870  10                                                                                      
4871  10                                                                              }
4872   9                                                                              if(decrease)
4873   9                                                                              {                                                                       
4874  10                                                                                      decrease=0;
4875  10                                                                                      if(point_num>0)point_num--;
4876  10                                                                                      
4877  10                                                                              }
4878   9                                                                              
4879   9                                                                              send3(hzk[2],0,0);
4880   9                                                                              send3(hzk[1],0,2);
4881   9                                                                              send3(hzk[2],0,4);
4882   9                                                                      }
4883   8                                                                      else if(line_2==2)
4884   8                                                                      {
4885   9                                                                              if(increase)
4886   9                                                                              {
4887  10                                                                                      increase=0;
4888  10                                                                                      if(turnning_point[curve_num][point_num]<100)
4889  10                                                                                      {
4890  11                                                                                              turnning_point[curve_num][point_num]++,Data_change(2);
4891  11                                                                                      }
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 80  

4892  10                                                                              }
4893   9                                                                              if(decrease)
4894   9                                                                              {
4895  10                                                                                      decrease=0;
4896  10                                                                                      if(turnning_point[curve_num][point_num]>0)
4897  10                                                                                      {
4898  11                                                                                              turnning_point[curve_num][point_num]--,Data_change(2);
4899  11                                                                                      }
4900  10                                                                              }       
4901   9                                                                              
4902   9                                                                              send3(hzk[2],0,0);
4903   9                                                                              send3(hzk[2],0,2);
4904   9                                                                              send3(hzk[1],0,4);
4905   9                                                                      }
4906   8                                                                                                                              
4907   8                                                                      
4908   8                                                                      
4909   8                                      
4910   8                                                                      send3(hzk[94],12,0);send3(hzk[95],24,0);
4911   8                                                                      if(curve_num==0)send3(hzk[83],40,0);
4912   8                                                                      else if(curve_num>0)send3(hzk[84+curve_num],40,0);
4913   8                                                                              
4914   8                                      
4915   8                                                                      send3(hzk[51],12,2);
4916   8                                                                      send3(hzk[81+point_num],28,2);
4917   8                                                                      
4918   8                                                                      write_num100(turnning_point[curve_num][point_num],12,4,'%');
4919   8                                                                      get_curve2();
4920   8                                                                      display_curve2();
4921   8                                                              }
4922   7                                                              else if(menu_2==31)//组合开关
4923   7                                                              {
4924   8                                                                      line_2=move_cursor(line_2,4);
4925   8                                                              
4926   8                                                                      WW[0][0]=160,WW[0][1]=161,WW[0][2]=0;
4927   8                                                                      WW[1][0]=83,WW[1][1]=205,WW[1][2]=0;
4928   8                                                                      WW[2][0]=82,WW[2][1]=205,WW[2][2]=0;
4929   8                                                                      WW[3][0]=38,WW[3][1]=30,WW[3][2]=0;
4930   8                                                                      WW[4][0]=36,WW[4][1]=37,WW[4][2]=0;
4931   8                                                                      
4932   8                                                                      display_menu(line_2,4);
4933   8                                                                      
4934   8                                                                      if(line_2<3)
4935   8                                                                      {
4936   9                                                                              if(Com_Swt_IN1)
4937   9                                                                              {
4938  10                                                                                      send3(hzk[8],60,0),send3(hzk[9],72,0);                                                          
4939  10                                                                                      send3(hzk[81+Combination_Switch],84,0); 
4940  10                                                                              }
4941   9                                                                              else
4942   9                                                                              {
4943  10                                                                                      send3(hzk[2],60,0),send3(hzk[59],72,0);send3(hzk[2],84,0);
4944  10                                                                              }
4945   9                                                                              
4946   9                                                                              
4947   9                                                                              display_switch(Com_Swt_IN1,60,2);
4948   9                                                                              display_switch(Com_Swt_IN2,60,4);       
4949   9                                                                              send3(hzk[94],60,6);send3(hzk[95],72,6);send3(hzk[Com_Swt_mapping+81],84,6);
4950   9                                                                      }
4951   8                                                                      else
4952   8                                                                      {
4953   9                                                                              display_switch(Com_Swt_IN1,60,0);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 81  

4954   9                                                                              display_switch(Com_Swt_IN2,60,2);
4955   9                                                                              send3(hzk[94],60,4);send3(hzk[95],72,4);send3(hzk[Com_Swt_mapping+81],84,4);
4956   9                                                                      }
4957   8                                                                      
4958   8                                                                      
4959   8                                                                      
4960   8                                                                      if(line_2==1)
4961   8                                                                      {
4962   9                                                                              if(increase)
4963   9                                                                              {
4964  10                                                                                      increase=0;
4965  10                                                                                      if(Com_Swt_IN1==0)Com_Swt_IN1=2,Data_change(1);
4966  10                                                                                      else if(Com_Swt_IN1==2)Com_Swt_IN1=3,Data_change(1);
4967  10                                                                              }
4968   9                                                                              if(decrease)
4969   9                                                                              {
4970  10                                                                                      decrease=0;
4971  10                                                                                      if(Com_Swt_IN1==2)Com_Swt_IN1=0,Data_change(1);
4972  10                                                                                      else if(Com_Swt_IN1==3)Com_Swt_IN1=2,Data_change(1);
4973  10      
4974  10                                                                              }
4975   9                                                                      }
4976   8                                                                      if(line_2==2)
4977   8                                                                      {
4978   9                                                                              if(increase)
4979   9                                                                              {
4980  10                                                                                      increase=0;
4981  10                                                                                      if(Com_Swt_IN2<5)Com_Swt_IN2++,Data_change(1);
4982  10                                                                                      if(Com_Swt_IN2==2)Com_Swt_IN2=4;
4983  10                                                                              }
4984   9                                                                              if(decrease)
4985   9                                                                              {
4986  10                                                                                      decrease=0;
4987  10                                                                                      if(Com_Swt_IN2>0)Com_Swt_IN2--,Data_change(1);
4988  10                                                                                      if(Com_Swt_IN2==3)Com_Swt_IN2=1;
4989  10                                                                              }
4990   9                                                                      }
4991   8                                                                      if(line_2==3)
4992   8                                                                      {
4993   9                                                                              if(increase)
4994   9                                                                              {
4995  10                                                                                      increase=0;
4996  10                                                                                      if(Com_Swt_mapping<7)Com_Swt_mapping++,Data_change(1);
4997  10                                                                              }
4998   9                                                                              if(decrease)
4999   9                                                                              {
5000  10                                                                                      decrease=0;
5001  10                                                                                      if(Com_Swt_mapping>0)Com_Swt_mapping--,Data_change(1);
5002  10      
5003  10                                                                              }
5004   9                                                                      }
5005   8                                                                      if(line_2==4)
5006   8                                                                      {
5007   9                                                                              if(right)
5008   9                                                                              {
5009  10                                                                                      right=0;menu_3=2,line_3=0;
5010  10                                                                                      
5011  10                                                                              }
5012   9                                                                      }
5013   8                                                                      
5014   8                                                                      
5015   8                                                              }
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 82  

5016   7                                                              else if(menu_2==32)//
5017   7                                                              {
5018   8                                                                      line_2=move_cursor(line_2,1);
5019   8                                                                      
5020   8                                                                      
5021   8                                                              }
5022   7                                                              else if(menu_2==33)//
5023   7                                                              {
5024   8                                                                      line_2=move_cursor(line_2,1);
5025   8                                                                      
5026   8                                                                      
5027   8                                                              }
5028   7                                                              
5029   7                                                              
5030   7                                                              if(left)left=0,menu_2=0,star=1;
5031   7                                                              increase=0;decrease=0;right=0;  
5032   7                                                      }
5033   6                                                      
5034   6                                                      
5035   6                                              }
5036   5                                              else 
5037   5                                              {
5038   6      
5039   6                                                      if(menu_1==1)//工作模式
5040   6                                                      {
5041   7                                                              line_1=move_cursor(line_1,2);
5042   7                                                              
5043   7                                                              WW[0][0]=10,WW[0][1]=11,WW[0][2]=29,WW[0][3]=30,WW[0][4]=0;
5044   7                                                              WW[1][0]=192,WW[1][1]=193,WW[1][2]=31,WW[1][3]=32,WW[1][4]=0;
5045   7                                                              WW[2][0]=192,WW[2][1]=193,WW[2][2]=31,WW[2][3]=33,WW[2][4]=0;
5046   7                                                              
5047   7                                                              display_menu(line_1,2);
5048   7                                                              
5049   7                                                              if(line_1==0)//无线
5050   7                                                              {                                                               
5051   8                                                                      if(right)
5052   8                                                                      {
5053   9                                                                              right=0;
5054   9                                                                              if(RC_TX)
5055   9                                                                              {
5056  10                                                                                      RC_TX=0;Data_change(1);
5057  10                                                                              }
5058   9                                                                              else
5059   9                                                                              {
5060  10                                                                                      IR_TX=0,RC_TX=1;Data_change(1);
5061  10                                                                                      
5062  10                                                                              }
5063   9                                                                      }
5064   8                                                              }
5065   7                                                              else if(line_1==1)//PPM
5066   7                                                              {
5067   8                                                                      if(right)
5068   8                                                                      {
5069   9                                                                              right=0;
5070   9                                                                              if(PPM_OUT)
5071   9                                                                              {
5072  10                                                                                      PPM_OUT=0;Data_change(1);
5073  10                                                                                      ET1=0;P3M0=0x00;
5074  10                                                                              }
5075   9                                                                              else
5076   9                                                                              {
5077  10                                                                                      PPM_OUT=1,PPM_IN=0;config_change=1;Data_change(1);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 83  

5078  10                                                                                      EX1=0;ET1=1;TMOD=0x11;P3M0=0x08;
5079  10                                                                              }
5080   9                                                                      }
5081   8                                                                       
5082   8                                                              }
5083   7                                                              else 
5084   7                                                              {
5085   8                                                                      if(right)
5086   8                                                                      {
5087   9                                                                              right=0;
5088   9                                                                              if(PPM_IN)
5089   9                                                                              {
5090  10                                                                                      PPM_IN=0;EX1=0;Data_change(1);
5091  10                                                                              }
5092   9                                                                              else
5093   9                                                                              {
5094  10                                                                                      PPM_IN=1,PPM_OUT=0;config_change=1;Data_change(1);
5095  10                                                                                      TMOD=0x91;
5096  10                                                                                      EX1=1;ET1=0;P3M0=0x00;
5097  10                                                                      //              P3M0=0x60;                       
5098  10                                                                                      
5099  10                                                                              }
5100   9                                                                      }
5101   8                                                                      
5102   8                                                              }
5103   7                                                              if(RC_TX)send3(hzk[3],62,0);
5104   7                                                              else send3(hzk[2],62,0);
5105   7                                                              if(PPM_IN)send3(hzk[3],62,4);
5106   7                                                              else send3(hzk[2],62,4);
5107   7                                                              if(PPM_OUT)send3(hzk[3],62,2);
5108   7                                                              else send3(hzk[2],62,2);
5109   7                                                      }
5110   6                                                      else if(menu_1==2)//快捷功能
5111   6                                                      {
5112   7                                                              line_1=move_cursor(line_1,3);
5113   7                                                              
5114   7                                                              WW[0][0]=181,WW[0][1]=182,WW[0][2]=80,WW[0][3]=0;
5115   7                                                              WW[1][0]=183,WW[1][1]=184,WW[1][2]=36,WW[1][3]=0;
5116   7                                                              WW[2][0]=203,WW[2][1]=204,WW[2][2]=58,WW[2][3]=59,WW[2][4]=0;
5117   7                                                              WW[3][0]=66,WW[3][1]=67,WW[3][2]=71,WW[3][3]=72,WW[3][4]=0;
5118   7      
5119   7                                                              display_menu(line_1,3);
5120   7                                                              
5121   7                                                              
5122   7                                                              
5123   7                                                              if(line_1==0)
5124   7                                                              {
5125   8      
5126   8                                                                      if(right)right=0,menu_2=26,line_2=0,star=1;
5127   8                                                              }
5128   7                                                              else if(line_1==1)
5129   7                                                              {
5130   8      
5131   8                                                                      if(right)right=0,menu_2=16,line_2=0;
5132   8                                                              }
5133   7                                                              else if(line_1==2)
5134   7                                                              {
5135   8      
5136   8                                                                      if(right)right=0,menu_2=31,line_2=0;
5137   8                                                              }
5138   7                                                              else if(line_1==3)
5139   7                                                              {
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 84  

5140   8      
5141   8                                                                      if(right)right=0,menu_2=13,line_2=0;
5142   8                                                              }
5143   7      
5144   7                                                              
5145   7                                                      }
5146   6                                                      else if(menu_1==3)//通道设置
5147   6                                                      {
5148   7                                                              line_1=move_cursor(line_1,6);
5149   7                                                              
5150   7                                                              WW[0][0]=34,WW[0][1]=35,WW[0][2]=0;
5151   7                                                              WW[1][0]=39,WW[1][1]=40,WW[1][2]=0;
5152   7                                                              WW[2][0]=34,WW[2][1]=36,WW[2][2]=37,WW[2][3]=0;
5153   7                                                              WW[3][0]=134,WW[3][1]=36,WW[3][2]=37,WW[3][3]=0;
5154   7                                                              WW[4][0]=31,WW[4][1]=33,WW[4][2]=38,WW[4][3]=30,WW[4][4]=0;
5155   7                                                              WW[5][0]=143,WW[5][1]=144,WW[5][2]=118,WW[5][3]=11,WW[5][4]=0;
5156   7                                                              WW[6][0]=50,WW[6][1]=51,WW[6][2]=118,WW[6][3]=11,WW[6][4]=0;
5157   7                                                              display_menu(line_1,6);
5158   7                                                              
5159   7                                                              
5160   7                                                              if(line_1==0)
5161   7                                                              {
5162   8                                                                      if(right)right=0,menu_2=1,line_2=0;
5163   8                                                              }
5164   7                                                              else if(line_1==1)
5165   7                                                              {
5166   8                                                                      if(right)right=0,menu_2=4,line_2=0;
5167   8                                                              }
5168   7                                                              else if(line_1==2)
5169   7                                                              {
5170   8                                                                      if(right)right=0,menu_2=2,line_2=0,ratio_mode=1;
5171   8                                                              }
5172   7                                                              else if(line_1==3)
5173   7                                                              {
5174   8                                                                      if(right)right=0,menu_2=2,line_2=0,ratio_mode=0;
5175   8                                                              }
5176   7                                                              else if(line_1==4)
5177   7                                                              {
5178   8                                                                      if(right)right=0,menu_2=3,line_2=0;
5179   8                                                              }
5180   7                                                              else if(line_1==5)
5181   7                                                              {
5182   8                                                                      if(right)right=0,menu_2=29,line_2=0,index_change=1;
5183   8                                                              }
5184   7                                                              else 
5185   7                                                              {
5186   8                                                                      if(right)right=0,menu_2=30,line_2=0;
5187   8                                                              }
5188   7                                                      }
5189   6                                                      else if(menu_1==4)//高级混控
5190   6                                                      {
5191   7                                                              line_1=move_cursor(line_1,3);
5192   7                                                              
5193   7                                                              WW[0][0]=21,WW[0][1]=22,WW[0][2]=80,WW[0][3]=81,WW[0][4]=0;
5194   7                                                              WW[1][0]=21,WW[1][1]=22,WW[1][2]=80,WW[1][3]=82,WW[1][4]=0;
5195   7                                                              WW[2][0]=21,WW[2][1]=22,WW[2][2]=80,WW[2][3]=83,WW[2][4]=0;
5196   7                                                              WW[3][0]=21,WW[3][1]=22,WW[3][2]=80,WW[3][3]=84,WW[3][4]=0;
5197   7                                                              display_menu(line_1,3);
5198   7                                                              
5199   7                                                              if(increase|decrease)
5200   7                                                              {
5201   8                                                                      increase=0;decrease=0;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 85  

5202   8                                                                      if(line_1<1)mixer1=!mixer1,Data_change(2);
5203   8                                                                      else if(line_1<2)mixer2=!mixer2,Data_change(2);
5204   8                                                                      else if(line_1<3)mixer3=!mixer3,Data_change(2);
5205   8                                                                      else if(line_1<4)mixer4=!mixer4,Data_change(2);
5206   8                                                              }
5207   7                                                              
5208   7                                                              if(mixer1)send3(hzk[58],75,0);
5209   7                                                              else send3(hzk[59],75,0);
5210   7                                                              if(mixer2)send3(hzk[58],75,2);
5211   7                                                              else send3(hzk[59],75,2);
5212   7                                                              if(mixer3)send3(hzk[58],75,4);
5213   7                                                              else send3(hzk[59],75,4);
5214   7                                                              if(mixer4)send3(hzk[58],75,6);
5215   7                                                              else send3(hzk[59],75,6);
5216   7                                                              if(right)right=0,menu_2=5,line_2=0,star=1,mixer_name=line_1+1;                                          
5217   7                                                              
5218   7                                                      }
5219   6                                                      else if(menu_1==5)//无线配置
5220   6                                                      {
5221   7                                                              line_1=move_cursor(line_1,4);
5222   7                                                              
5223   7                                                                                                              
5224   7                                                              WW[0][0]=16,WW[0][1]=47,WW[0][2]=48,WW[0][3]=49,WW[0][4]=0;
5225   7                                                              WW[1][0]=50,WW[1][1]=51,WW[1][2]=52,WW[1][3]=53,WW[1][4]=0;
5226   7                                                              WW[2][0]=76,WW[2][1]=53,WW[2][2]=77,WW[2][3]=78,WW[2][4]=0;                                                     
5227   7                                                              WW[3][0]=16,WW[3][1]=47,WW[3][2]=119,WW[3][3]=120,WW[3][4]=0;
5228   7                                                              WW[4][0]=29,WW[4][1]=30,WW[4][2]=27,WW[4][3]=45,WW[4][4]=0;
5229   7                                                              display_menu(line_1,4);
5230   7                                                              
5231   7      
5232   7                                                              if(line_1<1)
5233   7                                                              {
5234   8      
5235   8                                                                      if(right)right=0,menu_2=7,line_2=0,star=1;
5236   8                                                              }
5237   7                                                              else if(line_1<2)
5238   7                                                              {
5239   8      
5240   8                                                                      if(right)right=0,menu_2=8,line_2=0;
5241   8                                                              }
5242   7                                                              else if(line_1<3)
5243   7                                                              {
5244   8      
5245   8                                                                      if(right)
5246   8                                                                      {
5247   9                                                                              right=0;
5248   9                                                                              menu_2=19,star=1,line_2=0;
5249   9                                                                              RC_check=1,RC_check_star=1;
5250   9                                                                              
5251   9                                                                      }
5252   8                                                                      
5253   8                                                              }
5254   7                                                              else if(line_1<4)
5255   7                                                              {
5256   8                                                                      if(right)right=0,menu_2=18,line_2=0;
5257   8                                                              }
5258   7                                                              else if(line_1<5)
5259   7                                                              {
5260   8                                                                      if(increase)
5261   8                                                                      {
5262   9                                                                              increase=0;        
5263   9                                                                              if(TX_power<3)TX_power++,Data_change(1),NRF_change=1;   
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 86  

5264   9                                                                      }
5265   8                                                                      if(decrease)
5266   8                                                                      {
5267   9                                                                              decrease=0;
5268   9                                                                              if(TX_power>0)TX_power--,Data_change(1),NRF_change=1;
5269   9                                                                      }
5270   8                                                                      
5271   8                                                                      if(TX_power==3)
5272   8                                                                      {
5273   9                                                                              send2('1',60,6);send2('0',68,6);send2('0',76,6);send2('m',84,6);send2('W',92,6);
5274   9                                                                      }
5275   8                                                                      else if(TX_power==2)
5276   8                                                                      {
5277   9                                                                              send2(' ',60,6);send2('2',68,6);send2('5',76,6);send2('m',84,6);send2('W',92,6);
5278   9                                                                      }
5279   8                                                                      else if(TX_power==1)
5280   8                                                                      {
5281   9                                                                              send2(' ',60,6);send2(' ',68,6);send2('6',76,6);send2('m',84,6);send2('W',92,6);
5282   9                                                                      }
5283   8                                                                      else if(TX_power==0)
5284   8                                                                      {
5285   9                                                                              send2(' ',60,6);send2(' ',68,6);send2('2',76,6);send2('m',84,6);send2('W',92,6);
5286   9                                                                      }
5287   8                                                                      else 
5288   8                                                                      {
5289   9                                                                              send2('E',60,6);send2('R',68,6);send2('R',76,6);send2('O',84,6);send2('R',92,6);
5290   9      
5291   9                                                                      }
5292   8                                                                      
5293   8                                                              }                                               
5294   7                                                              
5295   7                                                      }
5296   6                                                      else if(menu_1==6)//红外配置
5297   6                                                      {
5298   7      
5299   7                                                      }
5300   6                                                      else if(menu_1==7)//PPM配置
5301   6                                                      {               
5302   7                                                              
5303   7                                                              line_1=move_cursor(line_1,3);
5304   7                                                              
5305   7                                                              WW[0][0]=31,WW[0][1]=32,WW[0][2]=38,WW[0][3]=30,WW[0][4]=0;
5306   7                                                              WW[1][0]=31,WW[1][1]=33,WW[1][2]=98,WW[1][3]=99,WW[1][4]=0;
5307   7                                                              WW[2][0]=54,WW[2][1]=55,WW[2][2]=160,WW[2][3]=161,WW[2][4]=0;
5308   7                                                              WW[3][0]=54,WW[3][1]=55,WW[3][2]=58,WW[3][3]=59,WW[3][4]=0;
5309   7                                                              display_menu(line_1,3);
5310   7                                                              
5311   7                                                              if(line_1<1)
5312   7                                                              {
5313   8                                                                      if(right)right=0,menu_2=15,line_2=0,star=1;
5314   8                                                              }
5315   7                                                              else if(line_1<2)
5316   7                                                              {
5317   8                                                              if(right)right=0,menu_2=21,line_2=0,delay_time=20,star=1;
5318   8                                                              }
5319   7                                                              else if(line_1<3)
5320   7                                                              {
5321   8                                                                              
5322   8                                                              }
5323   7                                                              else 
5324   7                                                              {
5325   8                                                                      if(increase)
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 87  

5326   8                                                                      {
5327   9                                                                              increase=0;
5328   9                                                                              if(train_switch<5)train_switch++,Data_change(1);
5329   9                                                                      
5330   9                                                                              
5331   9                                                                      }
5332   8                                                                      if(decrease)
5333   8                                                                      {
5334   9                                                                              decrease=0;
5335   9                                                                              if(train_switch>0)train_switch--,Data_change(1);
5336   9      
5337   9                                                                      }
5338   8      
5339   8                              
5340   8                                                              }
5341   7                                                              if(PPM_updata>0)
5342   7                                                              {
5343   8                                                                      if(train_output)
5344   8                                                                      {
5345   9                                                                              send3(hzk[2],72,4),send3(hzk[58],84,4),send3(hzk[2],96,4);
5346   9                                                                      }
5347   8                                                                      else send3(hzk[2],72,4),send3(hzk[59],84,4),send3(hzk[2],96,4);
5348   8      
5349   8                                                              }
5350   7                                                              else send3(hzk[10],72,4),send3(hzk[47],84,4),send3(hzk[68],96,4);
5351   7                                                              
5352   7                                                              display_switch(train_switch,72,6);
5353   7      
5354   7                                                      }
5355   6                                                      else if(menu_1==8)//系统设置
5356   6                                                      {
5357   7                                                              line_1=move_cursor(line_1,8);
5358   7                                                              
5359   7                                                              WW[0][0]=62,WW[0][1]=63,WW[0][2]=18,WW[0][3]=13,WW[0][4]=0;
5360   7                                                              WW[1][0]=133,WW[1][1]=152,WW[1][2]=18,WW[1][3]=13,WW[1][4]=0;
5361   7                                                              WW[2][0]=175,WW[2][1]=70,WW[2][2]=18,WW[2][3]=13,WW[2][4]=0;
5362   7                                                              WW[3][0]=58,WW[3][1]=132,WW[3][2]=145,WW[3][3]=146,WW[3][4]=0;
5363   7                                                              WW[4][0]=154,WW[4][1]=155,WW[4][2]=144,WW[4][3]=156,WW[4][4]=0;
5364   7                                                              WW[5][0]=36,WW[5][1]=37,WW[5][2]=167,WW[5][3]=168,WW[5][4]=0;
5365   7                                                              WW[6][0]=96,WW[6][1]=97,WW[6][2]=98,WW[6][3]=99,WW[6][4]=0;
5366   7                                                              WW[7][0]=73,WW[7][1]=74,WW[7][2]=47,WW[7][3]=75,WW[7][4]=0;
5367   7                                                              
5368   7                                                              WW[8][0]=106,WW[8][1]=107,WW[8][2]=32,WW[8][3]=136,WW[8][4]=0;
5369   7                                                              display_menu(line_1,8);
5370   7                                                              
5371   7                                                              if(line_1<1)
5372   7                                                              {
5373   8                                                                      if(right)right=0,menu_2=14,line_2=0,star=1;
5374   8                                                              }
5375   7                                                              else if(line_1<2)
5376   7                                                              {
5377   8                                                                      if(right)right=0,menu_2=28,line_2=0;
5378   8                                                              }
5379   7                                                              else if(line_1<3)
5380   7                                                              {
5381   8                                                                      if(right)right=0,menu_2=24,line_2=0;
5382   8                                                                      
5383   8                                                              }
5384   7                                                              else if(line_1<4)
5385   7                                                              {
5386   8                                                                      if(right)right=0,menu_2=27,line_2=0;
5387   8                                                                      if(increase|decrease)
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 88  

5388   8                                                                      {
5389   9                                                                              increase=0;decrease=0;
5390   9                                                                              boot_screen_en=!boot_screen_en;
5391   9                                                                                      Data_change(1);
5392   9                                                                      }
5393   8                                                                      if(boot_screen_en)send3(hzk[58],72,4);
5394   8                                                                      else send3(hzk[59],72,4);
5395   8                                                                      
5396   8                                                                      
5397   8                                                              }
5398   7                                                              else if(line_1<5)
5399   7                                                              {
5400   8                                                                      if(right)right=0,menu_2=17,line_2=0,star=1;
5401   8                                                                              
5402   8                                                              }
5403   7                                                              else if(line_1<6)
5404   7                                                              {
5405   8                                                                      if(right)right=0,menu_2=22,star=1,line_2=0;     
5406   8                                                              }
5407   7                                                              else if(line_1<7)
5408   7                                                              {
5409   8                                                                      if(right)right=0,menu_2=20,line_2=0,star=1;
5410   8                                                              }
5411   7                                                              else if(line_1<8)
5412   7                                                              {
5413   8                                                                      if(right)right=0,menu_2=10,line_2=0,star=1;
5414   8                                                              }
5415   7                                                              else if(line_1<9)
5416   7                                                              {
5417   8                                                                      if(right)right=0,menu_2=12,line_2=0,star=1;
5418   8      
5419   8                                                              }
5420   7                                                              
5421   7                                                      }
5422   6                                                      else if(menu_1==9)//角度传感
5423   6                                                      {
5424   7                                                              
5425   7                                                      }
5426   6                                                      else if(menu_1==10)//自动控制
5427   6                                                      {
5428   7                                                              line_1=move_cursor(line_1,3);
5429   7                                                              
5430   7                                                              WW[0][0]=160,WW[0][1]=161,WW[0][2]=0;
5431   7                                                              WW[1][0]=58,WW[1][1]=59,WW[1][2]=0;
5432   7                                                              
5433   7                                                              WW[2][0]=170,WW[2][1]=171,WW[2][2]=0;
5434   7                                                              WW[3][0]=77,WW[3][1]=78,WW[3][2]=0;
5435   7                                                              display_menu(line_1,3);
5436   7                                                              
5437   7                                                              
5438   7                                                                      if(auto_switch)
5439   7                                                                      {
5440   8                                                                              if(auto_mode==1)send3(hzk[170],60,0),send3(hzk[171],72,0);
5441   8                                                                              else if(auto_mode==2)send3(hzk[199],60,0),send3(hzk[200],72,0); 
5442   8                                                                              else if(auto_mode==3)send3(hzk[77],60,0),send3(hzk[78],72,0);
5443   8                                                                      }
5444   7                                                                      else send3(hzk[59],60,0),send3(hzk[2],72,0);
5445   7                                                              
5446   7                                                                      display_switch(auto_switch,60,2);
5447   7                                                              write_num100(auto_middle,66,4,'/');
5448   7                                                              
5449   7                                                              
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 89  

5450   7                                                              if(line_1==1)
5451   7                                                              {
5452   8                                                                      
5453   8                                                                      if(increase)
5454   8                                                                      {
5455   9                                                                              increase=0;
5456   9                                                                              if(auto_switch==0)auto_switch=2,Data_change(1);
5457   9                                                                              else if(auto_switch==2)auto_switch=3,Data_change(1);
5458   9                                                                      }
5459   8                                                                      if(decrease)
5460   8                                                                      {
5461   9                                                                              decrease=0;
5462   9                                                                              if(auto_switch==2)auto_switch=0,Data_change(1);
5463   9                                                                              else if(auto_switch==3)auto_switch=2,Data_change(1);
5464   9      
5465   9                                                                      }
5466   8                                                              
5467   8                                                              }                                                       
5468   7                                                              if(line_1==2)
5469   7                                                              {
5470   8                                                                      if(increase)
5471   8                                                                      {
5472   9                                                                              increase=0;
5473   9                                                                              if(auto_middle<120)auto_middle++,Data_change(1);
5474   9                                                                      }
5475   8                                                                      if(decrease)
5476   8                                                                      {
5477   9                                                                              decrease=0;
5478   9                                                                              if(auto_middle>-120)auto_middle--,Data_change(1);
5479   9                                                                      }
5480   8                                                                      
5481   8                                                              }
5482   7                                                              if(line_1==3)
5483   7                                                              {
5484   8                                                                      if(right)right=0,menu_2=23,line_2=0;
5485   8                                                              }
5486   7                                                              
5487   7                                                              
5488   7                                                      }
5489   6                                                      else if(menu_1==11)//模型管理
5490   6                                                      {
5491   7                                                              line_1=move_cursor(line_1,3);
5492   7                                                              
5493   7                                                              WW[0][0]=162,WW[0][1]=163,WW[0][2]=0;
5494   7                                                              WW[1][0]=164,WW[1][1]=165,WW[1][2]=0;
5495   7                                                              WW[2][0]=166,WW[2][1]=169,WW[2][2]=0;
5496   7                                                              WW[3][0]=166,WW[3][1]=171,WW[3][2]=0;
5497   7                                                              display_menu(line_1,3);
5498   7                                                              
5499   7                                                              
5500   7                                                              send3(hzk[Model_number+81],60,0);send3(hzk[68],72,0);
5501   7                                                              
5502   7                                                              
5503   7                                                              if(line_1<1)
5504   7                                                              {
5505   8                                                                      if(increase)
5506   8                                                                      {
5507   9                                                                              increase=0;
5508   9                                                                              if(Model_number<5)
5509   9                                                                              {
5510  10                                                                                      Model_current=Model_number;
5511  10                                                                                      Model_number++;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 90  

5512  10                                                                                      ROM_enable=1,Data_system=1,Model_change=1;
5513  10                                                                                      /**
5514  10                                                                                      +军刀破+
5515  10                                                                                      重置命名索引
5516  10                                                                                      */
5517  10                                                                                      Name_idx=0;
5518  10                                                                              }
5519   9                                                                      }
5520   8                                                                      if(decrease)
5521   8                                                                      {
5522   9                                                                              decrease=0;
5523   9                                                                              if(Model_number>0)
5524   9                                                                              {
5525  10                                                                                      Model_current=Model_number;
5526  10                                                                                      Model_number--;
5527  10                                                                                      ROM_enable=1,Data_system=1,Model_change=1;
5528  10                                                                                      /**
5529  10                                                                                      +军刀破+
5530  10                                                                                      重置命名索引
5531  10                                                                                      */
5532  10                                                                                      Name_idx=0;
5533  10                                                                              }
5534   9                                                                      }
5535   8                                                              }
5536   7                                                              else if(line_1<2)
5537   7                                                              {
5538   8                                                                      /*************+军刀破+************/
5539   8                                                                      //模型命名，最多用七个字符命名，只能以A－Z，a-z，0-9，及常用符号输入
5540   8                                                                      //按加减输入字符，确定键输入下个字符
5541   8                                                                      u8 i=0;
5542   8                                                                      for(i=0;i<7;i++)
5543   8                                                                      {
5544   9                                                                              if(i==Name_idx)
5545   9                                                                              {
5546  10                                                                                      send2_rev(Model_name[i]+32,60+8*i,2);
5547  10                                                                              }
5548   9                                                                              else
5549   9                                                                              {
5550  10                                                                                      send2(Model_name[i]+32,60+8*i,2);
5551  10                                                                              }
5552   9                                                                      }
5553   8                                                                      if(increase)
5554   8                                                                      {
5555   9                                                                              increase=0;
5556   9                                                                              Model_name[Name_idx]++;
5557   9                                                                              if(Model_name[Name_idx]>90) Model_name[Name_idx]=0;
5558   9                                                                              send2_rev(Model_name[Name_idx]+32,60+Name_idx*8,2);                                                                     
5559   9                                                                              ROM_enable=1,Data_model=1,Model_change=1;
5560   9                                                                      }
5561   8                                                                      if(decrease)
5562   8                                                                      {
5563   9                                                                              decrease=0;
5564   9                                                                              if(Model_name[Name_idx]>0) Model_name[Name_idx]--;
5565   9                                                                              else Model_name[Name_idx]=90;
5566   9                                                                              send2_rev(Model_name[Name_idx]+32,60+Name_idx*8,2);
5567   9                                                                              ROM_enable=1,Data_model=1,Model_change=1;
5568   9                                                                      }
5569   8                                                                      if(right)
5570   8                                                                      {
5571   9                                                                              right=0;
5572   9                                                                              Name_idx++;
5573   9                                                                              if(Name_idx>6) Name_idx=0;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 91  

5574   9                                                                      }
5575   8                                                                      /*************************/
5576   8                                                              }
5577   7                                                              else if(line_1<3)
5578   7                                                              {
5579   8      /*                                                              if(increase)
5580   8                                                                      {
5581   8                                                                              increase=0;
5582   8                                                                              if(Model_target<4)Model_target++;
5583   8                                                                      }
5584   8                                                                      if(decrease)
5585   8                                                                      {
5586   8                                                                              decrease=0;
5587   8                                                                              if(Model_target>0)Model_target--;
5588   8                                                                      }
5589   8                                                                      
5590   8                                                                      if(right)
5591   8                                                                      {
5592   8                                                                              right=0;
5593   8                                                                              if(copy_ready)
5594   8                                                                              {
5595   8                                                                                      paste_ready=1;
5596   8                                                                                              
5597   8                                                                              }
5598   8                                                                              else 
5599   8                                                                              {
5600   8                                                                                      copy_ready=1;
5601   8                                                                              }                                                               
5602   8                                                                      }
5603   8                                                                      
5604   8                                                                      
5605   8                                                                      
5606   8                                                                      if(copy_ready)
5607   8                                                                      {
5608   8                                                                              if(left)
5609   8                                                                              {
5610   8                                                                                      left=0;
5611   8                                                                                      copy_ready=0;paste_ready=0;
5612   8                                                                                      send3(hzk[2],60,4);send3(hzk[2],72,4);send3(hzk[2],84,4);send3(hzk[2],96,4);
5613   8                                                                              }
5614   8                                                                              else
5615   8                                                                              {
5616   8                                                                                      send3(hzk[176],60,4);send3(hzk[Model_target+81],72,4);send3(hzk[68],84,4);
5617   8                                                                                      if(paste_ready)
5618   8                                                                                      {
5619   8                                                                                              send3(hzk[3],96,4);
5620   8                                                                                              delay_time++;
5621   8                                                                                              if(delay_time>4)
5622   8                                                                                              {
5623   8                                                                                                      delay_time=0;
5624   8                                                                                                      Model_copy();
5625   8                                                                                                      Data_model=1,ROM_enable=1;      
5626   8                                                                                                      copy_ready=0;paste_ready=0;
5627   8                                                                                              }
5628   8                                                                                      }
5629   8                                                                                      else send2('?',96,4);   
5630   8                                                                              }
5631   8      
5632   8      
5633   8                                                                              
5634   8                                                                      }*/
5635   8                                                              }
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 92  

5636   7                                                              else if(line_1<4)
5637   7                                                              {
5638   8                                                                      if(right)
5639   8                                                                      {
5640   9                                                                              right=0;
5641   9                                                                              if(reset_action)
5642   9                                                                              {
5643  10                                                                                      Model_reset=1;
5644  10                                                                                      
5645  10                                                                              }
5646   9                                                                              else
5647   9                                                                              {
5648  10                                                                                      reset_action=1;
5649  10                                                                                      
5650  10                                                                              }
5651   9                                                                              
5652   9                                                                      }
5653   8                                                                      
5654   8                                                                      
5655   8                                                                      
5656   8                                                                      
5657   8                                                                      if(reset_action)
5658   8                                                                      {
5659   9                                                                              if(left)
5660   9                                                                              {
5661  10                                                                                      left=0;
5662  10                                                                                      reset_action=0;Model_reset=0;
5663  10                                                                                      send3(hzk[2],60,6);send3(hzk[2],72,6);send3(hzk[2],84,6);
5664  10                                                                              }       
5665   9                                                                              else
5666   9                                                                              {
5667  10                                                                                      send3(hzk[137],60,6);send3(hzk[109],72,6);
5668  10                                                                                      if(Model_reset)
5669  10                                                                                      {
5670  11                                                                                              send3(hzk[3],84,6);
5671  11                                                                                              delay_time++;
5672  11                                                                                              if(delay_time>4)
5673  11                                                                                              {
5674  12                                                                                                      delay_time=0;
5675  12                                                                                                      Model_data_reset();
5676  12                                                                                                      reset_action=0;Model_reset=0;Data_model=1,ROM_enable=1; 
5677  12                                                                                              }
5678  11                                                                                              
5679  11                                                                                      }
5680  10                                                                                      else send2('?',84,6);   
5681  10                                                                              }
5682   9                                                                              
5683   9                                                                      }
5684   8                                                              }
5685   7                                                              
5686   7                                                      }
5687   6                                                      else if(menu_1==12)//接收机管理
5688   6                                                      {
5689   7                                                              line_1=move_cursor(line_1,3);
5690   7                                                              
5691   7                                                              WW[0][0]=41,WW[0][1]=42,WW[0][2]=43,WW[0][3]=44,WW[0][4]=0;
5692   7                                                              WW[1][0]=46,WW[1][1]=22,WW[1][2]=36,WW[1][3]=37,WW[1][4]=0;
5693   7                                                              WW[2][0]=31,WW[2][1]=32,WW[2][2]=8,WW[2][3]=9,WW[2][4]=0;
5694   7                                                              WW[3][0]=16,WW[3][1]=17,WW[3][2]=38,WW[3][3]=30,WW[3][4]=0;
5695   7      
5696   7                                                              display_menu(line_1,3);
5697   7                                                              
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 93  

5698   7                                                              
5699   7                                                              if(line_1<1)
5700   7                                                              {
5701   8      
5702   8                                                                      if(right)right=0,menu_2=11,star=1;
5703   8                                                              }
5704   7                                                              else if(line_1<2)
5705   7                                                              {
5706   8      
5707   8                                                                      if(right)right=0,menu_2=6,line_2=0;
5708   8                                                              }
5709   7                                                              else if(line_1<3)
5710   7                                                              {
5711   8                                                              
5712   8                                                                      if(right)right=0,menu_2=25,line_2=0;
5713   8                                                              }
5714   7                                                              else if(line_1<4)
5715   7                                                              {
5716   8                                                                      if(right)right=0,menu_2=9,line_2=0;
5717   8                                                              }
5718   7      
5719   7                                                              
5720   7                                                      }
5721   6      
5722   6                                                      if(left)left=0,menu_1=0,star=1;
5723   6                                                      increase=0;decrease=0;right=0;  
5724   6                                              }
5725   5                                      }
5726   4                                      else                                             //主菜单
5727   4                                      {       
5728   5      
5729   5      
5730   5                                              
5731   5      
5732   5                                              line=move_cursor(line,10);
5733   5                                              WW[0][0]=209,WW[0][1]=210,WW[0][2]=39,WW[0][3]=40,WW[0][4]=0;
5734   5                                              
5735   5                                              WW[1][0]=6,WW[1][1]=7,WW[1][2]=8,WW[1][3]=9,WW[1][4]=0;
5736   5                                              WW[2][0]=25,WW[2][1]=26,WW[2][2]=27,WW[2][3]=28,WW[2][4]=0;
5737   5                                              WW[3][0]=16,WW[3][1]=17,WW[3][2]=18,WW[3][3]=13,WW[3][4]=0;                                                     
5738   5                                              WW[4][0]=19,WW[4][1]=20,WW[4][2]=21,WW[4][3]=22,WW[4][4]=0;
5739   5                                              WW[5][0]=10,WW[5][1]=11,WW[5][2]=12,WW[5][3]=13,WW[5][4]=0;                                     
5740   5                                              WW[6][0]=192,WW[6][1]=193,WW[6][2]=12,WW[6][3]=13,WW[6][4]=0;
5741   5                                              WW[7][0]=104,WW[7][1]=105,WW[7][2]=22,WW[7][3]=169,WW[7][4]=0;
5742   5                                              WW[8][0]=8,WW[8][1]=159,WW[8][2]=14,WW[8][3]=15,WW[8][4]=0;
5743   5                                              WW[9][0]=43,WW[9][1]=44,WW[9][2]=14,WW[9][3]=15,WW[9][4]=0;
5744   5                                              WW[10][0]=23,WW[10][1]=24,WW[10][2]=18,WW[10][3]=13,WW[10][4]=0;
5745   5      
5746   5      
5747   5                                              display_menu(line,10);
5748   5                                              if(line==0)
5749   5                                              {
5750   6      
5751   6                                                      if(right)right=0,save_action=1;
5752   6                                                      if(save_action)
5753   6                                                      {
5754   7                                                              Data_change(2);
5755   7                                                              send3(hzk[3],80,0);
5756   7                                                      }
5757   6                                              }
5758   5                                              else if(line==1)                  
5759   5                                              {
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 94  

5760   6                                                      
5761   6                                                      if(right)right=0,menu_1=1,line_1=0,star=1;
5762   6                                              }
5763   5                                              else if(line==2)
5764   5                                              {
5765   6      
5766   6                                                      if(right)right=0,menu_1=2,line_1=0;
5767   6                                              }
5768   5                                              else if(line==3)
5769   5                                              {
5770   6                                              if(right)right=0,menu_1=3,line_1=0;     
5771   6                                              }
5772   5                                              else if(line==4)
5773   5                                              {
5774   6                                                              if(right)right=0,menu_1=4,line_1=0;
5775   6                                              }
5776   5                                              else if(line==5)
5777   5                                              {
5778   6                                                      if(right)right=0,menu_1=5,line_1=0;                                                     
5779   6                                              }                 
5780   5                                              else if(line==6) 
5781   5                                              {
5782   6                                                      if(right)right=0,menu_1=7,line_1=0;                                                     
5783   6                                              }
5784   5                                              else if(line==7) 
5785   5                                              {
5786   6                                                      if(right)right=0,menu_1=10,line_1=0;
5787   6                                              }
5788   5                                              else if(line==8) 
5789   5                                              {
5790   6                                                      if(right)right=0,menu_1=11,line_1=0;
5791   6                                              }
5792   5                                              else if(line==9) 
5793   5                                              {
5794   6                                              
5795   6                                                      if(right)right=0,menu_1=12,line_1=0;
5796   6                                              }
5797   5                                              else  
5798   5                                              {
5799   6                                              
5800   6                                                      if(right)right=0,menu_1=8,line_1=0;
5801   6                                              }
5802   5                                              
5803   5                                              if(left)left=0,menu=0,line=0,star=1,save_action=0;
5804   5                                              if(right)right=0;
5805   5                                              if(increase)increase=0;
5806   5                                              if(decrease)decrease=0;
5807   5      
5808   5                                      }
5809   4                              }
5810   3                              else 
5811   3                              {
5812   4      
5813   4                                      if(star)                         //star标志位：页面第一次载入
5814   4                                      {
5815   5                                              star=0;
5816   5                                              photo(screen1,0,0,128,8);
5817   5                                              
5818   5                                              //photo(name6,76,3,36,2);
5819   5                                              displayModel();
5820   5      
5821   5                                      }       
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 95  

5822   4                                      
5823   4                                      
5824   4                                      
5825   4                                      send2(hour/10+48,64,0);send2(hour%10+48,72,0);                          
5826   4                                      send2(minute/10+48,85,0);send2(minute%10+48,93,0);                              
5827   4                                      send2(second/10+48,106,0);send2(second%10+48,114,0);
5828   4                                      
5829   4                                      location(40,2);
5830   4                                      send(minute2/10+48);send(minute2%10+48);
5831   4                                      LCD(0);LCD(0x24);
5832   4                                      send(second2/10+48);send(second2%10+48);
5833   4                                      
5834   4                                      if(SA)send2(123,74,5);
5835   4                                      else send2(124,74,5);
5836   4                                      
5837   4                                      if(SB1&SB2)send2(126,82,5);
5838   4                                      else if(SB1&!SB2)send2(125,82,5);
5839   4                                      else send2(127,82,5);
5840   4                                      
5841   4                                      if(SC1&SC2)send2(126,90,5);
5842   4                                      else if(SC1&!SC2)send2(125,90,5);
5843   4                                      else send2(127,90,5);
5844   4                                      
5845   4                                      if(SD)send2(123,98,5);
5846   4                                      else send2(124,98,5);
5847   4                                      
5848   4                                      if(SE)send2(123,106,5);
5849   4                                      else send2(124,106,5);
5850   4                                      
5851   4      /*                              
5852   4                                      location(55,5);
5853   4                                      temp=operation[0];
5854   4              //                      temp=angle_x;
5855   4                                      if(temp>0)send('+');
5856   4                                      else if(temp<0)temp=-temp,send('-');
5857   4                                      else send(' ');
5858   4                                      send(temp/1000+48);
5859   4                                      send(temp%1000/100+48);
5860   4                                      send(temp%100/10+48);
5861   4                                      send(temp%10+48);
5862   4                                      
5863   4                                      location(55,6);
5864   4                                      temp=NRF_buff[0];
5865   4              //                      temp=angle_y;
5866   4                                      if(temp>0)send('+');
5867   4                                      else if(temp<0)temp=-temp,send('-');
5868   4                                      else send(' ');
5869   4                                      send(temp/1000+48);
5870   4                                      send(temp%1000/100+48);
5871   4                                      send(temp%100/10+48);
5872   4                                      send(temp%10+48);
5873   4                                      
5874   4      
5875   4                                      
5876   4                                      location(95,5);temp=PPM_DATA[0];
5877   4                                      send(temp/1000+48);
5878   4                                      send(temp%1000/100+48);
5879   4                                      send(temp%100/10+48);
5880   4                                      send(temp%10+48);
5881   4                              
5882   4                                      location(95,6);temp=operation[0];
5883   4                                      send(temp/1000+48);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 96  

5884   4                                      send(temp%1000/100+48);
5885   4                                      send(temp%100/10+48);
5886   4                                      send(temp%10+48);
5887   4      */      
5888   4                                      
5889   4                                      
5890   4                                      
5891   4                                      
5892   4                                      
5893   4                                      if(USB_5V)
5894   4                                      {
5895   5                                              location(78,2);
5896   5                                              send(' ');                              
5897   5                                              
5898   5                                              send('5');send('V');LCD(0x00);send('-');LCD(0x00);
5899   5                                              
5900   5                                              
5901   5                                              
5902   5                                              send('U');send('S');send('B');
5903   5                                      }
5904   4                                      else
5905   4                                      {
5906   5                                              location(78,2);temp=battery_voltage;
5907   5                                              write_num1000(temp,'.');
5908   5                                                      
5909   5                                      }
5910   4      
5911   4                                      
5912   4                                      location(23,4);
5913   4                                      if(rx[1])
5914   4                                      {
5915   5                                              temp=rx[1];
5916   5                                              temp<<=8;
5917   5                                              temp+=rx[2];
5918   5                                      }
5919   4                                      else temp=0;
5920   4                                      write_num1000(temp,'.');
5921   4                                      
5922   4                                      if(Switch_Check(Return_alarm_switch)==3)
5923   4                                      {
5924   5                                              if(temp<Power_V)
5925   5                                              {
5926   6                                                      warning(52,3,1);Message_DataReturn_bad|=0x01;   
5927   6                                              }
5928   5                                              else
5929   5                                              {
5930   6                                                      warning(52,3,0);Message_DataReturn_bad&=~0x01;
5931   6                                              }       
5932   5                                      }
5933   4                                      else warning(52,3,0),Message_DataReturn_bad=0;  
5934   4                                      
5935   4                                      
5936   4                                      
5937   4                                      
5938   4                                      location(23,3);
5939   4                                      if(rx[3])
5940   4                                      {
5941   5                                              temp=rx[3];
5942   5                                              temp<<=8;
5943   5                                              temp+=rx[4];
5944   5                                      }
5945   4                                      else temp=0;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 97  

5946   4                                      write_num1000(temp,'.');
5947   4                                      
5948   4                                      if(Switch_Check(Return_alarm_switch)==3)
5949   4                                      {
5950   5                                              if(temp<Chip_V)
5951   5                                              {
5952   6                                                      warning(52,4,1);Message_DataReturn_bad|=0x02;   
5953   6                                              }
5954   5                                              else
5955   5                                              {
5956   6                                                      warning(52,4,0);Message_DataReturn_bad&=~0x02;
5957   6                                              }
5958   5                                      }
5959   4                                      else warning(52,4,0),Message_DataReturn_bad=0;
5960   4                                      
5961   4                                      location(23,5);temp=rx[0]*2;
5962   4                                      if(temp>99)send('1'),send('0'),send('0');
5963   4                                      else send(' '),send(temp/10+48),send(temp%10+48);
5964   4                                      
5965   4                                      
5966   4                                      if(Switch_Check(Return_alarm_switch)==3)
5967   4                                      {
5968   5                                              if(temp<TX_min)
5969   5                                              {
5970   6                                                      warning(52,5,1);Message_DataReturn_bad|=0x04;   
5971   6                                              }
5972   5                                              else
5973   5                                              {
5974   6                                                      warning(52,5,0);Message_DataReturn_bad&=~0x04;
5975   6                                              }
5976   5                                      }
5977   4                                      else warning(52,5,0),Message_DataReturn_bad=0;
5978   4                                      
5979   4                                      temp=FUCK_sum*2;
5980   4                                      location(23,6);
5981   4                                      if(temp>99)send('1'),send('0'),send('0');
5982   4                                      else send(' '),send(temp/10+48),send(temp%10+48);
5983   4      
5984   4                                      if(Switch_Check(Return_alarm_switch)==3)
5985   4                                      {
5986   5                                              if(temp<RX_min)warning(52,6,1),Message_DataReturn_bad|=0x08;
5987   5                                              else warning(52,6,0),Message_DataReturn_bad&=~0x08;
5988   5                                      }
5989   4                                      else warning(52,6,0),Message_DataReturn_bad=0;
5990   4                                      
5991   4      /*                              flash_time++;
5992   4                                      if(flash_time<7)
5993   4                                      {
5994   4                                              
5995   4                                              warning(27,6);
5996   4                                      }
5997   4                                      else if(flash_time<14)
5998   4                                      {
5999   4                                              
6000   4                                              location(23,6);//write_num1000(temp,0);
6001   4                                              if(temp>99)send('1'),send('0'),send('0');
6002   4                                      else send(' '),send(temp/10+48),send(temp%10+48);
6003   4                                      }
6004   4                                      else flash_time=0;
6005   4                                      */
6006   4                                                                      
6007   4                                      
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 98  

6008   4                                      if(throttle_lock)
6009   4                                      {
6010   5                                              display_throttle(0);
6011   5                                      }
6012   4                                      else
6013   4                                      {
6014   5                                              if(CH_inverted[2])
6015   5                                              {
6016   6                                                      display_throttle(255-throttle*10/34);
6017   6                                                      location(6,2);
6018   6                                                      temp=100-throttle*20/169;
6019   6                                              }
6020   5                                              else
6021   5                                              {
6022   6                                                      display_throttle(throttle*10/34);
6023   6                                                      location(6,2);
6024   6                                                      temp=throttle*20/169;
6025   6                                              }
6026   5                                                      
6027   5                                              if(temp==100)
6028   5                                              {
6029   6                                                      send('A');send('L');send('L');
6030   6                                              }
6031   5                                              else
6032   5                                              {
6033   6                                                      send(temp/10+48);send(temp%10+48);send('%');
6034   6                                              }
6035   5      
6036   5                                              
6037   5                                      }
6038   4                                      
6039   4                                      
6040   4                                      if(event1)//微调更新
6041   4                                      {
6042   5                                              if(middle_change_last==CH_middle_change)
6043   5                                              {
6044   6                                                      if(CH_middle_change==0)
6045   6                                                      {
6046   7                                                              
6047   7                                                              photo(bmp3,77,4,32,3);
6048   7                                                              location(80,5);
6049   7                                                      }
6050   6                                                      else if(CH_middle_change==1)
6051   6                                                      {
6052   7                                                              
6053   7                                                              photo(bmp3,90,2,32,3);
6054   7                                                              location(93,3);
6055   7                                                      }
6056   6                                                      else if(CH_middle_change==2)
6057   6                                                      {
6058   7                                                              
6059   7                                                              photo(bmp3,5,2,32,3);
6060   7                                                              location(8,3);
6061   7                                                      }
6062   6                                                      else if(CH_middle_change==3)
6063   6                                                      {
6064   7                                                              
6065   7                                                              photo(bmp3,17,4,32,3);
6066   7                                                              location(20,5);
6067   7                                                                      
6068   7                                                      }                                                       
6069   6                                                      
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 99  

6070   6                                                      write_num1000(CH_middle[CH_middle_change],'-');
6071   6                                              }
6072   5                                              else
6073   5                                              {
6074   6                                                      star=1;
6075   6                                              }
6076   5                                              middle_change_last=CH_middle_change;                                                    
6077   5                                              
6078   5                                      }
6079   4                                      
6080   4                                      location(6,7);
6081   4                                      if(CH_inverted[3]==1)display_trim2(125-CH_middle[3]);
6082   4                                      else display_trim2(CH_middle[3]+125);
6083   4                                      location(67,7);
6084   4                                      if(CH_inverted[0]==1)display_trim2(125-CH_middle[0]);
6085   4                                      else display_trim2(CH_middle[0]+125);
6086   4      
6087   4                                      if(CH_inverted[2]==1)display_trim1(125-CH_middle[2],0);
6088   4                                      else display_trim1(CH_middle[2]+125,0);
6089   4                                      if(CH_inverted[1]==1)display_trim1(125-CH_middle[1],123);
6090   4                                      else display_trim1(CH_middle[1]+125,123);
6091   4                                      
6092   4                                      LCD_OFF();
6093   4                              }
6094   3                      }
6095   2                      else if(tt==3) //保留
6096   2                      {
6097   3                              
6098   3                      }
6099   2                      else if(tt==4)
6100   2                      {//SA=!SA;
6101   3                              if(ROM_enable)  //避免数据重复保存
6102   3                              {
6103   4                                      ROM_enable=0;
6104   4                                      if(Data_system)         //系统参数
6105   4                                      {
6106   5                                              Data_system=0;
6107   5                                              DATA_save1();
6108   5                                      }
6109   4                                      if(Data_model)  //机型参数
6110   4                                      {
6111   5                                              Data_model=0;
6112   5                                              DATA_save2();
6113   5                                      }
6114   4                                      
6115   4                              }
6116   3                              
6117   3                              if(Model_change)        //读取另一个机型数据
6118   3                              {
6119   4                                      Model_change=0;
6120   4                                      Model_current=Model_number;
6121   4                                      DATA_read2();
6122   4                                      
6123   4                              }
6124   3                              
6125   3                      //      SA=!SA;
6126   3                      }
6127   2                      else if(tt==5)//保留
6128   2                      {
6129   3                              tt=0;
6130   3                      }
6131   2              
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 100 

6132   2      
6133   2              }
6134   1      
6135   1      }
6136          
6137          
6138          void ET0_isr()interrupt 1         //数据处理定时器       低优先级
6139          {
6140   1      
6141   1              TL0=0xe0,TH0=0xb1;               //20ms
6142   1              flag_20ms=1;
6143   1      //SA=!SA;
6144   1      //      SC2=!SC2;
6145   1              Master_clock++;                            //主时钟计时
6146   1              if(Master_clock>49)Master_clock=0,second++;
6147   1              if(second>59)second=0,minute++;
6148   1              if(minute>59)minute=0,hour++;
6149   1              if(hour>99)hour=99;
6150   1              
6151   1              if(clock_go)//时钟计时
6152   1              {
6153   2                      clock2++;
6154   2                      if(clock2>49)clock2=0,second2++;
6155   2                      if(second2>59)second2=0,minute2++;
6156   2                      if(minute2>59)minute2=99;                               
6157   2                      
6158   2                      if(minute2>=clock_set)Message_AlarmClock=1;
6159   2                      else Message_AlarmClock=0;
6160   2              }
6161   1              else 
6162   1              {
6163   2                      Message_AlarmClock=0;
6164   2              }
6165   1              
6166   1              
6167   1              
6168   1      
6169   1              if(KEY)         //菜单键检测                    
6170   1              {
6171   2                      KS_press_time=0;
6172   2                      KS_long_press=0;
6173   2                      if(KS)                             
6174   2                      {                                          
6175   3                              KS=0;Message_KeyTone=1;                   
6176   3                              
6177   3                              if(menu)
6178   3                              {
6179   4                                      if(menu_2==11)
6180   4                                      {
6181   5                                              cancel=1;
6182   5                                      }
6183   4                                      else if(menu_2==19)
6184   4                                      {
6185   5                                              RC_check=0,menu=0,star=1;
6186   5                                      }
6187   4                                      else
6188   4                                      {
6189   5                                              star=1,menu=0,save_action=0;
6190   5                                      }
6191   4                                      
6192   4                              }
6193   3                              else 
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 101 

6194   3                              {
6195   4                                      star=1;menu=1,menu_1=0,menu_2=0;
6196   4                              }       
6197   3                              
6198   3                      } 
6199   2              }
6200   1              else 
6201   1              {
6202   2                      KS=1;
6203   2                      if(KS_long_press)KS=0;            //长按菜单键锁定油门
6204   2                      else KS_press_time++;
6205   2                      
6206   2                      if(KS_press_time>100)
6207   2                      {
6208   3                              KS_press_time=0;KS=0;
6209   3                              KS_long_press=1;
6210   3                              if(menu==0)
6211   3                              {
6212   4                                      throttle_lock=!throttle_lock;
6213   4                                      Message_KeyTone=2;star=1;       
6214   4                              }
6215   3                              
6216   3                      }
6217   2              }
6218   1              
6219   1              if(Auto_lock)//自动锁定油门
6220   1              {
6221   2                      if(throttle_lock==0)
6222   2                      {
6223   3                              throttle_idle++;
6224   3                              if(throttle_idle>500)
6225   3                              {
6226   4                                      throttle_idle=0;
6227   4                                      throttle_lock=1;star=1;Message_KeyTone=2;
6228   4                              }       
6229   3                      }       
6230   2              }
6231   1              
6232   1                              
6233   1              
6234   1              if(event1)              //1秒清0
6235   1              {
6236   2                      t1++;
6237   2                      if(t1>49)t1=0,event1=0,star=1;
6238   2              }
6239   1      /*      
6240   1              if(event2)              //5秒清0
6241   1              {
6242   1                      t2++;
6243   1                      if(t2>250)
6244   1                      {
6245   1                              t2=0;
6246   1                              throttle_lock=1;
6247   1                      }
6248   1                      
6249   1              }
6250   1              */
6251   1              if(event3)              //1.5秒清0
6252   1              {
6253   2                      t3++;
6254   2                      if(t3>75)t3=0,event3=0,ROM_enable=1;//避免频繁擦写ROM
6255   2              }
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 102 

6256   1              
6257   1      /*      if(event3)              //0.5秒清0
6258   1              {
6259   1                      t3++;
6260   1                      if(t3>25)t3=0,event3=0,star=1;
6261   1              }*/
6262   1              
6263   1              if(Battery_1s)//低压报警处理
6264   1              {
6265   2                      battery_voltage=((long)adc[0]*1000/(1000-v_trim1))*0.097;                  
6266   2                      if(battery_voltage<VLD1*10)Message_LowPower=1;
6267   2                      else Message_LowPower=0;
6268   2              }
6269   1              else
6270   1              {
6271   2      
6272   2                      battery_voltage=((long)adc[0]*1000/(1000-v_trim2))*0.146;
6273   2                      
6274   2                      if(battery_voltage<VLD2*10)
6275   2                      {
6276   3                              if(battery_voltage>400&&battery_voltage<600)
6277   3                              {
6278   4                                      USB_5V=1;
6279   4                                      Message_LowPower=0;
6280   4                              }
6281   3                              else USB_5V=0,Message_LowPower=1;
6282   3                      }
6283   2                      else Message_LowPower=0;
6284   2                      
6285   2      
6286   2              }
6287   1              
6288   1              
6289   1              if(Message_AlarmClock||Message_LowPower||Message_DataReturn_bad)
6290   1        {
6291   2          beep=3;
6292   2        }
6293   1        else if(Message_KeyTone)
6294   1        {
6295   2          beep=Message_KeyTone;
6296   2                      Message_KeyTone=0;
6297   2        }
6298   1              else beep=0;
6299   1              
6300   1      
6301   1              if(Sound_enable)//蜂鸣器处理
6302   1              {//蜂鸣器负极接单片机引脚，所以buzzer=0时才是蜂鸣器发出声音
6303   2                      sound++;                                   
6304   2                      if(beep)
6305   2                      {                                                                                                                                                                 
6306   3                              if(beep==1)
6307   3                              { buzzer=0;if(sound>3)beep=0,buzzer=1;}
6308   3                              if(beep==2)
6309   3                              {buzzer=0;if(sound>30)beep=0,buzzer=1;}
6310   3                              /*start-----改自“柴门”-------*/
6311   3                              /*if(beep==3)
6312   3                              {
6313   3                                      if(sound%40>25)buzzer=0;
6314   3                                      else buzzer=1;
6315   3                              }*/
6316   3                              //用不同的报警声表示不同的警报信息：
6317   3                              if(Message_DataReturn_bad) //回传报警（信号弱报警、接收端低压报警，这里或许还可以再考虑分拆一下警报类型
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 103 

             -）
6318   3                              {//bi _ bi _ bi - - _ bi _ bi _ bi - - _ bi _ bi _ bi - - _
6319   4                                      u8 ZhouQi = sound%80;
6320   4                                      if( ((ZhouQi>=0) && (ZhouQi<10))  ||  ((ZhouQi>=20) && (ZhouQi<30))  ||  ((ZhouQi>=40) && (ZhouQi<70))
             - )
6321   4                                              buzzer=0;
6322   4                                      else buzzer=1;
6323   4                              }
6324   3                              else if(Message_LowPower) //低压报警（应该是遥控器低压报警），蜂鸣器响10停10，bi _ bi _ bi _
6325   3                              {
6326   4                                      if(sound%20>=10)buzzer=0;
6327   4                                      else buzzer=1;
6328   4                              }
6329   3                              else if(Message_AlarmClock) //超时报警（菜单中设置超时时间），蜂鸣器响20停30，bi - _ _ _ bi - _ _ _
6330   3                              {
6331   4                                      if(sound%50>=30)buzzer=0;
6332   4                                      else buzzer=1;
6333   4                              }
6334   3                              /*end-----改自“柴门”-------*/
6335   3                      }
6336   2                      else sound=0,buzzer=1;  
6337   2              }
6338   1              else sound=0,buzzer=1;
6339   1              
6340   1      
6341   1      /**************************************************************************/
6342   1      //开关处理
6343   1      
6344   1          /*start------改自“柴门”--------*/
6345   1              //舵量增加时遥控首界面中的开关状态显示却是往下，改为开关在上时是舵量增加
6346   1              /*
6347   1              if(SA)Switch_A=1;
6348   1              else Switch_A=3;
6349   1              
6350   1              if(SB1&SB2)Switch_B=2;
6351   1              else if(SB1&!SB2)Switch_B=1;
6352   1              else Switch_B=3;
6353   1      
6354   1              if(SC1&SC2)Switch_C=2;
6355   1              else if(SC1&!SC2)Switch_C=1;
6356   1              else Switch_C=3;
6357   1              
6358   1              if(SD)Switch_D=1;
6359   1              else Switch_D=3;
6360   1              
6361   1              if(SE)Switch_E=1;
6362   1              else Switch_E=3;
6363   1              */
6364   1              if(SA)Switch_A=3;
6365   1              else Switch_A=1;
6366   1              
6367   1              if(SB1&SB2)Switch_B=2;
6368   1              else if(SB1&!SB2)Switch_B=3;
6369   1              else Switch_B=1;
6370   1      
6371   1              if(SC1&SC2)Switch_C=2;
6372   1              else if(SC1&!SC2)Switch_C=3;
6373   1              else Switch_C=1;
6374   1              
6375   1              if(SD)Switch_D=3;
6376   1              else Switch_D=1;
6377   1              
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 104 

6378   1              if(SE)Switch_E=3;
6379   1              else Switch_E=1;
6380   1              /*end------改自“柴门”--------*/
6381   1              
6382   1              if(Com_Swt_IN1)
6383   1              {
6384   2                      
6385   2                      
6386   2                      if(Switch_Check(Com_Swt_IN1)==1)
6387   2                      {
6388   3                              if(Com_Swt_IN2)
6389   3                              {
6390   4                                      if(Switch_Check(Com_Swt_IN2)==1)Combination_Switch=0;   
6391   4                                      else Combination_Switch=3;                              
6392   4                              }
6393   3                              else Combination_Switch=0;
6394   3                      }
6395   2                      else if(Switch_Check(Com_Swt_IN1)==2)
6396   2                      {
6397   3                              if(Com_Swt_IN2)
6398   3                              {
6399   4                                      if(Switch_Check(Com_Swt_IN2)==1)Combination_Switch=1;
6400   4                                      else Combination_Switch=4;
6401   4                              }
6402   3                              else Combination_Switch=1;
6403   3                      }
6404   2                      else
6405   2                      {
6406   3                              if(Com_Swt_IN2)
6407   3                              {
6408   4                                      if(Switch_Check(Com_Swt_IN2)==1)Combination_Switch=2;
6409   4                                      else Combination_Switch=5;
6410   4                              }
6411   3                              else Combination_Switch=2;
6412   3                      }
6413   2                      
6414   2              }
6415   1              
6416   1              
6417   1              
6418   1              
6419   1              
6420   1              if(train_switch)
6421   1              {
6422   2                      if(Switch_Check(train_switch)==3)train_output=1;
6423   2                      else train_output=0;    
6424   2              }
6425   1              else train_output=0;
6426   1              
6427   1              if(clock_switch)
6428   1              {               
6429   2                              if(Switch_Check(clock_switch)==3)clock_go=1;
6430   2                              else if(Switch_Check(clock_switch)==2)clock_go=0;
6431   2                              else clock_go=0,clock2=0,second2=0,minute2=0;           
6432   2                      
6433   2              }
6434   1              else clock_go=0;
6435   1              
6436   1              if(ratio_switch)
6437   1              {
6438   2                      if(Switch_Check(ratio_switch)==3)use_new_ratio=1;
6439   2                      else use_new_ratio=0;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 105 

6440   2              }
6441   1              else use_new_ratio=0;
6442   1              
6443   1              if(auto_switch)
6444   1              {
6445   2                      auto_mode=Switch_Check(auto_switch);
6446   2              }
6447   1              
6448   1              if(auto_mode==1)
6449   1              {
6450   2                      auto_value=auto_middle*4.25+511;
6451   2              }
6452   1              else if(auto_mode==3)
6453   1              {
6454   2                      if(auto_value>auto_max)auto_value=auto_max,auto_h=1,auto_l=0;
6455   2                      if(auto_value<auto_min)auto_value=auto_min,auto_h=0,auto_l=1;
6456   2                      if(auto_l)
6457   2                      {
6458   3                              auto_value+=auto_speed;
6459   3                      }
6460   2                      else if(auto_h)
6461   2                      {
6462   3                              auto_value-=auto_speed;
6463   3                      }       
6464   2              }
6465   1              
6466   1              
6467   1              
6468   1              
6469   1              
6470   1              
6471   1      /************************************************************************/
6472   1      //数据运算      
6473   1              
6474   1              function_filter(0);
6475   1              function_filter(1);
6476   1              function_filter(2);
6477   1              function_filter(3);
6478   1              function_filter(4);
6479   1              function_filter(5);
6480   1              function_filter(6);
6481   1              function_filter(7);
6482   1              
6483   1              
6484   1              CH_value[0]=CH_calib(adc[6],CH1_offset);
6485   1              CH_value[1]=CH_calib(adc[7],CH2_offset);
6486   1              CH_value[2]=CH_calib(adc[4],CH3_offset);
6487   1              CH_value[3]=CH_calib(adc[5],CH4_offset);
6488   1      
6489   1      
6490   1              if(throttle_lock)
6491   1              {
6492   2                      if(CH_inverted[2])
6493   2                      {
6494   3                              CH_value[2]=1023;
6495   3                      }
6496   2                      else
6497   2                      {
6498   3                              CH_value[2]=0;
6499   3                      }
6500   2              }
6501   1              
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 106 

6502   1              if(Auto_lock)
6503   1              {
6504   2                      if(CH_inverted[2])
6505   2                      {
6506   3                              if(CH_value[2]<1013)throttle_idle=0;
6507   3                      }
6508   2                      else
6509   2                      {
6510   3                              if(CH_value[2]>10)throttle_idle=0;
6511   3                      }
6512   2              }
6513   1              
6514   1              
6515   1              
6516   1              function_mapping(0);
6517   1              function_mapping(1);
6518   1              function_mapping(2);
6519   1              function_mapping(3);
6520   1              function_mapping(4);
6521   1              function_mapping(5);
6522   1              function_mapping(6);
6523   1              function_mapping(7);
6524   1              
6525   1              
6526   1              function_curve(0);//1.5ms
6527   1              function_curve(1);
6528   1              function_curve(2);
6529   1              
6530   1              function_curve2(0);
6531   1              function_curve2(1);
6532   1              function_curve2(2);
6533   1              function_curve2(3);
6534   1              function_curve2(4);
6535   1              
6536   1      
6537   1              if(use_new_ratio)
6538   1              {
6539   2                      function_size(0,1);
6540   2                      function_size(1,1);
6541   2                      function_size(2,1);
6542   2                      function_size(3,1);     
6543   2              }
6544   1              else 
6545   1              {
6546   2                      function_size(0,0);
6547   2                      function_size(1,0);
6548   2                      function_size(2,0);
6549   2                      function_size(3,0);
6550   2              }
6551   1      
6552   1              
6553   1              
6554   1              function_size(4,0);
6555   1              function_size(5,0);
6556   1              function_size(6,0);
6557   1              function_size(7,0);
6558   1              
6559   1              
6560   1              
6561   1              function_inverted(0);
6562   1              function_inverted(1);
6563   1              function_inverted(2);
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 107 

6564   1              function_inverted(3);
6565   1              function_inverted(4);
6566   1              function_inverted(5);
6567   1              function_inverted(6);
6568   1              function_inverted(7);
6569   1              
6570   1      
6571   1              
6572   1              if(mixer1)
6573   1              {
6574   2                      function_mix(mixer1_same,mixer1_contrary);
6575   2              }
6576   1              if(mixer2)
6577   1              {
6578   2                      function_mix(mixer2_same,mixer2_contrary);
6579   2              }
6580   1              if(mixer3)
6581   1              {
6582   2                      function_mix(mixer3_same,mixer3_contrary);
6583   2              }
6584   1              if(mixer4)
6585   1              {
6586   2                      function_mix(mixer4_same,mixer4_contrary);
6587   2              }
6588   1              
6589   1              
6590   1              
6591   1              
6592   1              operation[0]+=511;
6593   1              operation[1]+=511;
6594   1              operation[2]+=511;
6595   1              operation[3]+=511;
6596   1              operation[4]+=511;
6597   1              operation[5]+=511;
6598   1              operation[6]+=511;
6599   1              operation[7]+=511;
6600   1              
6601   1              
6602   1              
6603   1              if(Com_Swt_IN1)
6604   1              {
6605   2                      operation[Com_Swt_mapping]=740*Com_Swt_out[Combination_Switch]/100+143; 
6606   2              }
6607   1              
6608   1              
6609   1              
6610   1              
6611   1              Xdata_check(operation);
6612   1              
6613   1              
6614   1              NRF_buff[0]=operation[NRF_mapping[0]];
6615   1              NRF_buff[1]=operation[NRF_mapping[1]];
6616   1              NRF_buff[2]=operation[NRF_mapping[2]];
6617   1              NRF_buff[3]=operation[NRF_mapping[3]];
6618   1              NRF_buff[4]=operation[NRF_mapping[4]];
6619   1              NRF_buff[5]=operation[NRF_mapping[5]];
6620   1              NRF_buff[6]=operation[NRF_mapping[6]];
6621   1              NRF_buff[7]=operation[NRF_mapping[7]];
6622   1              
6623   1              if(PPM_updata>0)
6624   1              {
6625   2                      PPM_updata--;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 108 

6626   2                      if(train_output)
6627   2                      {
6628   3                              NRF_buff[0]=PPM_DATA[NRF_mapping[0]];
6629   3                              NRF_buff[1]=PPM_DATA[NRF_mapping[1]];
6630   3                              NRF_buff[2]=PPM_DATA[NRF_mapping[2]];
6631   3                              NRF_buff[3]=PPM_DATA[NRF_mapping[3]];
6632   3                              NRF_buff[4]=PPM_DATA[NRF_mapping[4]];
6633   3                              NRF_buff[5]=PPM_DATA[NRF_mapping[5]];
6634   3                              NRF_buff[6]=PPM_DATA[NRF_mapping[6]];
6635   3                              NRF_buff[7]=PPM_DATA[NRF_mapping[7]];   
6636   3                      }
6637   2                      
6638   2              }
6639   1              
6640   1              PPMout[0]=operation[PPM_mapping[0]];
6641   1              PPMout[1]=operation[PPM_mapping[1]];
6642   1              PPMout[2]=operation[PPM_mapping[2]];
6643   1              PPMout[3]=operation[PPM_mapping[3]];
6644   1              PPMout[4]=operation[PPM_mapping[4]];
6645   1              PPMout[5]=operation[PPM_mapping[5]];
6646   1              PPMout[6]=operation[PPM_mapping[6]];
6647   1              PPMout[7]=operation[PPM_mapping[7]];
6648   1      
6649   1              
6650   1      //operation[0]=adc[4];
6651   1      //operation[1]=adc[5];  
6652   1      //operation[2]=adc[6];
6653   1      //operation[3]=adc[7];
6654   1      /*
6655   1      NRF_buff[0]=512;
6656   1      NRF_buff[1]=512;
6657   1      NRF_buff[2]=512;
6658   1      NRF_buff[3]=512;
6659   1      NRF_buff[4]=512;
6660   1      NRF_buff[5]=512;
6661   1      NRF_buff[6]=512;
6662   1      NRF_buff[7]=512;*/
6663   1      
6664   1      
6665   1                      tx_buff[0]=0xa1;
6666   1                      tx_buff[1]=NRF_buff[0]>>2;
6667   1                      tx_buff[2]=NRF_buff[0]<<6;
6668   1              tx_buff[2]+=NRF_buff[1]>>4;
6669   1                      tx_buff[3]=NRF_buff[1]<<4;
6670   1                      tx_buff[3]+=NRF_buff[2]>>6;
6671   1                      tx_buff[4]=NRF_buff[2]<<2;
6672   1                      tx_buff[4]+=NRF_buff[3]>>8;
6673   1                      tx_buff[5]=NRF_buff[3];
6674   1      
6675   1                      tx_buff[6]=NRF_buff[4]>>2;
6676   1                      tx_buff[7]=NRF_buff[4]<<6;
6677   1              tx_buff[7]+=NRF_buff[5]>>4;
6678   1                      tx_buff[8]=NRF_buff[5]<<4;
6679   1                      tx_buff[8]+=NRF_buff[6]>>6;
6680   1                      tx_buff[9]=NRF_buff[6]<<2;
6681   1                      tx_buff[9]+=NRF_buff[7]>>8;
6682   1                      tx_buff[10]=NRF_buff[7];
6683   1      
6684   1                              
6685   1                      tx_data[0]=tx_buff[0];
6686   1                      tx_data[1]=tx_buff[1];
6687   1                      tx_data[2]=tx_buff[2];
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 109 

6688   1                      tx_data[3]=tx_buff[3];
6689   1                      tx_data[4]=tx_buff[4];
6690   1                      tx_data[5]=tx_buff[5];
6691   1                      tx_data[6]=tx_buff[6];
6692   1                      tx_data[7]=tx_buff[7];
6693   1                      tx_data[8]=tx_buff[8];
6694   1                      tx_data[9]=tx_buff[9];
6695   1                      tx_data[10]=tx_buff[10];
6696   1                              
6697   1                              
6698   1              
6699   1      
6700   1      if(index_change)
6701   1      {
6702   2              index_change=0;
6703   2              get_curve(last_index);//40ms    
6704   2              
6705   2      }
6706   1      
6707   1      /*
6708   1      SBUF=adc[6]/1000+48;  while(!TI);TI=0;
6709   1      SBUF=adc[6]%1000/100+48;  while(!TI);TI=0;
6710   1              SBUF=adc[6]%100/10+48;  while(!TI);TI=0; 
6711   1      SBUF=adc[6]%10+48;  while(!TI);TI=0;
6712   1      SBUF=' ';  while(!TI);TI=0;
6713   1      SBUF=adc_buff[6]/1000+48;  while(!TI);TI=0;
6714   1      SBUF=adc_buff[6]%1000/100+48;  while(!TI);TI=0;
6715   1              SBUF=adc_buff[6]%100/10+48;  while(!TI);TI=0; 
6716   1      SBUF=adc_buff[6]%10+48;  while(!TI);TI=0;
6717   1      SBUF='\n';  while(!TI);TI=0;
6718   1      
6719   1              SBUF=0x88;  while(!TI);TI=0;
6720   1      SBUF=0xa1;  while(!TI);TI=0;
6721   1              SBUF=0x16;  while(!TI);TI=0; 
6722   1      SBUF=adc[0]>>8;  while(!TI);TI=0;
6723   1      SBUF=adc[0];  while(!TI);TI=0;
6724   1      SBUF=adc_buff[0]>>8;  while(!TI);TI=0;
6725   1      SBUF=adc_buff[0];  while(!TI);TI=0;
6726   1      SBUF=adc_buff[6]>>8;  while(!TI);TI=0;
6727   1      SBUF=adc_buff[6];  while(!TI);TI=0;
6728   1      SBUF=adc[3]>>8;  while(!TI);TI=0;
6729   1      SBUF=adc[3];  while(!TI);TI=0;
6730   1      SBUF=adc[4]>>8;  while(!TI);TI=0;
6731   1      SBUF=adc[4];  while(!TI);TI=0;
6732   1      SBUF=adc[5]>>8;  while(!TI);TI=0;
6733   1      SBUF=adc[5];  while(!TI);TI=0;
6734   1      SBUF=adc[6]>>8;  while(!TI);TI=0;
6735   1      SBUF=adc[6];  while(!TI);TI=0;
6736   1      SBUF=adc[7]>>8;  while(!TI);TI=0;
6737   1      SBUF=adc[7];  while(!TI);TI=0;
6738   1      */
6739   1      
6740   1      //SC2=!SC2;             
6741   1      //SA=!SA;
6742   1      
6743   1      }
6744          
6745          void EX1_isr()interrupt 2         //脉宽测量     高优先级
6746          {
6747   1              u16 width;u8 i;
6748   1              width=TH1;
6749   1              width<<=8;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 110 

6750   1              width+=TL1;
6751   1              TL1=0,TH1=0;
6752   1              
6753   1              if(width<500)
6754   1              {
6755   2                      t_ppm=0;
6756   2              }
6757   1              else if(width<1750)
6758   1              {
6759   2                      if(t_ppm<8)PPM_buff[t_ppm]=width-605;
6760   2                      t_ppm++;
6761   2                      
6762   2              }
6763   1              else if(width>3000&&width<14000)
6764   1              {
6765   2                      
6766   2                      if(t_ppm>5&&t_ppm<11)
6767   2                      {
6768   3                              t_ppm=0;
6769   3                              if(PPM_updata<20)PPM_updata+=5;
6770   3                              for(i=0;i<8;i++)
6771   3                              PPM_DATA[i]=PPM_buff[i]+PPM_offset+PPM_offset;
6772   3                              Xdata_check(PPM_DATA);
6773   3                      }
6774   2              }
6775   1              else 
6776   1              {
6777   2                      t_ppm=0;
6778   2              }
6779   1      
6780   1              
6781   1      }
6782          
6783          void ET1_isr()interrupt 3         //脉宽输出     高优先级
6784          {
6785   1              u16 temp;//     SC1=0;
6786   1              TR1=0;
6787   1              if(PPM_OUT)                       //输出8通道PPM，PPM信号总周期20ms，
6788   1              {       
6789   2      
6790   2                                                              //每通道固定0.4ms低电平开始，0.6到1.6ms高电平结束
6791   2                      t_PPMout++;
6792   2                      switch(t_PPMout)
6793   2                      {
6794   3                              case 1:PPM=0;TL1=0x70,TH1=0xfe;temp=64935-PPMout[0];
6795   3                                                              T_l=temp;T_h=temp>>8;break;                             
6796   3                              case 2:PPM=1;TL1=T_l;TH1=T_h;break;
6797   3                              case 3:PPM=0;TL1=0x70,TH1=0xfe;temp=64935-PPMout[1];
6798   3                                                              T_l=temp;T_h=temp>>8;break;                             
6799   3                              case 4:PPM=1;TL1=T_l;TH1=T_h;break;
6800   3                              case 5:PPM=0;TL1=0x70,TH1=0xfe;temp=64935-PPMout[2];
6801   3                                                              T_l=temp;T_h=temp>>8;break;                             
6802   3                              case 6:PPM=1;TL1=T_l;TH1=T_h;break;
6803   3                              case 7:PPM=0;TL1=0x70,TH1=0xfe;temp=64935-PPMout[3];
6804   3                                                              T_l=temp;T_h=temp>>8;break;                             
6805   3                              case 8:PPM=1;TL1=T_l;TH1=T_h;break;
6806   3                              case 9:PPM=0;TL1=0x70,TH1=0xfe;temp=64935-PPMout[4];
6807   3                                                              T_l=temp;T_h=temp>>8;break;                             
6808   3                              case 10:PPM=1;TL1=T_l;TH1=T_h;break;
6809   3                              case 11:PPM=0;TL1=0x70,TH1=0xfe;temp=64935-PPMout[5];
6810   3                                                              T_l=temp;T_h=temp>>8;break;                             
6811   3                              case 12:PPM=1;TL1=T_l;TH1=T_h;break;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 111 

6812   3                              case 13:PPM=0;TL1=0x70,TH1=0xfe;temp=64935-PPMout[6];
6813   3                                                              T_l=temp;T_h=temp>>8;break;                             
6814   3                              case 14:PPM=1;TL1=T_l;TH1=T_h;break;
6815   3                              case 15:PPM=0;TL1=0x70,TH1=0xfe;temp=64935-PPMout[7];
6816   3                                                              T_l=temp;T_h=temp>>8;break;                             
6817   3                              case 16:PPM=1;TL1=T_l;TH1=T_h;break;
6818   3                              
6819   3                              case 17:PPM=0;TL1=0x70,TH1=0xfe;break;                          
6820   3                              case 18:PPM=1;TL1=0xf0,TH1=0xd8;t_PPMout=0;break;
6821   3      /*                      
6822   3                              case 13:PPM=0;TL1=0xe0,TH1=0xfc;break;                          
6823   3                              case 14:PPM=1;TL1=0x00,TH1=0xb0;t_PPMout=0;break;*/
6824   3                              
6825   3                      }
6826   2              }
6827   1              TR1=1;//SC1=1;
6828   1      }
6829          
6830          void PCA_isr()interrupt 7       //任务定时器   中优先级
6831          {//SB2=0;  
6832   1              if(CCF0)                                //电压采集
6833   1              {
6834   2                      CCF0=0;
6835   2                      CCAP0L = value0;
6836   2              CCAP0H = value0>> 8;            
6837   2              value0 += 2500;    //2.5ms
6838   2                                
6839   2      //              out=!out;
6840   2                      t_adc++;
6841   2                      switch(t_adc)   //读取上次转换结果,开始下次转换；
6842   2                      {                        
6843   3                              case 1:adc_buff[0]=ADC_RES,adc_buff[0]<<=2,adc_buff[0]+=ADC_RESL;ADC_CONTR=0x89;break;
6844   3                              case 2:adc_buff[1]=ADC_RES,adc_buff[1]<<=2,adc_buff[1]+=ADC_RESL;ADC_CONTR=0x8a;break;
6845   3                              case 3:adc_buff[2]=ADC_RES,adc_buff[2]<<=2,adc_buff[2]+=ADC_RESL;ADC_CONTR=0x8b;break;
6846   3                              case 4:adc_buff[3]=ADC_RES,adc_buff[3]<<=2,adc_buff[3]+=ADC_RESL;ADC_CONTR=0x8c;break;
6847   3                              case 5:adc_buff[4]=ADC_RES,adc_buff[4]<<=2,adc_buff[4]+=ADC_RESL;ADC_CONTR=0x8d;break;
6848   3                              case 6:adc_buff[5]=ADC_RES,adc_buff[5]<<=2,adc_buff[5]+=ADC_RESL;ADC_CONTR=0x8e;break;
6849   3                              case 7:adc_buff[6]=ADC_RES,adc_buff[6]<<=2,adc_buff[6]+=ADC_RESL;ADC_CONTR=0x8f;break;
6850   3                              case 8:adc_buff[7]=ADC_RES,adc_buff[7]<<=2,adc_buff[7]+=ADC_RESL;ADC_CONTR=0x88;t_adc=0;break;
6851   3                       }
6852   2      
6853   2              }                                                                  
6854   1              else                                    //无线通信  
6855   1              {       CCF1=0;
6856   2                              
6857   2                
6858   2                      if(RC_check)            //全频扫描
6859   2                      {
6860   3                              CCAP1L = value1;
6861   3              CCAP1H = value1>> 8;            
6862   3              value1 += 1234;    //2ms
6863   3                              
6864   3                              if(RC_check_star)               
6865   3                              {
6866   4                                      RC_check_star=0;
6867   4                                      RX_mode();
6868   4                              }
6869   3                              
6870   3                              t_check++;
6871   3                              if(t_check>125)t_check=0;
6872   3                              
6873   3                              
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 112 

6874   3                              if(REG_read(0x09))
6875   3                              {
6876   4                                      CD_data[t_check/8]|=1<<(t_check%8);
6877   4                              }
6878   3                              else CD_data[t_check/8]&=~(1<<(t_check%8));
6879   3      
6880   3                              
6881   3                              NRF_channel(t_check);
6882   3                              
6883   3                      }
6884   2                      else if(RC_TX)                    //NRF定时发射信号
6885   2                      {
6886   3                              RC_TX_state++;
6887   3              
6888   3                              if(RC_TX_state==1)//TX
6889   3                              {
6890   4                                      CCAP1L = value1;
6891   4                                      CCAP1H = value1>> 8;            
6892   4                                      value1 += 2000;    //2ms
6893   4                                      
6894   4                                      t_hopping++;
6895   4                                      if(t_hopping>4)t_hopping=0;
6896   4                                      NRF_channel(hopping[t_hopping]);//顺序跳频
6897   4                                      
6898   4                                      if(NRF_change)
6899   4                                      {
6900   5                                              NRF_change=0;
6901   5                                              NRF_power(TX_power);
6902   5                                              TX_address(address);
6903   5                                              RX_address(address);
6904   5                                      }
6905   4      
6906   4                                      if(NRF_config_change)
6907   4                                      {
6908   5                                              NRF_config_change=0;
6909   5                                              tx_order[0]=0xa0;
6910   5                                              FIFO_write2(tx_order,11);
6911   5                                              
6912   5                              
6913   5                                      }
6914   4                                      else if(Receiver_change)
6915   4                                      {
6916   5                                              Receiver_change=0;
6917   5                                              tx_order[0]=0xa2;
6918   5                                      
6919   5                                              FIFO_write2(tx_order,11);
6920   5                                              
6921   5                                              
6922   5                                      }
6923   4                                      else
6924   4                                      {
6925   5      
6926   5                                                      FIFO_write2(tx_data,11);
6927   5      
6928   5                                      }
6929   4                                      
6930   4                                      
6931   4                                      
6932   4                              }
6933   3                              else if(RC_TX_state==2)//RX
6934   3                              {
6935   4                                      CCAP1L = value1;
C51 COMPILER V9.01   MAIN                                                                  05/23/2019 13:18:08 PAGE 113 

6936   4                                      CCAP1H = value1>> 8;            
6937   4                                      value1 += 16600;           //17ms
6938   4                                      
6939   4                                      if(IRQ==0)
6940   4                                      {
6941   5                                              CE=0;
6942   5                                              REG_write(0x07,0x20);   //清除TX中断信号
6943   5                                              CE=1;   
6944   5                                      }
6945   4                                      
6946   4                                      RX_mode();
6947   4                              }
6948   3                              else if(RC_TX_state==3)
6949   3                              {
6950   4                                      CCAP1L = value1;
6951   4                                      CCAP1H = value1>> 8;            
6952   4                                      value1 += 1400;    //1ms
6953   4                      
6954   4                                      RC_TX_state=0;
6955   4                                      if(IRQ==0)
6956   4                                      {
6957   5                                              FIFO_read2(rx,11);              //读取接收数据
6958   5                                              CE=0;
6959   5                                              REG_write(0x07,0x40);   //清除RX中断信号
6960   5                                              CE=1;   
6961   5                                              receive++;
6962   5                                              timer3=0;
6963   5                                      }
6964   4                                      else
6965   4                                      {
6966   5                                              timer3++;
6967   5                                              if(timer3>49)timer3=49,receive=0;
6968   5                                              
6969   5                                      }
6970   4                                      
6971   4                                      timer2++;
6972   4                                      if(timer2>49)timer2=0,FUCK_sum=receive,receive=0;
6973   4                                      TX_mode();      
6974   4                                      
6975   4                              }
6976   3      
6977   3                      }
6978   2      
6979   2                      
6980   2              }
6981   1      //SB2=1;        
6982   1      } 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  42786    ----
   CONSTANT SIZE    =  12303    ----
   XDATA SIZE       =    895     160
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     82    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =     79       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
